<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="/lib/pace/pace-theme-bounce.min.css">
  <script src="/lib/pace/pace.min.js"></script>

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":"mac"},"back2top":{"enable":false,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":true,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="一 click 1介绍 click 是一个以尽可能少的代码、以组合的方式创建优美的命令行程序的 Python 包。它有很高的可配置性，同时也能开箱即用。  它旨在让编写命令行工具的过程既快速又有趣，还能防止由于无法实现预期的 CLI API 所产生挫败感。它有如下三个特点：   * 任意嵌套命令  * 自动生成帮助  * 支持运行时延迟加载子命令  2 快速开始 2.1 业务逻辑 假设命令行程序的">
<meta property="og:type" content="article">
<meta property="og:title" content="python命令行Click">
<meta property="og:url" content="http://example.com/2020/05/02/python%E5%91%BD%E4%BB%A4%E8%A1%8CClick/index.html">
<meta property="og:site_name" content="春雨里洗过的太阳">
<meta property="og:description" content="一 click 1介绍 click 是一个以尽可能少的代码、以组合的方式创建优美的命令行程序的 Python 包。它有很高的可配置性，同时也能开箱即用。  它旨在让编写命令行工具的过程既快速又有趣，还能防止由于无法实现预期的 CLI API 所产生挫败感。它有如下三个特点：   * 任意嵌套命令  * 自动生成帮助  * 支持运行时延迟加载子命令  2 快速开始 2.1 业务逻辑 假设命令行程序的">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2020-05-02T14:33:59.000Z">
<meta property="article:modified_time" content="2023-03-17T15:42:10.678Z">
<meta property="article:author" content="HF">
<meta property="article:tag" content="Python">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://example.com/2020/05/02/python%E5%91%BD%E4%BB%A4%E8%A1%8CClick/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>
<link rel="stylesheet" type="text/css" href="/css/injector.css" />
  <title>python命令行Click | 春雨里洗过的太阳</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">春雨里洗过的太阳</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">世间所有的相遇，都是久别重逢</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="reading-progress-bar"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/05/02/python%E5%91%BD%E4%BB%A4%E8%A1%8CClick/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/hexo.jpg">
      <meta itemprop="name" content="HF">
      <meta itemprop="description" content="第二名就是头号输家">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="春雨里洗过的太阳">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          python命令行Click
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-05-02 22:33:59" itemprop="dateCreated datePublished" datetime="2020-05-02T22:33:59+08:00">2020-05-02</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-03-17 23:42:10" itemprop="dateModified" datetime="2023-03-17T23:42:10+08:00">2023-03-17</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Python/" itemprop="url" rel="index"><span itemprop="name">Python</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span id="busuanzi_value_page_pv"></span>
            </span><br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>55k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>50 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="一-click"><a href="#一-click" class="headerlink" title="一 click"></a>一 click</h1><h2 id="1介绍"><a href="#1介绍" class="headerlink" title="1介绍"></a>1介绍</h2><p><a target="_blank" rel="noopener" href="https://click.palletsprojects.com/">click</a> 是一个以尽可能少的代码、以组合的方式创建优美的命令行程序的 Python 包。它有很高的可配置性，同时也能开箱即用。</p>
<p>它旨在让编写命令行工具的过程既快速又有趣，还能防止由于无法实现预期的 CLI API 所产生挫败感。它有如下三个特点：</p>
<ul>
<li>任意嵌套命令</li>
<li>自动生成帮助</li>
<li>支持运行时延迟加载子命令</li>
</ul>
<h2 id="2-快速开始"><a href="#2-快速开始" class="headerlink" title="2 快速开始"></a>2 快速开始</h2><h3 id="2-1-业务逻辑"><a href="#2-1-业务逻辑" class="headerlink" title="2.1 业务逻辑"></a>2.1 业务逻辑</h3><p>假设命令行程序的输入是 <code>name</code> 和 <code>count</code>，功能是打印指定次数的名字。</p>
<p>那么在 <code>hello.py</code> 中，很容易写出如下代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hello</span>(<span class="params">count, name</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;Simple program that greets NAME for a total of COUNT times.&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> range(count):</span><br><span class="line">        click.echo(<span class="string">&#x27;Hello %s!&#x27;</span> % name)</span><br></pre></td></tr></table></figure>

<p>这段代码的逻辑很简单，就是循环 <code>count</code> 次，使用 <code>click.echo</code> 打印 <code>name</code>。其中，<code>click.echo</code> 和 <code>print</code> 的作用相似，但功能更加强大，能处理好 Unicode 和 二进制数据的情况。</p>
<h3 id="2-2-定义参数"><a href="#2-2-定义参数" class="headerlink" title="2.2 定义参数"></a>2.2 定义参数</h3><p>很显然，我们需要针对 <code>count</code> 和 <code>name</code> 来定义它们所对应的参数信息。</p>
<ul>
<li><code>count</code> 对应为命令行选项 <code>--count</code>，类型为数字，我们希望在不提供参数时，其默认值是 1</li>
<li><code>name</code> 对应为命令行选项 <code>--name</code>，类型为字符串，我们希望在不提供参数时，能给人提示</li>
</ul>
<p>使用 <code>click</code>，就可以写成下面这样：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> click <span class="keyword">import</span> click</span><br><span class="line"></span><br><span class="line"><span class="meta">@click.command()</span></span><br><span class="line"><span class="meta">@click.option(&#x27;--count&#x27;, default=1, help=&#x27;Number of greetings.&#x27;)</span></span><br><span class="line"><span class="meta">@click.option(&#x27;--name&#x27;, prompt=&#x27;Your name&#x27;,</span></span><br><span class="line">              help=<span class="string">&#x27;The person to greet.&#x27;</span>)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hello</span>(<span class="params">count, name</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;Simple program that greets NAME for a total of COUNT times.&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> range(count):</span><br><span class="line">        click.echo(<span class="string">&#x27;Hello %s!&#x27;</span> % name)              </span><br></pre></td></tr></table></figure>

<p>在上面的示例中：</p>
<ul>
<li>使用装饰器的方式，即定义了参数，又将之与处理逻辑绑定，这真是优雅。和 <code>argparse</code>、<code>docopt</code> 比起来，就少了一步绑定过程</li>
<li>使用 <code>click.command</code> 表示 <code>hello</code> 是对命令的处理</li>
<li>使用</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">click.option</span><br></pre></td></tr></table></figure>



<p>  来定义参数选项</p>
<ul>
<li>对于 <code>--count</code> 来说，使用 <code>default</code> 来指定默认值。而由于默认值是数字，进而暗示 <code>--count</code> 选项的类型为数字</li>
<li>对于 <code>--name</code> 来说，使用 <code>prompt</code> 来指定未输入该选项时的提示语</li>
<li>使用 <code>help</code> 来指定帮助信息</li>
</ul>
<p>不论是装饰器的方式、还是各种默认行为，<code>click</code> 都是像它的介绍所说的那样，让人尽可能少地编写代码，让整个过程变得快速而有趣。</p>
<h3 id="2-3-代码梳理"><a href="#2-3-代码梳理" class="headerlink" title="2.3 代码梳理"></a>2.3 代码梳理</h3><p>使用 <code>click</code> 的方式非常简单，我们将上文的代码汇总下，以有一个更清晰的认识：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># hello.py</span></span><br><span class="line"><span class="keyword">import</span> click</span><br><span class="line"></span><br><span class="line"><span class="meta">@click.command()</span></span><br><span class="line"><span class="meta">@click.option(&#x27;--count&#x27;, default=1, help=&#x27;Number of greetings.&#x27;)</span></span><br><span class="line"><span class="meta">@click.option(&#x27;--name&#x27;, prompt=&#x27;Your name&#x27;,</span></span><br><span class="line">              help=<span class="string">&#x27;The person to greet.&#x27;</span>)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hello</span>(<span class="params">count, name</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;Simple program that greets NAME for a total of COUNT times.&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> range(count):</span><br><span class="line">        click.echo(<span class="string">&#x27;Hello %s!&#x27;</span> % name)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    hello()</span><br></pre></td></tr></table></figure>

<p>若我们指定次数和名字：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> python3 hello.py --count 2 --name Eric</span></span><br><span class="line">Hello Eric!</span><br><span class="line">Hello Eric!</span><br></pre></td></tr></table></figure>

<p>若我们什么都不指定，则会提示输入名字，并默认输出一次：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> python3 hello.py</span></span><br><span class="line">Your name: Eric</span><br><span class="line">Hello Eric!</span><br></pre></td></tr></table></figure>

<p>我们还可以通过 <code>--help</code> 参数查看自动生成的帮助信息：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Usage: hello.py [OPTIONS]</span><br><span class="line"></span><br><span class="line">  Simple program that greets NAME for a total of COUNT times.</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">  --count INTEGER  Number of greetings.</span><br><span class="line">  --name TEXT      The person to greet.</span><br><span class="line">  --help           Show this message and exit.</span><br></pre></td></tr></table></figure>

<h2 id="3-深入click"><a href="#3-深入click" class="headerlink" title="3 深入click"></a>3 深入click</h2><p>在概念上， <code>click</code> 把命令行分为 3 个组成：参数、选项和命令。</p>
<ul>
<li><code>参数</code> 就是跟在命令后的除选项外的内容，比如 <code>git add a.txt</code> 中的 <code>a.txt</code> 就是表示文件路径的参数</li>
<li><code>选项</code> 就是以 <code>-</code> 或 <code>--</code> 开头的参数，比如 <code>-f</code>、<code>--file</code></li>
<li><code>命令</code> 就是命令行的初衷了，比如 <code>git</code> 就是命令，而 <code>git add</code> 中的 <code>add</code> 则是 <code>git</code> 的子命令</li>
</ul>
<h3 id="3-1-参数"><a href="#3-1-参数" class="headerlink" title="3.1 参数"></a>3.1 参数</h3><h4 id="3-1-1-基本参数"><a href="#3-1-1-基本参数" class="headerlink" title="3.1.1 基本参数"></a>3.1.1 基本参数</h4><p><code>基本参数</code> 就是通过位置里指定参数值。</p>
<p>比如，我们可以指定两个位置参数 <code>x</code> 和 <code>y</code> ，先添加的 <code>x</code> 位于第一个位置，后加入的 <code>y</code> 位于第二个位置。那么在命令行中输入 <code>1 2</code>的时候，分别对应到的就是 <code>x</code> 和 <code>y</code>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@click.command()</span></span><br><span class="line"><span class="meta">@click.argument(&#x27;x&#x27;)</span></span><br><span class="line"><span class="meta">@click.argument(&#x27;y&#x27;)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hello</span>(<span class="params">x, y</span>):</span></span><br><span class="line">    print(x, y)</span><br></pre></td></tr></table></figure>

<h4 id="3-1-2-参数类型"><a href="#3-1-2-参数类型" class="headerlink" title="3.1.2 参数类型"></a>3.1.2 参数类型</h4><p><code>参数类型</code> 就是将参数值作为什么类型去解析，默认情况下是字符串类型。我们可以通过 <code>type</code> 入参来指定参数类型。</p>
<p><code>click</code> 支持的参数类型多种多样：</p>
<ul>
<li><code>str</code> / <code>click.STRING</code> 表示字符串类型，这也是默认类型</li>
<li><code>int</code> / <code>click.INT</code> 表示整型</li>
<li><code>float</code> / <code>click.FLOAT</code> 表示浮点型</li>
<li><code>bool</code> / <code>click.BOOL</code> 表示布尔型。很棒之处在于，它会识别表示真/假的字符。对于 <code>1</code>、<code>yes</code>、<code>y</code> 和 <code>true</code> 会转化为 <code>True</code>；<code>0</code>、<code>no</code>、<code>n</code> 和 <code>false</code> 会转化为 <code>False</code></li>
<li><code>click.UUID</code> 表示 UUID，会自动将参数转换为 <code>uuid.UUID</code> 对象</li>
<li><code>click.FILE</code> 表示文件，会自动将参数转换为文件对象，并在命令行结束时自动关闭文件</li>
<li><code>click.PATH</code> 表示路径</li>
<li><code>click.Choice</code> 表示选择选项</li>
<li><code>click.IntRange</code> 表示范围选项</li>
</ul>
<p>同 <code>argparse</code> 一样，<code>click</code> 也支持自定义类型，需要编写 <code>click.ParamType</code> 的子类，并重载 <code>convert</code> 方法。</p>
<p>官网提供了一个例子，实现了一个整数类型，除了普通整数之外，还接受十六进制和八进制数字， 并将它们转换为常规整数：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BasedIntParamType</span>(<span class="params">click.ParamType</span>):</span></span><br><span class="line">    name = <span class="string">&quot;integer&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">convert</span>(<span class="params">self, value, param, ctx</span>):</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">if</span> value[:<span class="number">2</span>].lower() == <span class="string">&quot;0x&quot;</span>:</span><br><span class="line">                <span class="keyword">return</span> int(value[<span class="number">2</span>:], <span class="number">16</span>)</span><br><span class="line">            <span class="keyword">elif</span> value[:<span class="number">1</span>] == <span class="string">&quot;0&quot;</span>:</span><br><span class="line">                <span class="keyword">return</span> int(value, <span class="number">8</span>)</span><br><span class="line">            <span class="keyword">return</span> int(value, <span class="number">10</span>)</span><br><span class="line">        <span class="keyword">except</span> TypeError:</span><br><span class="line">            self.fail(</span><br><span class="line">                <span class="string">&quot;expected string for int() conversion, got &quot;</span></span><br><span class="line">                <span class="string">f&quot;<span class="subst">&#123;value!r&#125;</span> of type <span class="subst">&#123;type(value).__name__&#125;</span>&quot;</span>,</span><br><span class="line">                param,</span><br><span class="line">                ctx,</span><br><span class="line">            )</span><br><span class="line">        <span class="keyword">except</span> ValueError:</span><br><span class="line">            self.fail(<span class="string">f&quot;<span class="subst">&#123;value!r&#125;</span> is not a valid integer&quot;</span>, param, ctx)</span><br><span class="line"></span><br><span class="line">BASED_INT = BasedIntParamType()</span><br></pre></td></tr></table></figure>

<h4 id="3-1-3-文件参数"><a href="#3-1-3-文件参数" class="headerlink" title="3.1.3 文件参数"></a>3.1.3 文件参数</h4><p>在基本参数的基础上，通过指定参数类型，我们就能构建出各类参数。</p>
<p><code>文件参数</code> 是非常常用的一类参数，通过 <code>type=click.File</code> 指定，它能正确处理所有 Python 版本的 unicode 和 字节，使得处理文件十分方便。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@click.command()</span></span><br><span class="line"><span class="meta">@click.argument(&#x27;input&#x27;, type=click.File(&#x27;rb&#x27;))  # 指定文件为二进制读</span></span><br><span class="line"><span class="meta">@click.argument(&#x27;output&#x27;, type=click.File(&#x27;wb&#x27;))  # 指定文件为二进制写</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">inout</span>(<span class="params">input, output</span>):</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        chunk = input.read(<span class="number">1024</span>)  <span class="comment"># 此时 input 为文件对象，每次读入 1024 字节</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> chunk:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        output.write(chunk)  <span class="comment"># 此时 output 为文件对象，写入上步读入的内容</span></span><br></pre></td></tr></table></figure>

<h4 id="3-1-4文件路径参数"><a href="#3-1-4文件路径参数" class="headerlink" title="3.1.4文件路径参数"></a>3.1.4文件路径参数</h4><p><code>文件路径参数</code> 用来处理文件路径，可以对路径做是否存在等检查，通过 <code>type=click.Path</code> 指定。不论文件名是 unicode 还是字节类型，获取到的参数类型都是 unicode 类型。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@click.command()</span></span><br><span class="line"><span class="meta">@click.argument(&#x27;filename&#x27;, type=click.Path(exists=True))  # 要求给定路径存在，否则报错</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hello</span>(<span class="params">filename</span>):</span></span><br><span class="line">    click.echo(click.format_filename(filename))</span><br></pre></td></tr></table></figure>

<p>如果文件名是以 <code>-</code> 开头，会被误认为是命令行选项，这个时候需要在参数前加上 <code>--</code> 和空格，比如</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ python hello.py -- -foo.txt</span><br><span class="line">-foo.txt</span><br></pre></td></tr></table></figure>

<h4 id="3-1-5选择项参数"><a href="#3-1-5选择项参数" class="headerlink" title="3.1.5选择项参数"></a>3.1.5选择项参数</h4><p><code>选择项参数</code> 用来限定参数内容，通过 <code>type=click.Choice</code> 指定。</p>
<p>比如，指定文件读取方式限制为 <code>read-only</code> 和 <code>read-write</code>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@click.command()</span></span><br><span class="line"><span class="meta">@click.argument(&#x27;mode&#x27;, type=click.Choice([&#x27;read-only&#x27;, &#x27;read-write&#x27;]))</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hello</span>(<span class="params">mode</span>):</span></span><br><span class="line">    click.echo(mode)</span><br></pre></td></tr></table></figure>

<h4 id="3-1-6可变参数"><a href="#3-1-6可变参数" class="headerlink" title="3.1.6可变参数"></a>3.1.6可变参数</h4><p><code>可变参数</code> 用来定义一个参数可以有多个值，且能通过 <code>nargs</code> 来定义值的个数，取得的参数的变量类型为元组。</p>
<p>若 <code>nargs=N</code>，<code>N</code>为一个数字，则要求该参数提供 N 个值。若 <code>N</code> 为 <code>-1</code> 则接受提供无数量限制的参数，如:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@click.command()</span></span><br><span class="line"><span class="meta">@click.argument(&#x27;foo&#x27;, nargs=-1)</span></span><br><span class="line"><span class="meta">@click.argument(&#x27;bar&#x27;, nargs=1)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hello</span>(<span class="params">foo, bar</span>):</span></span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>

<p>如果要实现 <code>argparse</code> 中要求参数数量为 1 个或多个的功能，则指定 <code>nargs=-1</code> 且 <code>required=True</code> 即可：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@click.command()</span></span><br><span class="line"><span class="meta">@click.argument(&#x27;foo&#x27;, nargs=-1, required=True)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hello</span>(<span class="params">foo, bar</span>):</span></span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>

<h4 id="3-1-7从环境变量读取参数"><a href="#3-1-7从环境变量读取参数" class="headerlink" title="3.1.7从环境变量读取参数"></a>3.1.7从环境变量读取参数</h4><p>通过在 <code>click.argument</code> 中指定 <code>envvar</code>，则可读取指定名称的环境变量作为参数值，比如：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@click.command()</span></span><br><span class="line"><span class="meta">@click.argument(&#x27;filename&#x27;, envvar=&#x27;FILENAME&#x27;)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hello</span>(<span class="params">filename</span>):</span></span><br><span class="line">    print(filename)</span><br></pre></td></tr></table></figure>

<p>执行如下命令查看效果：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> FILENAME=hello.txt python3 hello.py</span></span><br><span class="line">hello.txt</span><br></pre></td></tr></table></figure>



<h3 id="3-2-选项"><a href="#3-2-选项" class="headerlink" title="3.2 选项"></a>3.2 选项</h3><p>通过 <code>click.option</code> 可以给命令增加选项，并通过配置函数的参数来配置不同功能的选项。</p>
<h4 id="3-2-1-给选项命名"><a href="#3-2-1-给选项命名" class="headerlink" title="3.2.1 给选项命名"></a>3.2.1 给选项命名</h4><p><code>click.option</code> 中的命令规则可参考<a target="_blank" rel="noopener" href="https://click.palletsprojects.com/en/7.x/parameters/#parameter-names">参数名称</a>。它接受的前两个参数为长、短选项（顺序随意），其中：</p>
<ul>
<li>长选项以 “–” 开头，比如 “–string-to-echo”</li>
<li>短选项以 “-” 开头，比如 “-s”</li>
</ul>
<p>第三个参数为选项参数的名称，如果不指定，将会使用长选项的下划线形式名称：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@click.command()</span></span><br><span class="line"><span class="meta">@click.option(&#x27;-s&#x27;, &#x27;--string-to-echo&#x27;)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">echo</span>(<span class="params">string_to_echo</span>):</span></span><br><span class="line">    click.echo(string_to_echo)</span><br></pre></td></tr></table></figure>

<p>显示指定为 string</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@click.command()</span></span><br><span class="line"><span class="meta">@click.option(&#x27;-s&#x27;, &#x27;--string-to-echo&#x27;, &#x27;string&#x27;)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">echo</span>(<span class="params">string</span>):</span></span><br><span class="line">    click.echo(string)</span><br></pre></td></tr></table></figure>

<h4 id="3-2-2-基本值选项"><a href="#3-2-2-基本值选项" class="headerlink" title="3.2.2 基本值选项"></a>3.2.2 基本值选项</h4><p>值选项是非常常用的选项，它接受一个值。如果在命令行中提供了值选项，则需要提供对应的值；反之则使用默认值。若没在 <code>click.option</code> 中指定默认值，则默认值为 <code>None</code>，且该选项的类型为 <a target="_blank" rel="noopener" href="https://click.palletsprojects.com/en/7.x/api/#click.STRING">STRING</a>；反之，则选项类型为默认值的类型。</p>
<p>比如，提供默认值为 1，则选项类型为 <a target="_blank" rel="noopener" href="https://click.palletsprojects.com/en/7.x/api/#click.INT">INT</a>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@click.command()</span></span><br><span class="line"><span class="meta">@click.option(&#x27;--n&#x27;, default=1)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dots</span>(<span class="params">n</span>):</span></span><br><span class="line">    click.echo(<span class="string">&#x27;.&#x27;</span> * n)</span><br></pre></td></tr></table></figure>

<p>如果要求选项为必填，则可指定 <code>click.option</code> 的 <code>required=True</code>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@click.command()</span></span><br><span class="line"><span class="meta">@click.option(&#x27;--n&#x27;, required=True, type=int)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dots</span>(<span class="params">n</span>):</span></span><br><span class="line">    click.echo(<span class="string">&#x27;.&#x27;</span> * n)</span><br></pre></td></tr></table></figure>

<p>如果选项名称和 Python 中的关键字冲突，则可以显式的指定选项名称。比如将 <code>--from</code> 的名称设置为 <code>from_</code>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@click.command()</span></span><br><span class="line"><span class="meta">@click.option(&#x27;--from&#x27;, &#x27;-f&#x27;, &#x27;from_&#x27;)</span></span><br><span class="line"><span class="meta">@click.option(&#x27;--to&#x27;, &#x27;-t&#x27;)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">reserved_param_name</span>(<span class="params">from_, to</span>):</span></span><br><span class="line">    click.echo(<span class="string">f&#x27;from <span class="subst">&#123;from_&#125;</span> to <span class="subst">&#123;to&#125;</span>&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>如果要在帮助中显式默认值，则可指定 <code>click.option</code> 的 <code>show_default=True</code>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@click.command()</span></span><br><span class="line"><span class="meta">@click.option(&#x27;--n&#x27;, default=1, show_default=True)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dots</span>(<span class="params">n</span>):</span></span><br><span class="line">    click.echo(<span class="string">&#x27;.&#x27;</span> * n)</span><br></pre></td></tr></table></figure>

<p>在命令行中调用则有：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ dots --<span class="built_in">help</span></span><br><span class="line">Usage: dots [OPTIONS]</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">  --n INTEGER  [default: 1]</span><br><span class="line">  --<span class="built_in">help</span>       Show this message and <span class="built_in">exit</span>.</span><br></pre></td></tr></table></figure>

<h4 id="3-2-3多值选项"><a href="#3-2-3多值选项" class="headerlink" title="3.2.3多值选项"></a>3.2.3多值选项</h4><p>有时，我们会希望命令行中一个选项能接收多个值，通过指定 <code>click.option</code> 中的 <code>nargs</code> 参数（必须是大于等于 0）。这样，接收的多值选项就会变成一个元组。</p>
<p>比如，在下面的示例中，当通过 <code>--pos</code> 指定多个值时，<code>pos</code> 变量就是一个元组，里面的每个元素是一个 <code>float</code>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@click.command()</span></span><br><span class="line"><span class="meta">@click.option(&#x27;--pos&#x27;, nargs=2, type=float)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">findme</span>(<span class="params">pos</span>):</span></span><br><span class="line">    click.echo(pos)</span><br></pre></td></tr></table></figure>

<p>在命令行中调用则有：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ findme --pos 2.0 3.0</span><br><span class="line">(1.0, 2.0)</span><br></pre></td></tr></table></figure>

<p>有时，通过同一选项指定的多个值得类型可能不同，这个时候可以指定 <code>click.option</code> 中的 <code>type=(类型1, 类型2, ...)</code> 来实现。而由于元组的长度同时表示了值的数量，所以就无须指定 <code>nargs</code> 参数。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@click.command()</span></span><br><span class="line"><span class="meta">@click.option(&#x27;--item&#x27;, type=(str, int))</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">putitem</span>(<span class="params">item</span>):</span></span><br><span class="line">    click.echo(<span class="string">&#x27;name=%s id=%d&#x27;</span> % item)</span><br></pre></td></tr></table></figure>

<p>在命令行中调用则有：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ putitem --item peter 1338</span><br><span class="line">name=peter id=1338</span><br></pre></td></tr></table></figure>

<h4 id="3-2-4多选项"><a href="#3-2-4多选项" class="headerlink" title="3.2.4多选项"></a>3.2.4多选项</h4><p>不同于多值选项是通过一个选项指定多个值，多选项则是使用多个相同选项分别指定值，通过 <code>click.option</code> 中的 <code>multiple=True</code> 来实现。</p>
<p>当我们定义如下多选项：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@click.command()</span></span><br><span class="line"><span class="meta">@click.option(&#x27;--message&#x27;, &#x27;-m&#x27;, multiple=True)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">commit</span>(<span class="params">message</span>):</span></span><br><span class="line">    click.echo(<span class="string">&#x27;\n&#x27;</span>.join(message))</span><br></pre></td></tr></table></figure>

<p>便可以指定任意数量个选项来指定值，获取到的 <code>message</code> 是一个元组：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ commit -m foo -m bar --message baz</span><br><span class="line">foo</span><br><span class="line">bar</span><br><span class="line">baz</span><br></pre></td></tr></table></figure>

<h4 id="3-2-5-计值选项"><a href="#3-2-5-计值选项" class="headerlink" title="3.2.5 计值选项"></a>3.2.5 计值选项</h4><p>有时我们可能需要获得选项的数量，那么可以指定 <code>click.option</code> 中的 <code>count=True</code> 来实现。</p>
<p>最常见的使用场景就是指定多个 <code>--verbose</code> 或 <code>-v</code> 选项来表示输出内容的详细程度。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@click.command()</span></span><br><span class="line"><span class="meta">@click.option(&#x27;-v&#x27;, &#x27;--verbose&#x27;, count=True)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">log</span>(<span class="params">verbose</span>):</span></span><br><span class="line">    click.echo(<span class="string">f&#x27;Verbosity: <span class="subst">&#123;verbose&#125;</span>&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>在命令行中调用则有：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">log</span> -vvv</span><br><span class="line">Verbosity: 3</span><br></pre></td></tr></table></figure>

<p>通过上面的例子，<code>verbose</code> 就是数字，表示 <code>-v</code> 选项的数量，由此可以进一步使用该值来控制日志的详细程度。</p>
<h3 id="2-6-布尔选项"><a href="#2-6-布尔选项" class="headerlink" title="2.6 布尔选项"></a>2.6 布尔选项</h3><p>布尔选项用来表示真或假，它有多种实现方式：</p>
<ul>
<li>通过 <code>click.option</code> 的 <code>is_flag=True</code> 参数来实现：</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="meta">@click.command()</span></span><br><span class="line"><span class="meta">@click.option(&#x27;--shout&#x27;, is_flag=True)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">info</span>(<span class="params">shout</span>):</span></span><br><span class="line">    rv = sys.platform</span><br><span class="line">    <span class="keyword">if</span> shout:</span><br><span class="line">        rv = rv.upper() + <span class="string">&#x27;!!!!111&#x27;</span></span><br><span class="line">    click.echo(rv)</span><br></pre></td></tr></table></figure>

<p>在命令行中调用则有：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ info --shout</span><br><span class="line">LINUX!!!!111</span><br></pre></td></tr></table></figure>

<ul>
<li>通过在 <code>click.option</code> 的选项定义中使用 <code>/</code> 分隔表示真假两个选项来实现：</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="meta">@click.command()</span></span><br><span class="line"><span class="meta">@click.option(&#x27;--shout/--no-shout&#x27;, default=False)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">info</span>(<span class="params">shout</span>):</span></span><br><span class="line">    rv = sys.platform</span><br><span class="line">    <span class="keyword">if</span> shout:</span><br><span class="line">        rv = rv.upper() + <span class="string">&#x27;!!!!111&#x27;</span></span><br><span class="line">    click.echo(rv)</span><br></pre></td></tr></table></figure>

<p>在命令行中调用则有：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ info --shout</span><br><span class="line">LINUX!!!!111</span><br><span class="line">$ info --no-shout</span><br><span class="line">linux</span><br></pre></td></tr></table></figure>

<p>在 Windows 中，一个选项可以以 <code>/</code> 开头，这样就会真假选项的分隔符冲突了，这个时候可以使用 <code>;</code> 进行分隔：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@click.command()</span></span><br><span class="line"><span class="meta">@click.option(&#x27;/debug;/no-debug&#x27;)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">log</span>(<span class="params">debug</span>):</span></span><br><span class="line">    click.echo(<span class="string">f&#x27;debug=<span class="subst">&#123;debug&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    log()</span><br></pre></td></tr></table></figure>

<p>在 cmd 中调用则有：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="built_in">log</span> /debug</span><br><span class="line">debug=True</span><br></pre></td></tr></table></figure>

<h4 id="3-2-7-特性切换选项"><a href="#3-2-7-特性切换选项" class="headerlink" title="3.2.7 特性切换选项"></a>3.2.7 特性切换选项</h4><p>所谓特性切换就是切换同一个操作对象的不同特性，比如指定 <code>--upper</code> 就让输出大写，指定 <code>--lower</code> 就让输出小写。这么来看，布尔值其实是特性切换的一个特例。</p>
<p>要实现特性切换选项，需要让多个选项都有相同的参数名称，并且定义它们的标记值 <code>flag_value</code>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="meta">@click.command()</span></span><br><span class="line"><span class="meta">@click.option(&#x27;--upper&#x27;, &#x27;transformation&#x27;, flag_value=&#x27;upper&#x27;,</span></span><br><span class="line">              default=<span class="literal">True</span>)</span><br><span class="line"><span class="meta">@click.option(&#x27;--lower&#x27;, &#x27;transformation&#x27;, flag_value=&#x27;lower&#x27;)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">info</span>(<span class="params">transformation</span>):</span></span><br><span class="line">    click.echo(getattr(sys.platform, transformation)())</span><br></pre></td></tr></table></figure>

<p>在命令行中调用则有：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ info --upper</span><br><span class="line">LINUX</span><br><span class="line">$ info --lower</span><br><span class="line">linux</span><br><span class="line">$ info</span><br><span class="line">LINUX</span><br></pre></td></tr></table></figure>

<p>在上面的示例中，<code>--upper</code> 和 <code>--lower</code> 都有相同的参数值 <code>transformation</code>：</p>
<ul>
<li>当指定 <code>--upper</code> 时，<code>transformation</code> 就是 <code>--upper</code> 选项的标记值 <code>upper</code></li>
<li>当指定 <code>--lower</code> 时，<code>transformation</code> 就是 <code>--lower</code> 选项的标记值 <code>lower</code></li>
</ul>
<p>进而就可以做进一步的业务逻辑处理。</p>
<h4 id="3-2-8-选择项选项"><a href="#3-2-8-选择项选项" class="headerlink" title="3.2.8 选择项选项"></a>3.2.8 选择项选项</h4><p><code>选择项选项</code> 和 上篇文章中介绍的 <code>选择项参数</code> 类似，只不过是限定选项内容，依旧是通过 <code>type=click.Choice</code> 实现。此外，<code>case_sensitive=False</code> 还可以忽略选项内容的大小写。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@click.command()</span></span><br><span class="line"><span class="meta">@click.option(&#x27;--hash-type&#x27;,</span></span><br><span class="line">              type=click.Choice([<span class="string">&#x27;MD5&#x27;</span>, <span class="string">&#x27;SHA1&#x27;</span>], case_sensitive=<span class="literal">False</span>))</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">digest</span>(<span class="params">hash_type</span>):</span></span><br><span class="line">    click.echo(hash_type)</span><br></pre></td></tr></table></figure>

<p>在命令行中调用则有：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">$ digest --hash-type=MD5</span><br><span class="line">MD5</span><br><span class="line"></span><br><span class="line">$ digest --hash-type=md5</span><br><span class="line">MD5</span><br><span class="line"></span><br><span class="line">$ digest --hash-type=foo</span><br><span class="line">Usage: digest [OPTIONS]</span><br><span class="line">Try <span class="string">&quot;digest --help&quot;</span> <span class="keyword">for</span> <span class="built_in">help</span>.</span><br><span class="line"></span><br><span class="line">Error: Invalid value <span class="keyword">for</span> <span class="string">&quot;--hash-type&quot;</span>: invalid choice: foo. (choose from MD5, SHA1)</span><br><span class="line"></span><br><span class="line">$ digest --<span class="built_in">help</span></span><br><span class="line">Usage: digest [OPTIONS]</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">  --hash-type [MD5|SHA1]</span><br><span class="line">  --<span class="built_in">help</span>                  Show this message and <span class="built_in">exit</span>.</span><br></pre></td></tr></table></figure>

<h4 id="3-2-9-提示选项"><a href="#3-2-9-提示选项" class="headerlink" title="3.2.9 提示选项"></a>3.2.9 提示选项</h4><p>顾名思义，当提供了选项却没有提供对应的值时，会提示用户输入值。这种交互式的方式会让命令行变得更加友好。通过指定 <code>click.option</code> 中的 <code>prompt</code> 可以实现。</p>
<ul>
<li>当 <code>prompt=True</code> 时，提示内容为选项的参数名称</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@click.command()</span></span><br><span class="line"><span class="meta">@click.option(&#x27;--name&#x27;, prompt=True)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hello</span>(<span class="params">name</span>):</span></span><br><span class="line">    click.echo(<span class="string">f&#x27;Hello <span class="subst">&#123;name&#125;</span>!&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>在命令行调用则有：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ hello --name=John</span><br><span class="line">Hello John!</span><br><span class="line">$ hello</span><br><span class="line">Name: John</span><br><span class="line">Hello John!</span><br></pre></td></tr></table></figure>

<ul>
<li>当 <code>prompt=&#39;Your name please&#39;</code> 时，提示内容为指定内容</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@click.command()</span></span><br><span class="line"><span class="meta">@click.option(&#x27;--name&#x27;, prompt=&#x27;Your name please&#x27;)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hello</span>(<span class="params">name</span>):</span></span><br><span class="line">    click.echo(<span class="string">f&#x27;Hello <span class="subst">&#123;name&#125;</span>!&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>在命令行中调用则有：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ hello</span><br><span class="line">Your name please: John</span><br><span class="line">Hello John!</span><br></pre></td></tr></table></figure>

<p>基于提示选项，我们还可以指定 <code>hide_input=True</code> 来隐藏输入，<code>confirmation_prompt=True</code> 来让用户进行二次输入，这非常适合输入密码的场景。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@click.command()</span></span><br><span class="line"><span class="meta">@click.option(&#x27;--password&#x27;, prompt=True, hide_input=True,</span></span><br><span class="line">              confirmation_prompt=<span class="literal">True</span>)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encrypt</span>(<span class="params">password</span>):</span></span><br><span class="line">    click.echo(<span class="string">f&#x27;Encrypting password to <span class="subst">&#123;password.encode(<span class="string">&quot;rot13&quot;</span>)&#125;</span>&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>当然，也可以直接使用 <code>click.password_option</code>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@click.command()</span></span><br><span class="line"><span class="meta">@click.password_option()</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encrypt</span>(<span class="params">password</span>):</span></span><br><span class="line">    click.echo(<span class="string">f&#x27;Encrypting password to <span class="subst">&#123;password.encode(<span class="string">&quot;rot13&quot;</span>)&#125;</span>&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>我们还可以给提示选项设置默认值，通过 <code>default</code> 参数进行设置，如果被设置为函数，则可以实现动态默认值。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@click.command()</span></span><br><span class="line"><span class="meta">@click.option(&#x27;--username&#x27;, prompt=True,</span></span><br><span class="line">              default=<span class="keyword">lambda</span>: os.environ.get(<span class="string">&#x27;USER&#x27;</span>, <span class="string">&#x27;&#x27;</span>))</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hello</span>(<span class="params">username</span>):</span></span><br><span class="line">    print(<span class="string">&quot;Hello,&quot;</span>, username)</span><br></pre></td></tr></table></figure>

<p>详情请阅读 <a target="_blank" rel="noopener" href="https://click.palletsprojects.com/en/7.x/options/#dynamic-defaults-for-prompts">Dynamic Defaults for Prompts</a>。</p>
<h4 id="3-2-10-范围选项"><a href="#3-2-10-范围选项" class="headerlink" title="3.2.10 范围选项"></a>3.2.10 范围选项</h4><p>如果希望选项的值在某个范围内，就可以使用范围选项，通过指定 <code>type=click.IntRange</code> 来实现。它有两种模式：</p>
<ul>
<li>默认模式（非强制模式），如果值不在区间范围内将会引发一个错误。如 <code>type=click.IntRange(0, 10)</code> 表示范围是 [0, 10]，超过该范围报错</li>
<li>强制模式，如果值不在区间范围内，将会强制选取一个区间临近值。如 <code>click.IntRange(0, None, clamp=True)</code> 表示范围是 [0, +∞)，小于 0 则取 0，大于 20 则取 20。其中 <code>None</code> 表示没有限制</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@click.command()</span></span><br><span class="line"><span class="meta">@click.option(&#x27;--count&#x27;, type=click.IntRange(0, None, clamp=True))</span></span><br><span class="line"><span class="meta">@click.option(&#x27;--digit&#x27;, type=click.IntRange(0, 10))</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">repeat</span>(<span class="params">count, digit</span>):</span></span><br><span class="line">    click.echo(str(digit) * count)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    repeat()</span><br></pre></td></tr></table></figure>

<p>在命令行中调用则有：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ repeat --count=1000 --digit=5</span><br><span class="line">55555555555555555555</span><br><span class="line">$ repeat --count=1000 --digit=12</span><br><span class="line">Usage: repeat [OPTIONS]</span><br><span class="line"></span><br><span class="line">Error: Invalid value <span class="keyword">for</span> <span class="string">&quot;--digit&quot;</span>: 12 is not <span class="keyword">in</span> the valid range of 0 to 10.</span><br></pre></td></tr></table></figure>

<h4 id="3-2-11-回调和优先"><a href="#3-2-11-回调和优先" class="headerlink" title="3.2.11 回调和优先"></a>3.2.11 回调和优先</h4><p><strong>回调</strong> 通过 <code>click.option</code> 中的 <code>callback</code> 可以指定选项的回调，它会在该选项被解析后调用。回调函数的签名如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">callback</span>(<span class="params">ctx, param, value</span>):</span></span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>

<p>其中：</p>
<ul>
<li>ctx 是命令的上下文 <a target="_blank" rel="noopener" href="https://click.palletsprojects.com/en/7.x/api/#click.Context">click.Context</a></li>
<li>param 为选项变量 <a target="_blank" rel="noopener" href="https://click.palletsprojects.com/en/7.x/api/#click.Option">click.Option</a></li>
<li>value 为选项的值</li>
</ul>
<p>使用回调函数可以完成额外的参数校验逻辑。比如，通过 –rolls 的选项来指定摇骰子的方式，内容为“d”，表示 M 面的骰子摇 N 次，N 和 M 都是数字。在真正的处理 rolls 前，我们需要通过回调函数来校验它的格式：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">validate_rolls</span>(<span class="params">ctx, param, value</span>):</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        rolls, dice = map(int, value.split(<span class="string">&#x27;d&#x27;</span>, <span class="number">2</span>))</span><br><span class="line">        <span class="keyword">return</span> (dice, rolls)</span><br><span class="line">    <span class="keyword">except</span> ValueError:</span><br><span class="line">        <span class="keyword">raise</span> click.BadParameter(<span class="string">&#x27;rolls need to be in format NdM&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@click.command()</span></span><br><span class="line"><span class="meta">@click.option(&#x27;--rolls&#x27;, callback=validate_rolls, default=&#x27;1d6&#x27;)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">roll</span>(<span class="params">rolls</span>):</span></span><br><span class="line">    click.echo(<span class="string">&#x27;Rolling a %d-sided dice %d time(s)&#x27;</span> % rolls)</span><br></pre></td></tr></table></figure>

<p>这样，当我们输入错误格式时，变会校验不通过：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ roll --rolls=42</span><br><span class="line">Usage: roll [OPTIONS]</span><br><span class="line"></span><br><span class="line">Error: Invalid value <span class="keyword">for</span> <span class="string">&quot;--rolls&quot;</span>: rolls need to be <span class="keyword">in</span> format NdM</span><br></pre></td></tr></table></figure>

<p>输入正确格式时，则正常输出信息：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ roll --rolls=2d12</span><br><span class="line">Rolling a 12-sided dice 2 time(s)</span><br></pre></td></tr></table></figure>

<p><strong>优先</strong> 通过 <code>click.option</code> 中的 <code>is_eager</code> 可以让该选项成为优先选项，这意味着它会先于所有选项处理。</p>
<p>利用回调和优先选项，我们就可以很好地实现 <code>--version</code> 选项。不论命令行中写了多少选项和参数，只要包含了 <code>--version</code>，我们就希望它打印版本就退出，而不执行其他选项的逻辑，那么就需要让它成为优先选项，并且在回调函数中打印版本。</p>
<p>此外，在 <code>click</code> 中每个选项都对应到命令处理函数的同名参数，如果不想把该选项传递到处理函数中，则需要指定 <code>expose_value=True</code>，于是有：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">print_version</span>(<span class="params">ctx, param, value</span>):</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> value <span class="keyword">or</span> ctx.resilient_parsing:</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    click.echo(<span class="string">&#x27;Version 1.0&#x27;</span>)</span><br><span class="line">    ctx.exit()</span><br><span class="line"></span><br><span class="line"><span class="meta">@click.command()</span></span><br><span class="line"><span class="meta">@click.option(&#x27;--version&#x27;, is_flag=True, callback=print_version,</span></span><br><span class="line">              expose_value=<span class="literal">False</span>, is_eager=<span class="literal">True</span>)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hello</span>():</span></span><br><span class="line">    click.echo(<span class="string">&#x27;Hello World!&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>当然 <code>click</code> 提供了便捷的 <code>click.version_option</code> 来实现 <code>--version</code>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@click.command()</span></span><br><span class="line"><span class="meta">@click.version_option(version=&#x27;0.1.0&#x27;)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hello</span>():</span></span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>

<h4 id="3-2-12-Yes-选项"><a href="#3-2-12-Yes-选项" class="headerlink" title="3.2.12 Yes 选项"></a>3.2.12 Yes 选项</h4><p>基于前面的学习，我们可以实现 Yes 选项，也就是对于某些操作，不提供 <code>--yes</code> 则进行二次确认，提供了则直接操作：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">abort_if_false</span>(<span class="params">ctx, param, value</span>):</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> value:</span><br><span class="line">        ctx.abort()</span><br><span class="line"></span><br><span class="line"><span class="meta">@click.command()</span></span><br><span class="line"><span class="meta">@click.option(&#x27;--yes&#x27;, is_flag=True, callback=abort_if_false,</span></span><br><span class="line">              expose_value=<span class="literal">False</span>,</span><br><span class="line">              prompt=<span class="string">&#x27;Are you sure you want to drop the db?&#x27;</span>)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dropdb</span>():</span></span><br><span class="line">    click.echo(<span class="string">&#x27;Dropped all tables!&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>当然 <code>click</code> 提供了便捷的 <code>click.confirmation_option</code> 来实现 Yes 选项：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@click.command()</span></span><br><span class="line"><span class="meta">@click.confirmation_option(prompt=&#x27;Are you sure you want to drop the db?&#x27;)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dropdb</span>():</span></span><br><span class="line">    click.echo(<span class="string">&#x27;Dropped all tables!&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>在命令行中调用则有：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ dropdb</span><br><span class="line">Are you sure you want to drop the db? [y/N]: n</span><br><span class="line">Aborted!</span><br><span class="line">$ dropdb --yes</span><br><span class="line">Dropped all tables!</span><br></pre></td></tr></table></figure>

<h4 id="3-2-13-其他增强功能"><a href="#3-2-13-其他增强功能" class="headerlink" title="3.2.13 其他增强功能"></a>3.2.13 其他增强功能</h4><p><code>click</code> 支持从环境中读取选项的值，这是 <code>argparse</code> 所不支持的，可参阅官方文档的 <a target="_blank" rel="noopener" href="https://click.palletsprojects.com/en/7.x/options/#values-from-environment-variables">Values from Environment Variables</a> 和 <a target="_blank" rel="noopener" href="https://click.palletsprojects.com/en/7.x/options/#multiple-values-from-environment-values">Multiple Values from Environment Values</a>。</p>
<p><code>click</code> 支持指定选项前缀，你可以不使用 <code>-</code> 作为选项前缀，还可使用 <code>+</code> 或 <code>/</code>，当然在一般情况下并不建议这么做。详情参阅官方文档的 <a target="_blank" rel="noopener" href="https://click.palletsprojects.com/en/7.x/options/#other-prefix-characters">Other Prefix Characters</a></p>
<h3 id="3-3-命令和组"><a href="#3-3-命令和组" class="headerlink" title="3.3 命令和组"></a>3.3 命令和组</h3><p><code>Click</code> 中非常重要的特性就是任意嵌套命令行工具的概念，通过 <a target="_blank" rel="noopener" href="https://click.palletsprojects.com/en/7.x/api/#click.Command">Command</a> 和 <a target="_blank" rel="noopener" href="https://click.palletsprojects.com/en/7.x/api/#click.Group">Group</a> （实际上是 <a target="_blank" rel="noopener" href="https://click.palletsprojects.com/en/7.x/api/#click.MultiCommand">MultiCommand</a>）来实现。</p>
<p>所谓命令组就是若干个命令（或叫子命令）的集合，也成为多命令。</p>
<h4 id="3-3-1回调调用"><a href="#3-3-1回调调用" class="headerlink" title="3.3.1回调调用"></a>3.3.1回调调用</h4><p>对于一个普通的命令来说，回调发生在命令被执行的时候。如果这个程序的实现中只有命令，那么回调总是会被触发，就像我们在上一篇文章中举出的所有示例一样。不过像 <code>--help</code> 这类选项则会阻止进入回调。</p>
<p>对于组和多个子命令来说，情况略有不同。回调通常发生在子命令被执行的时候：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@click.group()</span></span><br><span class="line"><span class="meta">@click.option(&#x27;--debug/--no-debug&#x27;, default=False)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">cli</span>(<span class="params">debug</span>):</span></span><br><span class="line">    click.echo(<span class="string">&#x27;Debug mode is %s&#x27;</span> % (<span class="string">&#x27;on&#x27;</span> <span class="keyword">if</span> debug <span class="keyword">else</span> <span class="string">&#x27;off&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="meta">@cli.command()  # @cli, not @click!</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sync</span>():</span></span><br><span class="line">    click.echo(<span class="string">&#x27;Syncing&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>执行效果如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Usage: tool.py [OPTIONS] COMMAND [ARGS]...</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">  --debug / --no-debug</span><br><span class="line">  --<span class="built_in">help</span>                Show this message and <span class="built_in">exit</span>.</span><br><span class="line"></span><br><span class="line">Commands:</span><br><span class="line">  sync</span><br><span class="line"></span><br><span class="line">$ tool.py --debug sync</span><br><span class="line">Debug mode is on</span><br><span class="line">Syncing</span><br></pre></td></tr></table></figure>

<p>在上面的示例中，我们将函数 <code>cli</code> 定义为一个组，把函数 <code>sync</code> 定义为这个组内的子命令。当我们调用 <code>tool.py --debug sync</code> 命令时，会依次触发 <code>cli</code> 和 <code>sync</code> 的处理逻辑（也就是命令的回调）。</p>
<h4 id="3-3-2嵌套处理和上下文"><a href="#3-3-2嵌套处理和上下文" class="headerlink" title="3.3.2嵌套处理和上下文"></a>3.3.2嵌套处理和上下文</h4><p>从上面的例子可以看到，命令组 <code>cli</code> 接收的参数和子命令 <code>sync</code> 彼此独立。但是有时我们希望在子命令中能获取到命令组的参数，这就可以用 <a target="_blank" rel="noopener" href="https://click.palletsprojects.com/en/7.x/api/#click.Context">Context</a> 来实现。</p>
<p>每当命令被调用时，<code>click</code> 会创建新的上下文，并链接到父上下文。通常，我们是看不到上下文信息的。但我们可以通过 <a target="_blank" rel="noopener" href="https://click.palletsprojects.com/en/7.x/api/#click.pass_context">pass_context</a> 装饰器来显式让 <code>click</code> 传递上下文，此变量会作为第一个参数进行传递。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@click.group()</span></span><br><span class="line"><span class="meta">@click.option(&#x27;--debug/--no-debug&#x27;, default=False)</span></span><br><span class="line"><span class="meta">@click.pass_context</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">cli</span>(<span class="params">ctx, debug</span>):</span></span><br><span class="line">    <span class="comment"># 确保 ctx.obj 存在并且是个 dict。 (以防 `cli()` 指定 obj 为其他类型</span></span><br><span class="line">    ctx.ensure_object(dict)</span><br><span class="line"></span><br><span class="line">    ctx.obj[<span class="string">&#x27;DEBUG&#x27;</span>] = debug</span><br><span class="line"></span><br><span class="line"><span class="meta">@cli.command()</span></span><br><span class="line"><span class="meta">@click.pass_context</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sync</span>(<span class="params">ctx</span>):</span></span><br><span class="line">    click.echo(<span class="string">&#x27;Debug is %s&#x27;</span> % (ctx.obj[<span class="string">&#x27;DEBUG&#x27;</span>] <span class="keyword">and</span> <span class="string">&#x27;on&#x27;</span> <span class="keyword">or</span> <span class="string">&#x27;off&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    cli(obj=&#123;&#125;)</span><br></pre></td></tr></table></figure>

<p>在上面的示例中：</p>
<ul>
<li>通过为命令组 <code>cli</code> 和子命令 <code>sync</code> 指定装饰器 <code>click.pass_context</code>，两个函数的第一个参数都是 <code>ctx</code> 上下文</li>
<li>在命令组 <code>cli</code> 中，给上下文的 <code>obj</code> 变量（字典）赋值</li>
<li>在子命令 <code>sync</code> 中通过 <code>ctx.obj[&#39;DEBUG&#39;]</code> 获得上一步的参数</li>
<li>通过这种方式完成了从命令组到子命令的参数传递</li>
</ul>
<h4 id="3-3-3-不使用命令来调用命令组"><a href="#3-3-3-不使用命令来调用命令组" class="headerlink" title="3.3.3 不使用命令来调用命令组"></a>3.3.3 不使用命令来调用命令组</h4><p>默认情况下，调用子命令的时候才会调用命令组。而有时你可能想直接调用命令组，通过指定 <code>click.group</code> 的 <code>invoke_without_command=True</code> 来实现：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@click.group(invoke_without_command=True)</span></span><br><span class="line"><span class="meta">@click.pass_context</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">cli</span>(<span class="params">ctx</span>):</span></span><br><span class="line">    <span class="keyword">if</span> ctx.invoked_subcommand <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        click.echo(<span class="string">&#x27;I was invoked without subcommand&#x27;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        click.echo(<span class="string">&#x27;I am about to invoke %s&#x27;</span> % ctx.invoked_subcommand)</span><br><span class="line"></span><br><span class="line"><span class="meta">@cli.command()</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sync</span>():</span></span><br><span class="line">    click.echo(<span class="string">&#x27;The subcommand&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>调用命令有：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ tool</span><br><span class="line">I was invoked without subcommand</span><br><span class="line">$ tool sync</span><br><span class="line">I am about to invoke sync</span><br><span class="line">The subcommand</span><br></pre></td></tr></table></figure>

<p>在上面的示例中，通过 <code>ctx.invoked_subcommand</code> 来判断是否由子命令触发，针对两种情况打印日志。</p>
<h4 id="3-3-4-自定义命令组-多命令"><a href="#3-3-4-自定义命令组-多命令" class="headerlink" title="3.3.4 自定义命令组/多命令"></a>3.3.4 自定义命令组/多命令</h4><p>除了使用 <a target="_blank" rel="noopener" href="https://click.palletsprojects.com/en/7.x/api/#click.group">click.group</a> 来定义命令组外，你还可以自定义命令组（也就是多命令），这样你就可以延迟加载子命令，这会很有用。</p>
<p>自定义多命令需要实现 <code>list_commands</code> 和 <code>get_command</code> 方法：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> click</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">plugin_folder = os.path.join(os.path.dirname(__file__), <span class="string">&#x27;commands&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyCLI</span>(<span class="params">click.MultiCommand</span>):</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">list_commands</span>(<span class="params">self, ctx</span>):</span></span><br><span class="line">        rv = []  <span class="comment"># 命令名称列表</span></span><br><span class="line">        <span class="keyword">for</span> filename <span class="keyword">in</span> os.listdir(plugin_folder):</span><br><span class="line">            <span class="keyword">if</span> filename.endswith(<span class="string">&#x27;.py&#x27;</span>):</span><br><span class="line">                rv.append(filename[:<span class="number">-3</span>])</span><br><span class="line">        rv.sort()</span><br><span class="line">        <span class="keyword">return</span> rv</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_command</span>(<span class="params">self, ctx, name</span>):</span></span><br><span class="line">        ns = &#123;&#125;</span><br><span class="line">        fn = os.path.join(plugin_folder, name + <span class="string">&#x27;.py&#x27;</span>)  <span class="comment"># 命令对应的 Python 文件</span></span><br><span class="line">        <span class="keyword">with</span> open(fn) <span class="keyword">as</span> f:</span><br><span class="line">            code = compile(f.read(), fn, <span class="string">&#x27;exec&#x27;</span>)</span><br><span class="line">            eval(code, ns, ns)</span><br><span class="line">        <span class="keyword">return</span> ns[<span class="string">&#x27;cli&#x27;</span>]</span><br><span class="line"></span><br><span class="line">cli = MyCLI(help=<span class="string">&#x27;This tool\&#x27;s subcommands are loaded from a &#x27;</span></span><br><span class="line">            <span class="string">&#x27;plugin folder dynamically.&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 等价方式是通过 click.command 装饰器，指定 cls=MyCLI</span></span><br><span class="line"><span class="comment"># @click.command(cls=MyCLI)</span></span><br><span class="line"><span class="comment"># def cli():</span></span><br><span class="line"><span class="comment">#     pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    cli()</span><br></pre></td></tr></table></figure>

<h4 id="3-3-5-合并命令组-多命令"><a href="#3-3-5-合并命令组-多命令" class="headerlink" title="3.3.5 合并命令组/多命令"></a>3.3.5 合并命令组/多命令</h4><p>当有多个命令组，每个命令组中有一些命令，你想把所有的命令合并在一个集合中时，<code>click.CommandCollection</code> 就派上了用场：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@click.group()</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">cli1</span>():</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@cli1.command()</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">cmd1</span>():</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;Command on cli1&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@click.group()</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">cli2</span>():</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@cli2.command()</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">cmd2</span>():</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;Command on cli2&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">cli = click.CommandCollection(sources=[cli1, cli2])</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    cli()</span><br></pre></td></tr></table></figure>

<p>调用命令有：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ cli --<span class="built_in">help</span></span><br><span class="line">Usage: cli [OPTIONS] COMMAND [ARGS]...</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">  --<span class="built_in">help</span>  Show this message and <span class="built_in">exit</span>.</span><br><span class="line"></span><br><span class="line">Commands:</span><br><span class="line">  cmd1  Command on cli1</span><br><span class="line">  cmd2  Command on cli2</span><br></pre></td></tr></table></figure>

<p>从上面的示例可以看出，<code>cmd1</code> 和 <code>cmd2</code> 分别属于 <code>cli1</code> 和 <code>cli2</code>，通过 <code>click.CommandCollection</code> 可以将这些子命令合并在一起，将其能力提供个同一个命令程序。</p>
<p>Tips：如果多个命令组中定义了同样的子命令，那么取第一个命令组中的子命令。</p>
<h4 id="3-3-6-链式命令组-多命令"><a href="#3-3-6-链式命令组-多命令" class="headerlink" title="3.3.6 链式命令组/多命令"></a>3.3.6 链式命令组/多命令</h4><p>有时单级子命令可能满足不了你的需求，你甚至希望能有多级子命令。典型地，<code>setuptools</code> 包中就支持多级/链式子命令： <code>setup.py sdist bdist_wheel upload</code>。在 click 3.0 之后，实现链式命令组变得非常简单，只需在 <code>click.group</code> 中指定 <code>chain=True</code>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@click.group(chain=True)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">cli</span>():</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@cli.command(&#x27;sdist&#x27;)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sdist</span>():</span></span><br><span class="line">    click.echo(<span class="string">&#x27;sdist called&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@cli.command(&#x27;bdist_wheel&#x27;)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">bdist_wheel</span>():</span></span><br><span class="line">    click.echo(<span class="string">&#x27;bdist_wheel called&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>调用命令则有：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ setup.py sdist bdist_wheel</span><br><span class="line">sdist called</span><br><span class="line">bdist_wheel called</span><br></pre></td></tr></table></figure>

<h4 id="3-3-7-命令组-多命令管道"><a href="#3-3-7-命令组-多命令管道" class="headerlink" title="3.3.7 命令组/多命令管道"></a>3.3.7 命令组/多命令管道</h4><p>链式命令组中一个常见的场景就是实现管道，这样在上一个命令处理好后，可将结果传给下一个命令处理。</p>
<p>实现命令组管道的要点是让每个命令返回一个处理函数，然后编写一个总的管道调度函数（并由 <code>MultiCommand.resultcallback()</code> 装饰）：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@click.group(chain=True, invoke_without_command=True)</span></span><br><span class="line"><span class="meta">@click.option(&#x27;-i&#x27;, &#x27;--input&#x27;, type=click.File(&#x27;r&#x27;))</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">cli</span>(<span class="params">input</span>):</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@cli.resultcallback()</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">process_pipeline</span>(<span class="params">processors, input</span>):</span></span><br><span class="line">    iterator = (x.rstrip(<span class="string">&#x27;\r\n&#x27;</span>) <span class="keyword">for</span> x <span class="keyword">in</span> input)</span><br><span class="line">    <span class="keyword">for</span> processor <span class="keyword">in</span> processors:</span><br><span class="line">        iterator = processor(iterator)</span><br><span class="line">    <span class="keyword">for</span> item <span class="keyword">in</span> iterator:</span><br><span class="line">        click.echo(item)</span><br><span class="line"></span><br><span class="line"><span class="meta">@cli.command(&#x27;uppercase&#x27;)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">make_uppercase</span>():</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">processor</span>(<span class="params">iterator</span>):</span></span><br><span class="line">        <span class="keyword">for</span> line <span class="keyword">in</span> iterator:</span><br><span class="line">            <span class="keyword">yield</span> line.upper()</span><br><span class="line">    <span class="keyword">return</span> processor</span><br><span class="line"></span><br><span class="line"><span class="meta">@cli.command(&#x27;lowercase&#x27;)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">make_lowercase</span>():</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">processor</span>(<span class="params">iterator</span>):</span></span><br><span class="line">        <span class="keyword">for</span> line <span class="keyword">in</span> iterator:</span><br><span class="line">            <span class="keyword">yield</span> line.lower()</span><br><span class="line">    <span class="keyword">return</span> processor</span><br><span class="line"></span><br><span class="line"><span class="meta">@cli.command(&#x27;strip&#x27;)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">make_strip</span>():</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">processor</span>(<span class="params">iterator</span>):</span></span><br><span class="line">        <span class="keyword">for</span> line <span class="keyword">in</span> iterator:</span><br><span class="line">            <span class="keyword">yield</span> line.strip()</span><br><span class="line">    <span class="keyword">return</span> processor</span><br></pre></td></tr></table></figure>

<p>在上面的示例中：</p>
<ul>
<li>将 <code>cli</code> 定义为了链式命令组，并且指定 invoke_without_command=True，也就意味着可以不传子命令来触发命令组</li>
<li>定义了三个命令处理函数，分别对应 <code>uppercase</code>、<code>lowercase</code> 和 <code>strip</code> 命令</li>
<li>在管道调度函数 <code>process_pipeline</code> 中，将输入 <code>input</code> 变成生成器，然后调用处理函数（实际输入几个命令，就有几个处理函数）进行处理</li>
</ul>
<h4 id="3-3-8-覆盖默认值"><a href="#3-3-8-覆盖默认值" class="headerlink" title="3.3.8 覆盖默认值"></a>3.3.8 覆盖默认值</h4><p>默认情况下，参数的默认值是从通过装饰器参数 <code>default</code> 定义。我们还可以通过 <code>Context.default_map</code> 上下文字典来覆盖默认值：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@click.group()</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">cli</span>():</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@cli.command()</span></span><br><span class="line"><span class="meta">@click.option(&#x27;--port&#x27;, default=8000)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">runserver</span>(<span class="params">port</span>):</span></span><br><span class="line">    click.echo(<span class="string">&#x27;Serving on http://127.0.0.1:%d/&#x27;</span> % port)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    cli(default_map=&#123;</span><br><span class="line">        <span class="string">&#x27;runserver&#x27;</span>: &#123;</span><br><span class="line">            <span class="string">&#x27;port&#x27;</span>: <span class="number">5000</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br></pre></td></tr></table></figure>

<p>在上面的示例中，通过在 <code>cli</code> 中指定 <code>default_map</code> 变可覆盖命令（一级键）的选项（二级键）默认值（二级键的值）。</p>
<p>我们还可以在 <code>click.group</code> 中指定 <code>context_settings</code> 来达到同样的目的：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">CONTEXT_SETTINGS = dict(</span><br><span class="line">    default_map=&#123;<span class="string">&#x27;runserver&#x27;</span>: &#123;<span class="string">&#x27;port&#x27;</span>: <span class="number">5000</span>&#125;&#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="meta">@click.group(context_settings=CONTEXT_SETTINGS)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">cli</span>():</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@cli.command()</span></span><br><span class="line"><span class="meta">@click.option(&#x27;--port&#x27;, default=8000)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">runserver</span>(<span class="params">port</span>):</span></span><br><span class="line">    click.echo(<span class="string">&#x27;Serving on http://127.0.0.1:%d/&#x27;</span> % port)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    cli()</span><br></pre></td></tr></table></figure>

<p>调用命令则有：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ cli runserver</span><br><span class="line">Serving on http://127.0.0.1:5000/</span><br></pre></td></tr></table></figure>

<p>首先介绍了命令的回调调用、上下文，再进一步介绍命令组的自定义、合并、链接、管道等功能，了解到了 <code>click</code> 的强大。而命令组中更加高阶的能力（<a target="_blank" rel="noopener" href="https://click.palletsprojects.com/en/7.x/commands/#command-return-values">如命令返回值</a>）则可看官方文档进一步了解。</p>
<p>我们通过介绍 <code>click</code> 的参数、选项和命令已经能够完全实现命令行程序的所有功能。而 <code>click</code> 还为我们提供了许多锦上添花的功能，比如实用工具、参数自动补全等</p>
<h2 id="4-click增强"><a href="#4-click增强" class="headerlink" title="4 click增强"></a>4 click增强</h2><h3 id="4-1-Bash-补全"><a href="#4-1-Bash-补全" class="headerlink" title="4.1 Bash 补全"></a>4.1 Bash 补全</h3><p>Bash 补全是 <code>click</code> 提供的一个非常便捷和强大的功能，这是它比 <code>argpase</code> 和 <code>docopt</code> 强大的一个表现。</p>
<p>在命令行程序正确安装后，Bash 补全才可以使用。而如何安装可以参考 <a target="_blank" rel="noopener" href="https://click.palletsprojects.com/en/7.x/setuptools/#setuptools-integration">setup 集成</a>。Click 目前仅支持 Bash 和 Zsh 的补全。</p>
<h4 id="4-1-1-补全能力"><a href="#4-1-1-补全能力" class="headerlink" title="4.1.1 补全能力"></a>4.1.1 补全能力</h4><p>通常来说，Bash 补全支持对子命令、选项、以及选项或参数值得补全。比如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ repo &lt;TAB&gt;&lt;TAB&gt;</span><br><span class="line">clone    commit   copy     delete   setuser</span><br><span class="line">$ repo clone -&lt;TAB&gt;&lt;TAB&gt;</span><br><span class="line">--deep     --help     --rev      --shallow  -r</span><br></pre></td></tr></table></figure>

<p>此外，<code>click</code> 还支持自定义补全，这在动态生成补全场景中很有用，使用 <code>autocompletion</code> 参数。<code>autocompletion</code> 需要指定为一个回调函数，并且返回字符串的列表。此函数接受三个参数：</p>
<ul>
<li><code>ctx</code> —— 当前的 click 上下文</li>
<li><code>args</code> 传入的参数列表</li>
<li><code>incomplete</code> 正在补全的词</li>
</ul>
<p>这里有一个根据环境变量动态生成补全的示例：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_env_vars</span>(<span class="params">ctx, args, incomplete</span>):</span></span><br><span class="line">    <span class="keyword">return</span> [k <span class="keyword">for</span> k <span class="keyword">in</span> os.environ.keys() <span class="keyword">if</span> incomplete <span class="keyword">in</span> k]</span><br><span class="line"></span><br><span class="line"><span class="meta">@click.command()</span></span><br><span class="line"><span class="meta">@click.argument(&quot;envvar&quot;, type=click.STRING, autocompletion=get_env_vars)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">cmd1</span>(<span class="params">envvar</span>):</span></span><br><span class="line">    click.echo(<span class="string">&#x27;Environment variable: %s&#x27;</span> % envvar)</span><br><span class="line">    click.echo(<span class="string">&#x27;Value: %s&#x27;</span> % os.environ[envvar])</span><br></pre></td></tr></table></figure>

<p>在 <code>ZSH</code> 中，还支持补全帮助信息。只需将 <code>autocompletion</code> 回调函数中返回的字符串列表中的字符串改为二元元组，第一个元素是补全内容，第二个元素是帮助信息。</p>
<p>这里有一个颜色补全的示例：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_colors</span>(<span class="params">ctx, args, incomplete</span>):</span></span><br><span class="line">    colors = [(<span class="string">&#x27;red&#x27;</span>, <span class="string">&#x27;help string for the color red&#x27;</span>),</span><br><span class="line">              (<span class="string">&#x27;blue&#x27;</span>, <span class="string">&#x27;help string for the color blue&#x27;</span>),</span><br><span class="line">              (<span class="string">&#x27;green&#x27;</span>, <span class="string">&#x27;help string for the color green&#x27;</span>)]</span><br><span class="line">    <span class="keyword">return</span> [c <span class="keyword">for</span> c <span class="keyword">in</span> colors <span class="keyword">if</span> incomplete <span class="keyword">in</span> c[<span class="number">0</span>]]</span><br><span class="line"></span><br><span class="line"><span class="meta">@click.command()</span></span><br><span class="line"><span class="meta">@click.argument(&quot;color&quot;, type=click.STRING, autocompletion=get_colors)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">cmd1</span>(<span class="params">color</span>):</span></span><br><span class="line">    click.echo(<span class="string">&#x27;Chosen color is %s&#x27;</span> % color)</span><br></pre></td></tr></table></figure>

<h4 id="4-1-2-激活补全"><a href="#4-1-2-激活补全" class="headerlink" title="4.1.2 激活补全"></a>4.1.2 激活补全</h4><p>要激活 Bash 的补全功能，就需要告诉它你的命令行程序有补全的能力。通常通过一个神奇的环境变量 <code>__COMPLETE</code> 来告知，其中 `` 是大写下划线形式的程序名称。</p>
<p>比如有一个命令行程序叫做 <code>foo-bar</code>，那么对应的环境变量名称为 <code>_FOO_BAR_COMPLETE</code>，然后在 <code>.bashrc</code> 中使用 <code>source</code> 导出即可：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">eval</span> <span class="string">&quot;<span class="subst">$(_FOO_BAR_COMPLETE=source foo-bar)</span>&quot;</span></span><br></pre></td></tr></table></figure>

<p>或者在 <code>.zshrc</code> 中使用：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">eval</span> <span class="string">&quot;<span class="subst">$(_FOO_BAR_COMPLETE=source_zsh foo-bar)</span>&quot;</span></span><br></pre></td></tr></table></figure>

<p>不过上面的方式总是在命令行程序启动时调用，这可能在有多个程序时减慢 shell 激活的速度。另一种方式是把命令放在文件中，就像这样：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 针对 Bash</span></span><br><span class="line">_FOO_BAR_COMPLETE=<span class="built_in">source</span> foo-bar &gt; foo-bar-complete.sh</span><br><span class="line"></span><br><span class="line"><span class="comment"># 针对 ZSH</span></span><br><span class="line">_FOO_BAR_COMPLETE=source_zsh foo-bar &gt; foo-bar-complete.sh</span><br></pre></td></tr></table></figure>

<p>然后把脚本文件路径加到 <code>.bashrc</code> 或 <code>.zshrc</code> 中：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">. /path/to/foo-bar-complete.sh</span><br></pre></td></tr></table></figure>

<h3 id="2-实用工具"><a href="#2-实用工具" class="headerlink" title=".2 实用工具"></a>.2 实用工具</h3><h4 id="4-2-1-打印到标准输出"><a href="#4-2-1-打印到标准输出" class="headerlink" title="4.2.1 打印到标准输出"></a>4.2.1 打印到标准输出</h4><p><a target="_blank" rel="noopener" href="https://click.palletsprojects.com/en/7.x/api/#click.echo">echo()</a> 函数可以说是最有用的实用工具了。它和 Python 的 <code>print</code> 类似，主要的区别在于它同时在 Python 2 和 3 中生效，能够智能地检测未配置正确的输出流，且几乎不会失败（除了 Python 3 中的<a target="_blank" rel="noopener" href="https://click.palletsprojects.com/en/7.x/python3/#python3-limitations">少数限制</a>。）</p>
<p><code>echo</code> 即支持 unicode，也支持二级制数据，如：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> click</span><br><span class="line"></span><br><span class="line">click.echo(<span class="string">&#x27;Hello World!&#x27;</span>)</span><br><span class="line"></span><br><span class="line">click.echo(<span class="string">b&#x27;\xe2\x98\x83&#x27;</span>, nl=<span class="literal">False</span>) <span class="comment"># nl=False 表示不输出换行符</span></span><br></pre></td></tr></table></figure>

<h4 id="4-2-2-ANSI-颜色"><a href="#4-2-2-ANSI-颜色" class="headerlink" title="4.2.2 ANSI 颜色"></a>4.2.2 ANSI 颜色</h4><p>有些时候你可能希望输出是有颜色的，这尤其在输出错误信息时有用，而 <code>click</code> 在这方面支持的很好。</p>
<p>首先，你需要安装 <code>colorama</code>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install colorama</span><br></pre></td></tr></table></figure>

<p>然后，就可以使用 <a target="_blank" rel="noopener" href="https://click.palletsprojects.com/en/7.x/api/#click.style">style()</a> 函数来指定颜色：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> click</span><br><span class="line"></span><br><span class="line">click.echo(click.style(<span class="string">&#x27;Hello World!&#x27;</span>, fg=<span class="string">&#x27;green&#x27;</span>))</span><br><span class="line">click.echo(click.style(<span class="string">&#x27;Some more text&#x27;</span>, bg=<span class="string">&#x27;blue&#x27;</span>, fg=<span class="string">&#x27;white&#x27;</span>))</span><br><span class="line">click.echo(click.style(<span class="string">&#x27;ATTENTION&#x27;</span>, blink=<span class="literal">True</span>, bold=<span class="literal">True</span>))</span><br></pre></td></tr></table></figure>

<p><code>click</code> 还提供了更加简便的函数 <a target="_blank" rel="noopener" href="https://click.palletsprojects.com/en/7.x/api/#click.secho">secho</a>，它就是 <code>echo</code> 和 <code>style</code> 的组合：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">click.secho(<span class="string">&#x27;Hello World!&#x27;</span>, fg=<span class="string">&#x27;green&#x27;</span>)</span><br><span class="line">click.secho(<span class="string">&#x27;Some more text&#x27;</span>, bg=<span class="string">&#x27;blue&#x27;</span>, fg=<span class="string">&#x27;white&#x27;</span>)</span><br><span class="line">click.secho(<span class="string">&#x27;ATTENTION&#x27;</span>, blink=<span class="literal">True</span>, bold=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>

<h4 id="2-3-分页支持"><a href="#2-3-分页支持" class="headerlink" title=".2.3 分页支持"></a>.2.3 分页支持</h4><p>有些时候，命令行程序会输出长文本，但你希望能让用户盘也浏览。使用 <a target="_blank" rel="noopener" href="https://click.palletsprojects.com/en/7.x/api/#click.echo_via_pager">echo_via_pager()</a> 函数就可以轻松做到。</p>
<p>例如：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">less</span>():</span></span><br><span class="line">    click.echo_via_pager(<span class="string">&#x27;\n&#x27;</span>.join(<span class="string">&#x27;Line %d&#x27;</span> % idx</span><br><span class="line">                                   <span class="keyword">for</span> idx <span class="keyword">in</span> range(<span class="number">200</span>)))</span><br></pre></td></tr></table></figure>

<p>如果输出的文本特别大，处于性能的考虑，希望翻页时生成对应内容，那么就可以使用生成器：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_generate_output</span>():</span></span><br><span class="line">    <span class="keyword">for</span> idx <span class="keyword">in</span> range(<span class="number">50000</span>):</span><br><span class="line">        <span class="keyword">yield</span> <span class="string">&quot;Line %d\n&quot;</span> % idx</span><br><span class="line"></span><br><span class="line"><span class="meta">@click.command()</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">less</span>():</span></span><br><span class="line">    click.echo_via_pager(_generate_output())</span><br></pre></td></tr></table></figure>

<h4 id="4-2-4-清除屏幕"><a href="#4-2-4-清除屏幕" class="headerlink" title="4.2.4 清除屏幕"></a>4.2.4 清除屏幕</h4><p>使用 <a target="_blank" rel="noopener" href="https://click.palletsprojects.com/en/7.x/api/#click.clear">clear()</a> 可以轻松清除屏幕内容：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> click</span><br><span class="line">click.clear()</span><br></pre></td></tr></table></figure>

<h4 id="2-5-从终端获取字符"><a href="#2-5-从终端获取字符" class="headerlink" title=".2.5 从终端获取字符"></a>.2.5 从终端获取字符</h4><p>通常情况下，使用内建函数 <code>input</code> 或 <code>raw_input</code> 获得的输入是用户输出一段字符然后回车得到的。但在有些场景下，你可能想在用户输入单个字符时就能获取到并且做一定的处理，这个时候 <a target="_blank" rel="noopener" href="https://click.palletsprojects.com/en/7.x/api/#click.getchar">getchar()</a> 就派上了用场。</p>
<p>比如，根据输入的 <code>y</code> 或 <code>n</code> 做特定处理：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> click</span><br><span class="line"></span><br><span class="line">click.echo(<span class="string">&#x27;Continue? [yn] &#x27;</span>, nl=<span class="literal">False</span>)</span><br><span class="line">c = click.getchar()</span><br><span class="line">click.echo()</span><br><span class="line"><span class="keyword">if</span> c == <span class="string">&#x27;y&#x27;</span>:</span><br><span class="line">    click.echo(<span class="string">&#x27;We will go on&#x27;</span>)</span><br><span class="line"><span class="keyword">elif</span> c == <span class="string">&#x27;n&#x27;</span>:</span><br><span class="line">    click.echo(<span class="string">&#x27;Abort!&#x27;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    click.echo(<span class="string">&#x27;Invalid input :(&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h4 id="4-2-6-等待按键"><a href="#4-2-6-等待按键" class="headerlink" title="4.2.6 等待按键"></a>4.2.6 等待按键</h4><p>在 Windows 的 cmd 中我们经常看到当执行完一个命令后，提示按下任意键退出。通过使用 <a target="_blank" rel="noopener" href="https://click.palletsprojects.com/en/7.x/api/#click.pause">pause()</a> 可以实现暂停直至用户按下任意键：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> click</span><br><span class="line">click.pause()</span><br></pre></td></tr></table></figure>

<h4 id="4-2-7-启动编辑器"><a href="#4-2-7-启动编辑器" class="headerlink" title="4.2.7 启动编辑器"></a>4.2.7 启动编辑器</h4><p>通过 <a target="_blank" rel="noopener" href="https://click.palletsprojects.com/en/7.x/api/#click.edit">edit()</a> 可以自动启动编辑器。这在需要用户输入多行内容时十分有用。</p>
<p>在下面的示例中，会启动默认的文本编辑器，并在里面输入一段话：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> click</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_commit_message</span>():</span></span><br><span class="line">    MARKER = <span class="string">&#x27;# Everything below is ignored\n&#x27;</span></span><br><span class="line">    message = click.edit(<span class="string">&#x27;\n\n&#x27;</span> + MARKER)</span><br><span class="line">    <span class="keyword">if</span> message <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">        <span class="keyword">return</span> message.split(MARKER, <span class="number">1</span>)[<span class="number">0</span>].rstrip(<span class="string">&#x27;\n&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p><code>edit()</code> 函数还支持打开特定文件，比如：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> click</span><br><span class="line">click.edit(filename=<span class="string">&#x27;/etc/passwd&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h4 id="2-8-启动应用程序"><a href="#2-8-启动应用程序" class="headerlink" title=".2.8 启动应用程序"></a>.2.8 启动应用程序</h4><p>通过 <a target="_blank" rel="noopener" href="https://click.palletsprojects.com/en/7.x/api/#click.launch">launch</a> 可以打开 URL 或文件类型所关联的默认应用程序。如果设置 <code>locate=True</code>，则可以启动文件管理器并自动选中特定文件。</p>
<p>示例：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 打开浏览器，访问 URL</span></span><br><span class="line">click.launch(<span class="string">&quot;https://click.palletsprojects.com/&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用默认应用程序打开 txt 文件</span></span><br><span class="line">click.launch(<span class="string">&quot;/my/downloaded/file.txt&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 打开文件管理器，并自动选中 file.txt</span></span><br><span class="line">click.launch(<span class="string">&quot;/my/downloaded/file.txt&quot;</span>, locate=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>

<h4 id="4-2-9-显示进度条"><a href="#4-2-9-显示进度条" class="headerlink" title="4.2.9 显示进度条"></a>4.2.9 显示进度条</h4><p><code>click</code> 内置了 <a target="_blank" rel="noopener" href="https://click.palletsprojects.com/en/7.x/api/#click.progressbar">progressbar()</a> 函数来方便地显示进度条。</p>
<p>它的用法也很简单，假定你有一个要处理的可迭代对象，处理完每一项就要输出一下进度，那么就有两种用法。</p>
<p>用法一：使用 <code>progressbar</code> 构造出 <code>bar</code> 对象，迭代 <code>bar</code> 对象来自动告知进度：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> click</span><br><span class="line"></span><br><span class="line">all_the_users_to_process = [<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">modify_the_user</span>(<span class="params">user</span>):</span></span><br><span class="line">    time.sleep(<span class="number">0.5</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> click.progressbar(all_the_users_to_process) <span class="keyword">as</span> bar:</span><br><span class="line">    <span class="keyword">for</span> user <span class="keyword">in</span> bar:</span><br><span class="line">        modify_the_user(user)</span><br></pre></td></tr></table></figure>

<p>用法二：使用 <code>progressbar</code> 构造出 <code>bar</code> 对象，迭代原始可迭代对象，并不断向 <code>bar</code> 更新进度：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> click</span><br><span class="line"></span><br><span class="line">all_the_users_to_process = [<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">modify_the_user</span>(<span class="params">user</span>):</span></span><br><span class="line">    time.sleep(<span class="number">0.5</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> click.progressbar(all_the_users_to_process) <span class="keyword">as</span> bar:</span><br><span class="line">    <span class="keyword">for</span> user <span class="keyword">in</span> enumerate(all_the_users_to_process):</span><br><span class="line">        modify_the_user(user)</span><br><span class="line">        bar.update(<span class="number">1</span>)</span><br></pre></td></tr></table></figure>

<h4 id="4-2-10-更多实用工具"><a href="#4-2-10-更多实用工具" class="headerlink" title="4.2.10 更多实用工具"></a>4.2.10 更多实用工具</h4><ul>
<li><a target="_blank" rel="noopener" href="https://click.palletsprojects.com/en/7.x/utils/#printing-filenames">打印文件名</a></li>
<li><a target="_blank" rel="noopener" href="https://click.palletsprojects.com/en/7.x/utils/#standard-streams">标准流</a></li>
<li><a target="_blank" rel="noopener" href="https://click.palletsprojects.com/en/7.x/utils/#intelligent-file-opening">智能打开文件</a></li>
<li><a target="_blank" rel="noopener" href="https://click.palletsprojects.com/en/7.x/utils/#finding-application-folders">查找应用程序文件夹</a></li>
</ul>
<h2 id="5-总结"><a href="#5-总结" class="headerlink" title="5 总结"></a>5 总结</h2><p><code>click</code> 提供了非常多的增强型功能，本文着重介绍了它的 Bash 补全和十多个实用工具，这会让你在实现命令行的过程中如虎添翼。此外，<code>click</code> 还提供了诸如命令别名、参数修改、标准化令牌、调用其他命令、回调顺序等诸多<a target="_blank" rel="noopener" href="https://click.palletsprojects.com/en/7.x/advanced/">高级模式</a> 以应对更加复杂或特定的场景，我就不再深入介绍。</p>
<h2 id="6-实战"><a href="#6-实战" class="headerlink" title="6 实战"></a>6 实战</h2><h2 id="6-1-使用click实现调用Java的jar包"><a href="#6-1-使用click实现调用Java的jar包" class="headerlink" title="6.1 使用click实现调用Java的jar包"></a>6.1 使用click实现调用Java的jar包</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="comment">#coding:utf-8</span></span><br><span class="line"><span class="keyword">import</span> click</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> getpass</span><br><span class="line"></span><br><span class="line"><span class="comment"># java -classpath table-meta-1.0-SNAPSHOT.jar com.lx.dw.utils.Runner -m lineage -r /Users/manzhong/Downloads/warehouse-master/dol</span></span><br><span class="line"><span class="comment"># &quot;/data/dwdev/job-manager-1.0-SNAPSHOT-jar-with-dependencies.jar&quot;</span></span><br><span class="line">jar = <span class="string">&quot;/data/dwdev/job-manager-1.0-SNAPSHOT-jar-with-dependencies.jar&quot;</span></span><br><span class="line">classname = <span class="string">&quot;com.lx.dw.job.Runner&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">jartab = <span class="string">&quot;/data/dwdev/table-meta-1.0-SNAPSHOT.jar&quot;</span></span><br><span class="line">classnametab = <span class="string">&quot;com.lx.dw.utils.Runner&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">hdfspath=&#123;<span class="string">&#x27;lx&#x27;</span>:<span class="string">&#x27;/user/dwdev/sqlScript&#x27;</span>,<span class="string">&#x27;wm&#x27;</span>:<span class="string">&#x27;/user/dwdev/wmsqlScript&#x27;</span>&#125;</span><br><span class="line">gitpath=&#123;<span class="string">&#x27;lx&#x27;</span>:<span class="string">&#x27;dol&#x27;</span>,<span class="string">&#x27;wm&#x27;</span>:<span class="string">&#x27;wmdol&#x27;</span>&#125;</span><br><span class="line">project=&#123;<span class="string">&#x27;lx&#x27;</span>:<span class="string">&#x27;warehouse/dol/&#x27;</span>,<span class="string">&#x27;wm&#x27;</span>:<span class="string">&#x27;warehouse/wmdol/&#x27;</span>&#125;</span><br><span class="line">db=&#123;<span class="string">&#x27;lx&#x27;</span>:<span class="string">&#x27;dw&#x27;</span>,<span class="string">&#x27;wm&#x27;</span>:<span class="string">&#x27;wmdw&#x27;</span>&#125;</span><br><span class="line"><span class="meta">@click.group()</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">begin</span>():</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@click.command()</span></span><br><span class="line"><span class="meta">@click.option(&quot;--filename&quot;,&quot;-f&quot;,default=&quot;git filename&quot;,prompt=&#x27;INPUT FILENAME:&#x27;,help=&quot;文件名&quot;)</span></span><br><span class="line"><span class="meta">@click.option(&quot;--projecttype&quot;,&quot;-s&quot;,type=click.Choice([&#x27;lx&#x27;, &#x27;wm&#x27;], case_sensitive=False),prompt=&#x27;INPUT wm or lx:&#x27;,help=&quot;项目类型&quot;)</span></span><br><span class="line"><span class="meta">@click.option(&quot;--type&quot;,&quot;-g&quot;,default=False,type=bool,prompt=&#x27;Input true or false(Publish to hdfs or not):&#x27;,help=&quot;是否上传&quot;)</span></span><br><span class="line"><span class="meta">@click.option(&quot;--parse&quot;,&quot;-p&quot;,default=True,type=bool,prompt=&#x27;Input true or false(Parse  blood or not):&#x27;,help=&quot;是否解析血缘关系&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">publish</span>(<span class="params">filename,type,projecttype,parse</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;This script:git to hdfs&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">if</span> parse==<span class="literal">True</span>:</span><br><span class="line">        dirs=<span class="string">&quot;/home/&quot;</span>+getpass.getuser()+<span class="string">&quot;/&quot;</span></span><br><span class="line">        indb=<span class="literal">True</span></span><br><span class="line">        bloodparsedef(dirs,projecttype,filename,indb)</span><br><span class="line">    <span class="keyword">if</span> type==<span class="literal">True</span>:</span><br><span class="line">        print(<span class="string">&quot;dwtools publish --filename=&quot;</span> + <span class="string">&quot;&#123;&#125;&quot;</span>.format(filename) + <span class="string">&quot; --projecttype=&quot;</span> + <span class="string">&quot;&#123;&#125;&quot;</span>.format(projecttype) +<span class="string">&quot; --type=true&quot;</span>)</span><br><span class="line">        command = <span class="string">&quot;java -classpath&quot;</span>+<span class="string">&quot; &quot;</span>+ jar +<span class="string">&quot; &quot;</span> +classname</span><br><span class="line">        arg0=<span class="string">&quot;-m&quot;</span></span><br><span class="line">        arg1=<span class="string">&quot;download&quot;</span></span><br><span class="line">        arg2=<span class="string">&quot;-f&quot;</span></span><br><span class="line">        arg3=<span class="string">&quot;&#123;&#125;&quot;</span>.format(filename)</span><br><span class="line">        arg4=<span class="string">&quot;-k&quot;</span></span><br><span class="line">        arg5=os.getenv(<span class="string">&#x27;TOKEN&#x27;</span>)</span><br><span class="line">        arg6=<span class="string">&quot;-s&quot;</span></span><br><span class="line">        arg7=hdfspath[projecttype]</span><br><span class="line">        arg8=<span class="string">&quot;-i&quot;</span></span><br><span class="line">        arg9=gitpath[projecttype]</span><br><span class="line">        arg10=<span class="string">&quot;-g&quot;</span></span><br><span class="line">        cmd = [command,arg0,arg1,arg2,arg3,arg4,arg5,arg6,arg7,arg8,arg9,arg10]</span><br><span class="line">        new_cmd = <span class="string">&quot; &quot;</span>.join(cmd)</span><br><span class="line">        f = os.popen(new_cmd)</span><br><span class="line">        d = f.read()</span><br><span class="line">        print(d)</span><br><span class="line">        f.close</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print(<span class="string">&quot;dwtools publish --filename=&quot;</span> + <span class="string">&quot;&#123;&#125;&quot;</span>.format(filename) + <span class="string">&quot; --projecttype=&quot;</span> + <span class="string">&quot;&#123;&#125;&quot;</span>.format(projecttype) + <span class="string">&quot; --type=false&quot;</span>)</span><br><span class="line">        command = <span class="string">&quot;java -classpath&quot;</span>+<span class="string">&quot; &quot;</span>+ jar +<span class="string">&quot; &quot;</span> +classname</span><br><span class="line">        arg0=<span class="string">&quot;-m&quot;</span></span><br><span class="line">        arg1=<span class="string">&quot;download&quot;</span></span><br><span class="line">        arg2=<span class="string">&quot;-f&quot;</span></span><br><span class="line">        arg3=<span class="string">&quot;&#123;&#125;&quot;</span>.format(filename)</span><br><span class="line">        arg4=<span class="string">&quot;-k&quot;</span></span><br><span class="line">        arg5=os.getenv(<span class="string">&#x27;TOKEN&#x27;</span>)</span><br><span class="line">        arg6=<span class="string">&quot;-s&quot;</span></span><br><span class="line">        arg7=hdfspath[projecttype]</span><br><span class="line">        arg8=<span class="string">&quot;-i&quot;</span></span><br><span class="line">        arg9=gitpath[projecttype]</span><br><span class="line">        cmd = [command,arg0,arg1,arg2,arg3,arg4,arg5,arg6,arg7,arg8,arg9]</span><br><span class="line">        new_cmd = <span class="string">&quot; &quot;</span>.join(cmd)</span><br><span class="line">        f = os.popen(new_cmd)</span><br><span class="line">        d = f.read()</span><br><span class="line">        print(d)</span><br><span class="line">        f.close</span><br><span class="line"><span class="comment"># sql测试运行</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@click.command()</span></span><br><span class="line"><span class="meta">@click.option(&quot;--dir&quot;,&quot;-d&quot;,default=&quot;/home/&quot;+getpass.getuser()+&quot;/&quot;,prompt=&#x27;Personal home directory&#x27;,help=&quot;用户主目录&quot;)</span></span><br><span class="line"><span class="meta">@click.option(&quot;--projecttype&quot;,&quot;-s&quot;,type=click.Choice([&#x27;lx&#x27;, &#x27;wm&#x27;], case_sensitive=False),prompt=&#x27;INPUT wm or lx:&#x27;,help=&quot;项目类型&quot;)</span></span><br><span class="line"><span class="meta">@click.option(&quot;--filename&quot;,&quot;-f&quot;,prompt=&#x27;Hql File[Example xxx.sql]:&#x27;,help=&quot;文件名:&quot;)</span></span><br><span class="line"><span class="meta">@click.option(&#x27;--message&#x27;, &#x27;-p&#x27;,prompt=&quot;Input parameters,[Example k:v,k:v]:&quot;,help=&quot;参数list&quot;)</span></span><br><span class="line"><span class="meta">@click.option(&quot;--engine&quot;,&quot;-e&quot;,type=click.Choice([&#x27;spark&#x27;,&#x27;hive&#x27;],case_sensitive=False),prompt=&#x27;INPUT spark or hive:&#x27;,help=&quot;执行sparksql或者hivesql&quot;)</span></span><br><span class="line"><span class="meta">@click.option(&quot;--type&quot;,&quot;-g&quot;,default=False,type=bool,prompt=&#x27;Input true or false(Run task or only check syntax):&#x27;,help=&quot;测试环境运行 or 语法检测&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">runJob</span>(<span class="params">dir,projecttype,filename,message,engine,type</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;This script:sql解析&quot;&quot;&quot;</span></span><br><span class="line">    command = <span class="string">&quot;java -classpath&quot;</span>+<span class="string">&quot; &quot;</span>+ jar +<span class="string">&quot; &quot;</span> +classname</span><br><span class="line">    localpath=<span class="string">&quot;&#123;&#125;&quot;</span>.format(dir)+project[projecttype]+<span class="string">&quot;&#123;&#125;&quot;</span>.format(filename)</span><br><span class="line">    <span class="keyword">print</span> (localpath)</span><br><span class="line">    <span class="keyword">if</span> type==<span class="literal">True</span>:</span><br><span class="line">        print(<span class="string">&quot;dwtools runjob --dir=&quot;</span> + <span class="string">&quot;&#123;&#125;&quot;</span>.format(dir) + <span class="string">&quot; --projecttype=&quot;</span> + <span class="string">&quot;&#123;&#125;&quot;</span>.format(projecttype) + <span class="string">&quot; --filename=&quot;</span> + <span class="string">&quot;&#123;&#125;&quot;</span>.format(filename) +<span class="string">&quot; --message=&quot;</span>+<span class="string">&quot;&#123;&#125;&quot;</span>.format(message) + <span class="string">&quot; --engine=&quot;</span> + <span class="string">&quot;&#123;&#125;&quot;</span>.format(engine) +  <span class="string">&quot; --type=true&quot;</span>)</span><br><span class="line">        arg0=<span class="string">&quot;-m&quot;</span></span><br><span class="line">        arg1=<span class="string">&quot;parse&quot;</span></span><br><span class="line">        arg2=<span class="string">&quot;-l&quot;</span></span><br><span class="line">        arg3=localpath</span><br><span class="line">        arg4=<span class="string">&quot;-p&quot;</span></span><br><span class="line">        arg5=<span class="string">&#x27;&#123;&#125;&#x27;</span>.format(message)</span><br><span class="line">        arg6=<span class="string">&quot;-e&quot;</span></span><br><span class="line">        arg7=<span class="string">&#x27;&#123;&#125;&#x27;</span>.format(engine)</span><br><span class="line">        arg8=<span class="string">&quot;-g&quot;</span></span><br><span class="line">        cmd = [command,arg0,arg1,arg2,arg3,arg4,arg5,arg6,arg7,arg8]</span><br><span class="line">        new_cmd = <span class="string">&quot; &quot;</span>.join(cmd)</span><br><span class="line">        f = os.popen(new_cmd)</span><br><span class="line">        d = f.read()</span><br><span class="line">        print(d)</span><br><span class="line">        f.close</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="comment"># properties=&#x27;,&#x27;.join(message)</span></span><br><span class="line">        print(<span class="string">&quot;dwtools runjob --dir=&quot;</span> + <span class="string">&quot;&#123;&#125;&quot;</span>.format(dir) + <span class="string">&quot; --projecttype=&quot;</span> + <span class="string">&quot;&#123;&#125;&quot;</span>.format(projecttype) + <span class="string">&quot; --filename=&quot;</span> + <span class="string">&quot;&#123;&#125;&quot;</span>.format(filename) + <span class="string">&quot; --message=&quot;</span> + <span class="string">&quot;&#123;&#125;&quot;</span>.format(message) + <span class="string">&quot; --engine=&quot;</span> + <span class="string">&quot;&#123;&#125;&quot;</span>.format(engine) + <span class="string">&quot; --type=false&quot;</span>)</span><br><span class="line">        arg0=<span class="string">&quot;-m&quot;</span></span><br><span class="line">        arg1=<span class="string">&quot;parse&quot;</span></span><br><span class="line">        arg2=<span class="string">&quot;-l&quot;</span></span><br><span class="line">        arg3=localpath</span><br><span class="line">        arg4=<span class="string">&quot;-p&quot;</span></span><br><span class="line">        arg5=<span class="string">&#x27;&#123;&#125;&#x27;</span>.format(message)</span><br><span class="line">        arg6=<span class="string">&quot;-e&quot;</span></span><br><span class="line">        arg7=<span class="string">&#x27;&#123;&#125;&#x27;</span>.format(engine)</span><br><span class="line">        cmd = [command,arg0,arg1,arg2,arg3,arg4,arg5,arg6,arg7]</span><br><span class="line">        new_cmd = <span class="string">&quot; &quot;</span>.join(cmd)</span><br><span class="line">        f = os.popen(new_cmd)</span><br><span class="line">        d = f.read()</span><br><span class="line">        print(d)</span><br><span class="line">        f.close</span><br><span class="line"></span><br><span class="line"><span class="meta">@click.command()</span></span><br><span class="line"><span class="meta">@click.option(&quot;--dir&quot;,&quot;-d&quot;,default=&quot;/home/&quot;+getpass.getuser()+&quot;/&quot;,prompt=&#x27;Personal home directory&#x27;,help=&quot;用户主目录&quot;)</span></span><br><span class="line"><span class="meta">@click.option(&quot;--projecttype&quot;,&quot;-s&quot;,type=click.Choice([&#x27;lx&#x27;, &#x27;wm&#x27;], case_sensitive=False),prompt=&#x27;INPUT wm or lx:&#x27;,help=&quot;项目类型&quot;)</span></span><br><span class="line"><span class="meta">@click.option(&quot;--filename&quot;,&quot;-f&quot;,prompt=&#x27;Hql File[Example xxx.sql]:&#x27;,help=&quot;文件名:&quot;)</span></span><br><span class="line"><span class="meta">@click.option(&quot;--indb&quot;,default=True,type=bool,prompt=&#x27;Input true or false(insert to mysql or only display result ):&#x27;,help=&quot;是否入库 or 只显示结果&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">bloodparse</span>(<span class="params">dir,projecttype,filename,indb</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;This script:血缘关系解析&quot;&quot;&quot;</span></span><br><span class="line">    command = <span class="string">&quot;java -classpath&quot;</span>+<span class="string">&quot; &quot;</span>+ jartab +<span class="string">&quot; &quot;</span> +classnametab</span><br><span class="line">    parsepath=<span class="string">&quot;&#123;&#125;&quot;</span>.format(dir)+project[projecttype]+<span class="string">&quot;&#123;&#125;&quot;</span>.format(filename)</span><br><span class="line">    <span class="keyword">if</span> os.path.isdir(parsepath):</span><br><span class="line">        <span class="keyword">if</span> indb==<span class="literal">True</span>:</span><br><span class="line">            print(<span class="string">&quot;dwtools bloodparse --dir=&quot;</span> + <span class="string">&quot;&#123;&#125;&quot;</span>.format(dir) + <span class="string">&quot; --projecttype=&quot;</span> + <span class="string">&quot;&#123;&#125;&quot;</span>.format(projecttype) + <span class="string">&quot; --filename=&quot;</span> + <span class="string">&quot;&#123;&#125;&quot;</span>.format(filename) +  <span class="string">&quot; --indb=true&quot;</span>)</span><br><span class="line">            arg0=<span class="string">&quot;-m&quot;</span></span><br><span class="line">            arg1=<span class="string">&quot;lineage&quot;</span></span><br><span class="line">            arg2=<span class="string">&quot;-r&quot;</span></span><br><span class="line">            arg3=parsepath</span><br><span class="line">            arg4=<span class="string">&quot;-g&quot;</span></span><br><span class="line">            arg5=<span class="string">&quot;-d&quot;</span></span><br><span class="line">            arg6=db[projecttype]</span><br><span class="line">            cmd = [command,arg0,arg1,arg2,arg3,arg4,arg5,arg6]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            print(<span class="string">&quot;dwtools bloodparse --dir=&quot;</span> + <span class="string">&quot;&#123;&#125;&quot;</span>.format(dir) + <span class="string">&quot; --projecttype=&quot;</span> + <span class="string">&quot;&#123;&#125;&quot;</span>.format(projecttype) + <span class="string">&quot; --filename=&quot;</span> + <span class="string">&quot;&#123;&#125;&quot;</span>.format(filename) + <span class="string">&quot; --indb=false&quot;</span>)</span><br><span class="line">            arg0=<span class="string">&quot;-m&quot;</span></span><br><span class="line">            arg1=<span class="string">&quot;lineage&quot;</span></span><br><span class="line">            arg2=<span class="string">&quot;-r&quot;</span></span><br><span class="line">            arg3=parsepath</span><br><span class="line">            arg4=<span class="string">&quot;-d&quot;</span></span><br><span class="line">            arg5=db[projecttype]</span><br><span class="line">            cmd = [command,arg0,arg1,arg2,arg3,arg4,arg5]</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">if</span> indb==<span class="literal">True</span>:</span><br><span class="line">            print(<span class="string">&quot;dwtools bloodparse --dir=&quot;</span> + <span class="string">&quot;&#123;&#125;&quot;</span>.format(dir) + <span class="string">&quot; --projecttype=&quot;</span> + <span class="string">&quot;&#123;&#125;&quot;</span>.format(projecttype) + <span class="string">&quot; --filename=&quot;</span> + <span class="string">&quot;&#123;&#125;&quot;</span>.format(filename) + <span class="string">&quot; --indb=true&quot;</span>)</span><br><span class="line">            arg0=<span class="string">&quot;-m&quot;</span></span><br><span class="line">            arg1=<span class="string">&quot;lineage&quot;</span></span><br><span class="line">            arg2=<span class="string">&quot;-f&quot;</span></span><br><span class="line">            arg3=parsepath</span><br><span class="line">            arg4=<span class="string">&quot;-g&quot;</span></span><br><span class="line">            arg5=<span class="string">&quot;-d&quot;</span></span><br><span class="line">            arg6=db[projecttype]</span><br><span class="line">            cmd = [command,arg0,arg1,arg2,arg3,arg4,arg5,arg6]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            print(<span class="string">&quot;dwtools bloodparse --dir=&quot;</span> + <span class="string">&quot;&#123;&#125;&quot;</span>.format(dir) + <span class="string">&quot; --projecttype=&quot;</span> + <span class="string">&quot;&#123;&#125;&quot;</span>.format(projecttype) + <span class="string">&quot; --filename=&quot;</span> + <span class="string">&quot;&#123;&#125;&quot;</span>.format(filename) + <span class="string">&quot; --indb=false&quot;</span>)</span><br><span class="line">            arg0=<span class="string">&quot;-m&quot;</span></span><br><span class="line">            arg1=<span class="string">&quot;lineage&quot;</span></span><br><span class="line">            arg2=<span class="string">&quot;-f&quot;</span></span><br><span class="line">            arg3=parsepath</span><br><span class="line">            arg4=<span class="string">&quot;-d&quot;</span></span><br><span class="line">            arg5=db[projecttype]</span><br><span class="line">            cmd = [command,arg0,arg1,arg2,arg3,arg4,arg5]</span><br><span class="line">    new_cmd = <span class="string">&quot; &quot;</span>.join(cmd)</span><br><span class="line">    f = os.popen(new_cmd)</span><br><span class="line">    d = f.read()</span><br><span class="line">    print(d)</span><br><span class="line">    f.close</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#  &quot;-m&quot;,&quot;table&quot;,&quot;-d&quot;,&quot;dw&quot;,&quot;-t&quot;,&quot;mid_health_effective_movement_aggr_user_ss&quot;,&quot;-s&quot;,&quot;health&quot;,&quot;-o&quot;,&quot;yujing.zou&quot;</span></span><br><span class="line"><span class="meta">@click.command()</span></span><br><span class="line"><span class="meta">@click.option(&quot;--db&quot;,type=click.Choice([&#x27;dw&#x27;, &#x27;wmdw&#x27;], case_sensitive=False),prompt=&#x27;INPUT DB:&#x27;,help=&quot;库名&quot;)</span></span><br><span class="line"><span class="meta">@click.option(&quot;--tablename&quot;,default=&quot;table name&quot;,prompt=&#x27;INPUT TABLE NAME:&#x27;,help=&quot;表名&quot;)</span></span><br><span class="line"><span class="meta">@click.option(&quot;--topicname&quot;,default=&quot;topic name&quot;,prompt=&#x27;INPUT TOPIC NAME&#x27;,help=&quot;主题名&quot;)</span></span><br><span class="line"><span class="meta">@click.option(&quot;--indb&quot;,default=True,type=bool,prompt=&#x27;Input true or false(insert to mysql or only display result ):&#x27;,help=&quot;是否入库 or 只显示结果&quot;)</span></span><br><span class="line"><span class="meta">@click.option(&quot;--on&quot;,default=&quot;yujing.zou&quot;,prompt=&#x27;INPUT First responsible person:&#x27;,help=&quot;第一责任人&quot;)</span></span><br><span class="line"><span class="meta">@click.option(&quot;--bn&quot;,default=&quot;hongfei.yang&quot;,prompt=&#x27;INPUT Second responsible person:&#x27;,help=&quot;第二责任人&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">metastore</span>(<span class="params">db,tablename,topicname,indb,on,bn</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;This script:元数据录入&quot;&quot;&quot;</span></span><br><span class="line">    command = <span class="string">&quot;java -classpath&quot;</span>+<span class="string">&quot; &quot;</span>+ jartab +<span class="string">&quot; &quot;</span> +classnametab</span><br><span class="line">    <span class="keyword">if</span> indb==<span class="literal">True</span>:</span><br><span class="line">        print(<span class="string">&quot;dwtools metastore --db=&quot;</span> + <span class="string">&quot;&#123;&#125;&quot;</span>.format(db) + <span class="string">&quot; --tablename=&quot;</span> + <span class="string">&quot;&#123;&#125;&quot;</span>.format(</span><br><span class="line">            tablename) + <span class="string">&quot; --topicname=&quot;</span> + <span class="string">&quot;&#123;&#125;&quot;</span>.format(topicname) + <span class="string">&quot; --indb=true&quot;</span>+<span class="string">&quot; --on=&quot;</span>+<span class="string">&quot;&#123;&#125;&quot;</span>.format(on)+<span class="string">&quot; --bn=&quot;</span>+<span class="string">&quot;&#123;&#125;&quot;</span>.format(bn))</span><br><span class="line">        arg0=<span class="string">&quot;-m&quot;</span></span><br><span class="line">        arg1=<span class="string">&quot;table&quot;</span></span><br><span class="line">        arg2=<span class="string">&quot;-d&quot;</span></span><br><span class="line">        arg3=<span class="string">&quot;&#123;&#125;&quot;</span>.format(db)</span><br><span class="line">        arg4=<span class="string">&quot;-t&quot;</span></span><br><span class="line">        arg5=<span class="string">&quot;&#123;&#125;&quot;</span>.format(tablename)</span><br><span class="line">        arg6=<span class="string">&quot;-s&quot;</span></span><br><span class="line">        arg7=<span class="string">&quot;&#123;&#125;&quot;</span>.format(topicname)</span><br><span class="line">        arg8=<span class="string">&quot;-g&quot;</span></span><br><span class="line">        arg9=<span class="string">&quot;-o&quot;</span></span><br><span class="line">        arg10=<span class="string">&quot;&#123;&#125;&quot;</span>.format(on)</span><br><span class="line">        arg11=<span class="string">&quot;-b&quot;</span></span><br><span class="line">        arg12=<span class="string">&quot;&#123;&#125;&quot;</span>.format(bn)</span><br><span class="line">        cmd = [command,arg0,arg1,arg2,arg3,arg4,arg5,arg6,arg7,arg8,arg9,arg10,arg11,arg12]</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print(<span class="string">&quot;dwtools metastore --db=&quot;</span> + <span class="string">&quot;&#123;&#125;&quot;</span>.format(db) + <span class="string">&quot; --tablename=&quot;</span> + <span class="string">&quot;&#123;&#125;&quot;</span>.format(</span><br><span class="line">            tablename) + <span class="string">&quot; --topicname=&quot;</span> + <span class="string">&quot;&#123;&#125;&quot;</span>.format(topicname) + <span class="string">&quot; --indb=false&quot;</span> + <span class="string">&quot; --on=&quot;</span> + <span class="string">&quot;&#123;&#125;&quot;</span>.format(</span><br><span class="line">            on) + <span class="string">&quot; --bn=&quot;</span> + <span class="string">&quot;&#123;&#125;&quot;</span>.format(bn))</span><br><span class="line">        arg0=<span class="string">&quot;-m&quot;</span></span><br><span class="line">        arg1=<span class="string">&quot;table&quot;</span></span><br><span class="line">        arg2=<span class="string">&quot;-d&quot;</span></span><br><span class="line">        arg3=<span class="string">&quot;&#123;&#125;&quot;</span>.format(db)</span><br><span class="line">        arg4=<span class="string">&quot;-t&quot;</span></span><br><span class="line">        arg5=<span class="string">&quot;&#123;&#125;&quot;</span>.format(tablename)</span><br><span class="line">        arg6=<span class="string">&quot;-s&quot;</span></span><br><span class="line">        arg7=<span class="string">&quot;&#123;&#125;&quot;</span>.format(topicname)</span><br><span class="line">        arg8=<span class="string">&quot;-o&quot;</span></span><br><span class="line">        arg9=<span class="string">&quot;&#123;&#125;&quot;</span>.format(on)</span><br><span class="line">        arg10=<span class="string">&quot;-b&quot;</span></span><br><span class="line">        arg11=<span class="string">&quot;&#123;&#125;&quot;</span>.format(bn)</span><br><span class="line">        cmd = [command,arg0,arg1,arg2,arg3,arg4,arg5,arg6,arg7,arg8,arg9,arg10,arg11]</span><br><span class="line">    new_cmd = <span class="string">&quot; &quot;</span>.join(cmd)</span><br><span class="line">    f = os.popen(new_cmd)</span><br><span class="line">    d = f.read()</span><br><span class="line">    print(d)</span><br><span class="line">    f.close</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">bloodparsedef</span>(<span class="params">dir,projecttype,filename,indb</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;This script:血缘关系解析&quot;&quot;&quot;</span></span><br><span class="line">    command = <span class="string">&quot;java -classpath&quot;</span>+<span class="string">&quot; &quot;</span>+ jartab +<span class="string">&quot; &quot;</span> +classnametab</span><br><span class="line">    parsepath=<span class="string">&quot;&#123;&#125;&quot;</span>.format(dir)+project[projecttype]+<span class="string">&quot;&#123;&#125;&quot;</span>.format(filename)</span><br><span class="line">    <span class="keyword">if</span> os.path.isdir(parsepath):</span><br><span class="line">        <span class="keyword">if</span> indb==<span class="literal">True</span>:</span><br><span class="line">            print(<span class="string">&quot;dwtools bloodparse --dir=&quot;</span> + <span class="string">&quot;&#123;&#125;&quot;</span>.format(dir) + <span class="string">&quot; --projecttype=&quot;</span> + <span class="string">&quot;&#123;&#125;&quot;</span>.format(projecttype) + <span class="string">&quot; --filename=&quot;</span> + <span class="string">&quot;&#123;&#125;&quot;</span>.format(filename) +  <span class="string">&quot; --indb=true&quot;</span>)</span><br><span class="line">            arg0=<span class="string">&quot;-m&quot;</span></span><br><span class="line">            arg1=<span class="string">&quot;lineage&quot;</span></span><br><span class="line">            arg2=<span class="string">&quot;-r&quot;</span></span><br><span class="line">            arg3=parsepath</span><br><span class="line">            arg4=<span class="string">&quot;-g&quot;</span></span><br><span class="line">            arg5=<span class="string">&quot;-d&quot;</span></span><br><span class="line">            arg6=db[projecttype]</span><br><span class="line">            cmd = [command,arg0,arg1,arg2,arg3,arg4,arg5,arg6]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            print(<span class="string">&quot;dwtools bloodparse --dir=&quot;</span> + <span class="string">&quot;&#123;&#125;&quot;</span>.format(dir) + <span class="string">&quot; --projecttype=&quot;</span> + <span class="string">&quot;&#123;&#125;&quot;</span>.format(projecttype) + <span class="string">&quot; --filename=&quot;</span> + <span class="string">&quot;&#123;&#125;&quot;</span>.format(filename) + <span class="string">&quot; --indb=false&quot;</span>)</span><br><span class="line">            arg0=<span class="string">&quot;-m&quot;</span></span><br><span class="line">            arg1=<span class="string">&quot;lineage&quot;</span></span><br><span class="line">            arg2=<span class="string">&quot;-r&quot;</span></span><br><span class="line">            arg3=parsepath</span><br><span class="line">            arg4=<span class="string">&quot;-d&quot;</span></span><br><span class="line">            arg5=db[projecttype]</span><br><span class="line">            cmd = [command,arg0,arg1,arg2,arg3,arg4,arg5]</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">if</span> indb==<span class="literal">True</span>:</span><br><span class="line">            print(<span class="string">&quot;dwtools bloodparse --dir=&quot;</span> + <span class="string">&quot;&#123;&#125;&quot;</span>.format(dir) + <span class="string">&quot; --projecttype=&quot;</span> + <span class="string">&quot;&#123;&#125;&quot;</span>.format(projecttype) + <span class="string">&quot; --filename=&quot;</span> + <span class="string">&quot;&#123;&#125;&quot;</span>.format(filename) + <span class="string">&quot; --indb=true&quot;</span>)</span><br><span class="line">            arg0=<span class="string">&quot;-m&quot;</span></span><br><span class="line">            arg1=<span class="string">&quot;lineage&quot;</span></span><br><span class="line">            arg2=<span class="string">&quot;-f&quot;</span></span><br><span class="line">            arg3=parsepath</span><br><span class="line">            arg4=<span class="string">&quot;-g&quot;</span></span><br><span class="line">            arg5=<span class="string">&quot;-d&quot;</span></span><br><span class="line">            arg6=db[projecttype]</span><br><span class="line">            cmd = [command,arg0,arg1,arg2,arg3,arg4,arg5,arg6]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            print(<span class="string">&quot;dwtools bloodparse --dir=&quot;</span> + <span class="string">&quot;&#123;&#125;&quot;</span>.format(dir) + <span class="string">&quot; --projecttype=&quot;</span> + <span class="string">&quot;&#123;&#125;&quot;</span>.format(projecttype) + <span class="string">&quot; --filename=&quot;</span> + <span class="string">&quot;&#123;&#125;&quot;</span>.format(filename) + <span class="string">&quot; --indb=false&quot;</span>)</span><br><span class="line">            arg0=<span class="string">&quot;-m&quot;</span></span><br><span class="line">            arg1=<span class="string">&quot;lineage&quot;</span></span><br><span class="line">            arg2=<span class="string">&quot;-f&quot;</span></span><br><span class="line">            arg3=parsepath</span><br><span class="line">            arg4=<span class="string">&quot;-d&quot;</span></span><br><span class="line">            arg5=db[projecttype]</span><br><span class="line">            cmd = [command,arg0,arg1,arg2,arg3,arg4,arg5]</span><br><span class="line">    new_cmd = <span class="string">&quot; &quot;</span>.join(cmd)</span><br><span class="line">    f = os.popen(new_cmd)</span><br><span class="line">    d = f.read()</span><br><span class="line">    print(d)</span><br><span class="line">    f.close</span><br><span class="line"></span><br><span class="line">begin.add_command(publish)</span><br><span class="line">begin.add_command(runJob)</span><br><span class="line">begin.add_command(bloodparse)</span><br><span class="line">begin.add_command(metastore)</span><br><span class="line">begin()<span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="comment">#coding:utf-8</span></span><br><span class="line"><span class="keyword">import</span> click</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> getpass</span><br><span class="line"></span><br><span class="line"><span class="comment"># java -classpath table-meta-1.0-SNAPSHOT.jar com.lx.dw.utils.Runner -m lineage -r /Users/manzhong/Downloads/warehouse-master/dol</span></span><br><span class="line"><span class="comment"># &quot;/data/dwdev/job-manager-1.0-SNAPSHOT-jar-with-dependencies.jar&quot;</span></span><br><span class="line">jar = <span class="string">&quot;/data/dwdev/job-manager-1.0-SNAPSHOT-jar-with-dependencies.jar&quot;</span></span><br><span class="line">classname = <span class="string">&quot;com.lx.dw.job.Runner&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">jartab = <span class="string">&quot;/data/dwdev/table-meta-1.0-SNAPSHOT.jar&quot;</span></span><br><span class="line">classnametab = <span class="string">&quot;com.lx.dw.utils.Runner&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">hdfspath=&#123;<span class="string">&#x27;lx&#x27;</span>:<span class="string">&#x27;/user/dwdev/sqlScript&#x27;</span>,<span class="string">&#x27;wm&#x27;</span>:<span class="string">&#x27;/user/dwdev/wmsqlScript&#x27;</span>&#125;</span><br><span class="line">gitpath=&#123;<span class="string">&#x27;lx&#x27;</span>:<span class="string">&#x27;dol&#x27;</span>,<span class="string">&#x27;wm&#x27;</span>:<span class="string">&#x27;wmdol&#x27;</span>&#125;</span><br><span class="line">project=&#123;<span class="string">&#x27;lx&#x27;</span>:<span class="string">&#x27;warehouse/dol/&#x27;</span>,<span class="string">&#x27;wm&#x27;</span>:<span class="string">&#x27;warehouse/wmdol/&#x27;</span>&#125;</span><br><span class="line">db=&#123;<span class="string">&#x27;lx&#x27;</span>:<span class="string">&#x27;dw&#x27;</span>,<span class="string">&#x27;wm&#x27;</span>:<span class="string">&#x27;wmdw&#x27;</span>&#125;</span><br><span class="line"><span class="meta">@click.group()</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">begin</span>():</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@click.command()</span></span><br><span class="line"><span class="meta">@click.option(&quot;--filename&quot;,&quot;-f&quot;,default=&quot;git filename&quot;,prompt=&#x27;INPUT FILENAME:&#x27;,help=&quot;文件名&quot;)</span></span><br><span class="line"><span class="meta">@click.option(&quot;--projecttype&quot;,&quot;-s&quot;,type=click.Choice([&#x27;lx&#x27;, &#x27;wm&#x27;], case_sensitive=False),prompt=&#x27;INPUT wm or lx:&#x27;,help=&quot;项目类型&quot;)</span></span><br><span class="line"><span class="meta">@click.option(&quot;--type&quot;,&quot;-g&quot;,default=False,type=bool,prompt=&#x27;Input true or false(Publish to hdfs or not):&#x27;,help=&quot;是否上传&quot;)</span></span><br><span class="line"><span class="meta">@click.option(&quot;--parse&quot;,&quot;-p&quot;,default=True,type=bool,prompt=&#x27;Input true or false(Parse  blood or not):&#x27;,help=&quot;是否解析血缘关系&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">publish</span>(<span class="params">filename,type,projecttype,parse</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;This script:git to hdfs&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">if</span> parse==<span class="literal">True</span>:</span><br><span class="line">        dirs=<span class="string">&quot;/home/&quot;</span>+getpass.getuser()+<span class="string">&quot;/&quot;</span></span><br><span class="line">        indb=<span class="literal">True</span></span><br><span class="line">        bloodparsedef(dirs,projecttype,filename,indb)</span><br><span class="line">    <span class="keyword">if</span> type==<span class="literal">True</span>:</span><br><span class="line">        print(<span class="string">&quot;dwtools publish --filename=&quot;</span> + <span class="string">&quot;&#123;&#125;&quot;</span>.format(filename) + <span class="string">&quot; --projecttype=&quot;</span> + <span class="string">&quot;&#123;&#125;&quot;</span>.format(projecttype) +<span class="string">&quot; --type=true&quot;</span>)</span><br><span class="line">        command = <span class="string">&quot;java -classpath&quot;</span>+<span class="string">&quot; &quot;</span>+ jar +<span class="string">&quot; &quot;</span> +classname</span><br><span class="line">        arg0=<span class="string">&quot;-m&quot;</span></span><br><span class="line">        arg1=<span class="string">&quot;download&quot;</span></span><br><span class="line">        arg2=<span class="string">&quot;-f&quot;</span></span><br><span class="line">        arg3=<span class="string">&quot;&#123;&#125;&quot;</span>.format(filename)</span><br><span class="line">        arg4=<span class="string">&quot;-k&quot;</span></span><br><span class="line">        arg5=os.getenv(<span class="string">&#x27;TOKEN&#x27;</span>)</span><br><span class="line">        arg6=<span class="string">&quot;-s&quot;</span></span><br><span class="line">        arg7=hdfspath[projecttype]</span><br><span class="line">        arg8=<span class="string">&quot;-i&quot;</span></span><br><span class="line">        arg9=gitpath[projecttype]</span><br><span class="line">        arg10=<span class="string">&quot;-g&quot;</span></span><br><span class="line">        cmd = [command,arg0,arg1,arg2,arg3,arg4,arg5,arg6,arg7,arg8,arg9,arg10]</span><br><span class="line">        new_cmd = <span class="string">&quot; &quot;</span>.join(cmd)</span><br><span class="line">        f = os.popen(new_cmd)</span><br><span class="line">        d = f.read()</span><br><span class="line">        print(d)</span><br><span class="line">        f.close</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print(<span class="string">&quot;dwtools publish --filename=&quot;</span> + <span class="string">&quot;&#123;&#125;&quot;</span>.format(filename) + <span class="string">&quot; --projecttype=&quot;</span> + <span class="string">&quot;&#123;&#125;&quot;</span>.format(projecttype) + <span class="string">&quot; --type=false&quot;</span>)</span><br><span class="line">        command = <span class="string">&quot;java -classpath&quot;</span>+<span class="string">&quot; &quot;</span>+ jar +<span class="string">&quot; &quot;</span> +classname</span><br><span class="line">        arg0=<span class="string">&quot;-m&quot;</span></span><br><span class="line">        arg1=<span class="string">&quot;download&quot;</span></span><br><span class="line">        arg2=<span class="string">&quot;-f&quot;</span></span><br><span class="line">        arg3=<span class="string">&quot;&#123;&#125;&quot;</span>.format(filename)</span><br><span class="line">        arg4=<span class="string">&quot;-k&quot;</span></span><br><span class="line">        arg5=os.getenv(<span class="string">&#x27;TOKEN&#x27;</span>)</span><br><span class="line">        arg6=<span class="string">&quot;-s&quot;</span></span><br><span class="line">        arg7=hdfspath[projecttype]</span><br><span class="line">        arg8=<span class="string">&quot;-i&quot;</span></span><br><span class="line">        arg9=gitpath[projecttype]</span><br><span class="line">        cmd = [command,arg0,arg1,arg2,arg3,arg4,arg5,arg6,arg7,arg8,arg9]</span><br><span class="line">        new_cmd = <span class="string">&quot; &quot;</span>.join(cmd)</span><br><span class="line">        f = os.popen(new_cmd)</span><br><span class="line">        d = f.read()</span><br><span class="line">        print(d)</span><br><span class="line">        f.close</span><br><span class="line"><span class="comment"># sql测试运行</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@click.command()</span></span><br><span class="line"><span class="meta">@click.option(&quot;--dir&quot;,&quot;-d&quot;,default=&quot;/home/&quot;+getpass.getuser()+&quot;/&quot;,prompt=&#x27;Personal home directory&#x27;,help=&quot;用户主目录&quot;)</span></span><br><span class="line"><span class="meta">@click.option(&quot;--projecttype&quot;,&quot;-s&quot;,type=click.Choice([&#x27;lx&#x27;, &#x27;wm&#x27;], case_sensitive=False),prompt=&#x27;INPUT wm or lx:&#x27;,help=&quot;项目类型&quot;)</span></span><br><span class="line"><span class="meta">@click.option(&quot;--filename&quot;,&quot;-f&quot;,prompt=&#x27;Hql File[Example xxx.sql]:&#x27;,help=&quot;文件名:&quot;)</span></span><br><span class="line"><span class="meta">@click.option(&#x27;--message&#x27;, &#x27;-p&#x27;,prompt=&quot;Input parameters,[Example k:v,k:v]:&quot;,help=&quot;参数list&quot;)</span></span><br><span class="line"><span class="meta">@click.option(&quot;--engine&quot;,&quot;-e&quot;,type=click.Choice([&#x27;spark&#x27;,&#x27;hive&#x27;],case_sensitive=False),prompt=&#x27;INPUT spark or hive:&#x27;,help=&quot;执行sparksql或者hivesql&quot;)</span></span><br><span class="line"><span class="meta">@click.option(&quot;--type&quot;,&quot;-g&quot;,default=False,type=bool,prompt=&#x27;Input true or false(Run task or only check syntax):&#x27;,help=&quot;测试环境运行 or 语法检测&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">runJob</span>(<span class="params">dir,projecttype,filename,message,engine,type</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;This script:sql解析&quot;&quot;&quot;</span></span><br><span class="line">    command = <span class="string">&quot;java -classpath&quot;</span>+<span class="string">&quot; &quot;</span>+ jar +<span class="string">&quot; &quot;</span> +classname</span><br><span class="line">    localpath=<span class="string">&quot;&#123;&#125;&quot;</span>.format(dir)+project[projecttype]+<span class="string">&quot;&#123;&#125;&quot;</span>.format(filename)</span><br><span class="line">    <span class="keyword">print</span> (localpath)</span><br><span class="line">    <span class="keyword">if</span> type==<span class="literal">True</span>:</span><br><span class="line">        print(<span class="string">&quot;dwtools runjob --dir=&quot;</span> + <span class="string">&quot;&#123;&#125;&quot;</span>.format(dir) + <span class="string">&quot; --projecttype=&quot;</span> + <span class="string">&quot;&#123;&#125;&quot;</span>.format(projecttype) + <span class="string">&quot; --filename=&quot;</span> + <span class="string">&quot;&#123;&#125;&quot;</span>.format(filename) +<span class="string">&quot; --message=&quot;</span>+<span class="string">&quot;&#123;&#125;&quot;</span>.format(message) + <span class="string">&quot; --engine=&quot;</span> + <span class="string">&quot;&#123;&#125;&quot;</span>.format(engine) +  <span class="string">&quot; --type=true&quot;</span>)</span><br><span class="line">        arg0=<span class="string">&quot;-m&quot;</span></span><br><span class="line">        arg1=<span class="string">&quot;parse&quot;</span></span><br><span class="line">        arg2=<span class="string">&quot;-l&quot;</span></span><br><span class="line">        arg3=localpath</span><br><span class="line">        arg4=<span class="string">&quot;-p&quot;</span></span><br><span class="line">        arg5=<span class="string">&#x27;&#123;&#125;&#x27;</span>.format(message)</span><br><span class="line">        arg6=<span class="string">&quot;-e&quot;</span></span><br><span class="line">        arg7=<span class="string">&#x27;&#123;&#125;&#x27;</span>.format(engine)</span><br><span class="line">        arg8=<span class="string">&quot;-g&quot;</span></span><br><span class="line">        cmd = [command,arg0,arg1,arg2,arg3,arg4,arg5,arg6,arg7,arg8]</span><br><span class="line">        new_cmd = <span class="string">&quot; &quot;</span>.join(cmd)</span><br><span class="line">        f = os.popen(new_cmd)</span><br><span class="line">        d = f.read()</span><br><span class="line">        print(d)</span><br><span class="line">        f.close</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="comment"># properties=&#x27;,&#x27;.join(message)</span></span><br><span class="line">        print(<span class="string">&quot;dwtools runjob --dir=&quot;</span> + <span class="string">&quot;&#123;&#125;&quot;</span>.format(dir) + <span class="string">&quot; --projecttype=&quot;</span> + <span class="string">&quot;&#123;&#125;&quot;</span>.format(projecttype) + <span class="string">&quot; --filename=&quot;</span> + <span class="string">&quot;&#123;&#125;&quot;</span>.format(filename) + <span class="string">&quot; --message=&quot;</span> + <span class="string">&quot;&#123;&#125;&quot;</span>.format(message) + <span class="string">&quot; --engine=&quot;</span> + <span class="string">&quot;&#123;&#125;&quot;</span>.format(engine) + <span class="string">&quot; --type=false&quot;</span>)</span><br><span class="line">        arg0=<span class="string">&quot;-m&quot;</span></span><br><span class="line">        arg1=<span class="string">&quot;parse&quot;</span></span><br><span class="line">        arg2=<span class="string">&quot;-l&quot;</span></span><br><span class="line">        arg3=localpath</span><br><span class="line">        arg4=<span class="string">&quot;-p&quot;</span></span><br><span class="line">        arg5=<span class="string">&#x27;&#123;&#125;&#x27;</span>.format(message)</span><br><span class="line">        arg6=<span class="string">&quot;-e&quot;</span></span><br><span class="line">        arg7=<span class="string">&#x27;&#123;&#125;&#x27;</span>.format(engine)</span><br><span class="line">        cmd = [command,arg0,arg1,arg2,arg3,arg4,arg5,arg6,arg7]</span><br><span class="line">        new_cmd = <span class="string">&quot; &quot;</span>.join(cmd)</span><br><span class="line">        f = os.popen(new_cmd)</span><br><span class="line">        d = f.read()</span><br><span class="line">        print(d)</span><br><span class="line">        f.close</span><br><span class="line"></span><br><span class="line"><span class="meta">@click.command()</span></span><br><span class="line"><span class="meta">@click.option(&quot;--dir&quot;,&quot;-d&quot;,default=&quot;/home/&quot;+getpass.getuser()+&quot;/&quot;,prompt=&#x27;Personal home directory&#x27;,help=&quot;用户主目录&quot;)</span></span><br><span class="line"><span class="meta">@click.option(&quot;--projecttype&quot;,&quot;-s&quot;,type=click.Choice([&#x27;lx&#x27;, &#x27;wm&#x27;], case_sensitive=False),prompt=&#x27;INPUT wm or lx:&#x27;,help=&quot;项目类型&quot;)</span></span><br><span class="line"><span class="meta">@click.option(&quot;--filename&quot;,&quot;-f&quot;,prompt=&#x27;Hql File[Example xxx.sql]:&#x27;,help=&quot;文件名:&quot;)</span></span><br><span class="line"><span class="meta">@click.option(&quot;--indb&quot;,default=True,type=bool,prompt=&#x27;Input true or false(insert to mysql or only display result ):&#x27;,help=&quot;是否入库 or 只显示结果&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">bloodparse</span>(<span class="params">dir,projecttype,filename,indb</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;This script:血缘关系解析&quot;&quot;&quot;</span></span><br><span class="line">    command = <span class="string">&quot;java -classpath&quot;</span>+<span class="string">&quot; &quot;</span>+ jartab +<span class="string">&quot; &quot;</span> +classnametab</span><br><span class="line">    parsepath=<span class="string">&quot;&#123;&#125;&quot;</span>.format(dir)+project[projecttype]+<span class="string">&quot;&#123;&#125;&quot;</span>.format(filename)</span><br><span class="line">    <span class="keyword">if</span> os.path.isdir(parsepath):</span><br><span class="line">        <span class="keyword">if</span> indb==<span class="literal">True</span>:</span><br><span class="line">            print(<span class="string">&quot;dwtools bloodparse --dir=&quot;</span> + <span class="string">&quot;&#123;&#125;&quot;</span>.format(dir) + <span class="string">&quot; --projecttype=&quot;</span> + <span class="string">&quot;&#123;&#125;&quot;</span>.format(projecttype) + <span class="string">&quot; --filename=&quot;</span> + <span class="string">&quot;&#123;&#125;&quot;</span>.format(filename) +  <span class="string">&quot; --indb=true&quot;</span>)</span><br><span class="line">            arg0=<span class="string">&quot;-m&quot;</span></span><br><span class="line">            arg1=<span class="string">&quot;lineage&quot;</span></span><br><span class="line">            arg2=<span class="string">&quot;-r&quot;</span></span><br><span class="line">            arg3=parsepath</span><br><span class="line">            arg4=<span class="string">&quot;-g&quot;</span></span><br><span class="line">            arg5=<span class="string">&quot;-d&quot;</span></span><br><span class="line">            arg6=db[projecttype]</span><br><span class="line">            cmd = [command,arg0,arg1,arg2,arg3,arg4,arg5,arg6]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            print(<span class="string">&quot;dwtools bloodparse --dir=&quot;</span> + <span class="string">&quot;&#123;&#125;&quot;</span>.format(dir) + <span class="string">&quot; --projecttype=&quot;</span> + <span class="string">&quot;&#123;&#125;&quot;</span>.format(projecttype) + <span class="string">&quot; --filename=&quot;</span> + <span class="string">&quot;&#123;&#125;&quot;</span>.format(filename) + <span class="string">&quot; --indb=false&quot;</span>)</span><br><span class="line">            arg0=<span class="string">&quot;-m&quot;</span></span><br><span class="line">            arg1=<span class="string">&quot;lineage&quot;</span></span><br><span class="line">            arg2=<span class="string">&quot;-r&quot;</span></span><br><span class="line">            arg3=parsepath</span><br><span class="line">            arg4=<span class="string">&quot;-d&quot;</span></span><br><span class="line">            arg5=db[projecttype]</span><br><span class="line">            cmd = [command,arg0,arg1,arg2,arg3,arg4,arg5]</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">if</span> indb==<span class="literal">True</span>:</span><br><span class="line">            print(<span class="string">&quot;dwtools bloodparse --dir=&quot;</span> + <span class="string">&quot;&#123;&#125;&quot;</span>.format(dir) + <span class="string">&quot; --projecttype=&quot;</span> + <span class="string">&quot;&#123;&#125;&quot;</span>.format(projecttype) + <span class="string">&quot; --filename=&quot;</span> + <span class="string">&quot;&#123;&#125;&quot;</span>.format(filename) + <span class="string">&quot; --indb=true&quot;</span>)</span><br><span class="line">            arg0=<span class="string">&quot;-m&quot;</span></span><br><span class="line">            arg1=<span class="string">&quot;lineage&quot;</span></span><br><span class="line">            arg2=<span class="string">&quot;-f&quot;</span></span><br><span class="line">            arg3=parsepath</span><br><span class="line">            arg4=<span class="string">&quot;-g&quot;</span></span><br><span class="line">            arg5=<span class="string">&quot;-d&quot;</span></span><br><span class="line">            arg6=db[projecttype]</span><br><span class="line">            cmd = [command,arg0,arg1,arg2,arg3,arg4,arg5,arg6]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            print(<span class="string">&quot;dwtools bloodparse --dir=&quot;</span> + <span class="string">&quot;&#123;&#125;&quot;</span>.format(dir) + <span class="string">&quot; --projecttype=&quot;</span> + <span class="string">&quot;&#123;&#125;&quot;</span>.format(projecttype) + <span class="string">&quot; --filename=&quot;</span> + <span class="string">&quot;&#123;&#125;&quot;</span>.format(filename) + <span class="string">&quot; --indb=false&quot;</span>)</span><br><span class="line">            arg0=<span class="string">&quot;-m&quot;</span></span><br><span class="line">            arg1=<span class="string">&quot;lineage&quot;</span></span><br><span class="line">            arg2=<span class="string">&quot;-f&quot;</span></span><br><span class="line">            arg3=parsepath</span><br><span class="line">            arg4=<span class="string">&quot;-d&quot;</span></span><br><span class="line">            arg5=db[projecttype]</span><br><span class="line">            cmd = [command,arg0,arg1,arg2,arg3,arg4,arg5]</span><br><span class="line">    new_cmd = <span class="string">&quot; &quot;</span>.join(cmd)</span><br><span class="line">    f = os.popen(new_cmd)</span><br><span class="line">    d = f.read()</span><br><span class="line">    print(d)</span><br><span class="line">    f.close</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#  &quot;-m&quot;,&quot;table&quot;,&quot;-d&quot;,&quot;dw&quot;,&quot;-t&quot;,&quot;mid_health_effective_movement_aggr_user_ss&quot;,&quot;-s&quot;,&quot;health&quot;,&quot;-o&quot;,&quot;yujing.zou&quot;</span></span><br><span class="line"><span class="meta">@click.command()</span></span><br><span class="line"><span class="meta">@click.option(&quot;--db&quot;,type=click.Choice([&#x27;dw&#x27;, &#x27;wmdw&#x27;], case_sensitive=False),prompt=&#x27;INPUT DB:&#x27;,help=&quot;库名&quot;)</span></span><br><span class="line"><span class="meta">@click.option(&quot;--tablename&quot;,default=&quot;table name&quot;,prompt=&#x27;INPUT TABLE NAME:&#x27;,help=&quot;表名&quot;)</span></span><br><span class="line"><span class="meta">@click.option(&quot;--topicname&quot;,default=&quot;topic name&quot;,prompt=&#x27;INPUT TOPIC NAME&#x27;,help=&quot;主题名&quot;)</span></span><br><span class="line"><span class="meta">@click.option(&quot;--indb&quot;,default=True,type=bool,prompt=&#x27;Input true or false(insert to mysql or only display result ):&#x27;,help=&quot;是否入库 or 只显示结果&quot;)</span></span><br><span class="line"><span class="meta">@click.option(&quot;--on&quot;,default=&quot;yujing.zou&quot;,prompt=&#x27;INPUT First responsible person:&#x27;,help=&quot;第一责任人&quot;)</span></span><br><span class="line"><span class="meta">@click.option(&quot;--bn&quot;,default=&quot;hongfei.yang&quot;,prompt=&#x27;INPUT Second responsible person:&#x27;,help=&quot;第二责任人&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">metastore</span>(<span class="params">db,tablename,topicname,indb,on,bn</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;This script:元数据录入&quot;&quot;&quot;</span></span><br><span class="line">    command = <span class="string">&quot;java -classpath&quot;</span>+<span class="string">&quot; &quot;</span>+ jartab +<span class="string">&quot; &quot;</span> +classnametab</span><br><span class="line">    <span class="keyword">if</span> indb==<span class="literal">True</span>:</span><br><span class="line">        print(<span class="string">&quot;dwtools metastore --db=&quot;</span> + <span class="string">&quot;&#123;&#125;&quot;</span>.format(db) + <span class="string">&quot; --tablename=&quot;</span> + <span class="string">&quot;&#123;&#125;&quot;</span>.format(</span><br><span class="line">            tablename) + <span class="string">&quot; --topicname=&quot;</span> + <span class="string">&quot;&#123;&#125;&quot;</span>.format(topicname) + <span class="string">&quot; --indb=true&quot;</span>+<span class="string">&quot; --on=&quot;</span>+<span class="string">&quot;&#123;&#125;&quot;</span>.format(on)+<span class="string">&quot; --bn=&quot;</span>+<span class="string">&quot;&#123;&#125;&quot;</span>.format(bn))</span><br><span class="line">        arg0=<span class="string">&quot;-m&quot;</span></span><br><span class="line">        arg1=<span class="string">&quot;table&quot;</span></span><br><span class="line">        arg2=<span class="string">&quot;-d&quot;</span></span><br><span class="line">        arg3=<span class="string">&quot;&#123;&#125;&quot;</span>.format(db)</span><br><span class="line">        arg4=<span class="string">&quot;-t&quot;</span></span><br><span class="line">        arg5=<span class="string">&quot;&#123;&#125;&quot;</span>.format(tablename)</span><br><span class="line">        arg6=<span class="string">&quot;-s&quot;</span></span><br><span class="line">        arg7=<span class="string">&quot;&#123;&#125;&quot;</span>.format(topicname)</span><br><span class="line">        arg8=<span class="string">&quot;-g&quot;</span></span><br><span class="line">        arg9=<span class="string">&quot;-o&quot;</span></span><br><span class="line">        arg10=<span class="string">&quot;&#123;&#125;&quot;</span>.format(on)</span><br><span class="line">        arg11=<span class="string">&quot;-b&quot;</span></span><br><span class="line">        arg12=<span class="string">&quot;&#123;&#125;&quot;</span>.format(bn)</span><br><span class="line">        cmd = [command,arg0,arg1,arg2,arg3,arg4,arg5,arg6,arg7,arg8,arg9,arg10,arg11,arg12]</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print(<span class="string">&quot;dwtools metastore --db=&quot;</span> + <span class="string">&quot;&#123;&#125;&quot;</span>.format(db) + <span class="string">&quot; --tablename=&quot;</span> + <span class="string">&quot;&#123;&#125;&quot;</span>.format(</span><br><span class="line">            tablename) + <span class="string">&quot; --topicname=&quot;</span> + <span class="string">&quot;&#123;&#125;&quot;</span>.format(topicname) + <span class="string">&quot; --indb=false&quot;</span> + <span class="string">&quot; --on=&quot;</span> + <span class="string">&quot;&#123;&#125;&quot;</span>.format(</span><br><span class="line">            on) + <span class="string">&quot; --bn=&quot;</span> + <span class="string">&quot;&#123;&#125;&quot;</span>.format(bn))</span><br><span class="line">        arg0=<span class="string">&quot;-m&quot;</span></span><br><span class="line">        arg1=<span class="string">&quot;table&quot;</span></span><br><span class="line">        arg2=<span class="string">&quot;-d&quot;</span></span><br><span class="line">        arg3=<span class="string">&quot;&#123;&#125;&quot;</span>.format(db)</span><br><span class="line">        arg4=<span class="string">&quot;-t&quot;</span></span><br><span class="line">        arg5=<span class="string">&quot;&#123;&#125;&quot;</span>.format(tablename)</span><br><span class="line">        arg6=<span class="string">&quot;-s&quot;</span></span><br><span class="line">        arg7=<span class="string">&quot;&#123;&#125;&quot;</span>.format(topicname)</span><br><span class="line">        arg8=<span class="string">&quot;-o&quot;</span></span><br><span class="line">        arg9=<span class="string">&quot;&#123;&#125;&quot;</span>.format(on)</span><br><span class="line">        arg10=<span class="string">&quot;-b&quot;</span></span><br><span class="line">        arg11=<span class="string">&quot;&#123;&#125;&quot;</span>.format(bn)</span><br><span class="line">        cmd = [command,arg0,arg1,arg2,arg3,arg4,arg5,arg6,arg7,arg8,arg9,arg10,arg11]</span><br><span class="line">    new_cmd = <span class="string">&quot; &quot;</span>.join(cmd)</span><br><span class="line">    f = os.popen(new_cmd)</span><br><span class="line">    d = f.read()</span><br><span class="line">    print(d)</span><br><span class="line">    f.close</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">bloodparsedef</span>(<span class="params">dir,projecttype,filename,indb</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;This script:血缘关系解析&quot;&quot;&quot;</span></span><br><span class="line">    command = <span class="string">&quot;java -classpath&quot;</span>+<span class="string">&quot; &quot;</span>+ jartab +<span class="string">&quot; &quot;</span> +classnametab</span><br><span class="line">    parsepath=<span class="string">&quot;&#123;&#125;&quot;</span>.format(dir)+project[projecttype]+<span class="string">&quot;&#123;&#125;&quot;</span>.format(filename)</span><br><span class="line">    <span class="keyword">if</span> os.path.isdir(parsepath):</span><br><span class="line">        <span class="keyword">if</span> indb==<span class="literal">True</span>:</span><br><span class="line">            print(<span class="string">&quot;dwtools bloodparse --dir=&quot;</span> + <span class="string">&quot;&#123;&#125;&quot;</span>.format(dir) + <span class="string">&quot; --projecttype=&quot;</span> + <span class="string">&quot;&#123;&#125;&quot;</span>.format(projecttype) + <span class="string">&quot; --filename=&quot;</span> + <span class="string">&quot;&#123;&#125;&quot;</span>.format(filename) +  <span class="string">&quot; --indb=true&quot;</span>)</span><br><span class="line">            arg0=<span class="string">&quot;-m&quot;</span></span><br><span class="line">            arg1=<span class="string">&quot;lineage&quot;</span></span><br><span class="line">            arg2=<span class="string">&quot;-r&quot;</span></span><br><span class="line">            arg3=parsepath</span><br><span class="line">            arg4=<span class="string">&quot;-g&quot;</span></span><br><span class="line">            arg5=<span class="string">&quot;-d&quot;</span></span><br><span class="line">            arg6=db[projecttype]</span><br><span class="line">            cmd = [command,arg0,arg1,arg2,arg3,arg4,arg5,arg6]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            print(<span class="string">&quot;dwtools bloodparse --dir=&quot;</span> + <span class="string">&quot;&#123;&#125;&quot;</span>.format(dir) + <span class="string">&quot; --projecttype=&quot;</span> + <span class="string">&quot;&#123;&#125;&quot;</span>.format(projecttype) + <span class="string">&quot; --filename=&quot;</span> + <span class="string">&quot;&#123;&#125;&quot;</span>.format(filename) + <span class="string">&quot; --indb=false&quot;</span>)</span><br><span class="line">            arg0=<span class="string">&quot;-m&quot;</span></span><br><span class="line">            arg1=<span class="string">&quot;lineage&quot;</span></span><br><span class="line">            arg2=<span class="string">&quot;-r&quot;</span></span><br><span class="line">            arg3=parsepath</span><br><span class="line">            arg4=<span class="string">&quot;-d&quot;</span></span><br><span class="line">            arg5=db[projecttype]</span><br><span class="line">            cmd = [command,arg0,arg1,arg2,arg3,arg4,arg5]</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">if</span> indb==<span class="literal">True</span>:</span><br><span class="line">            print(<span class="string">&quot;dwtools bloodparse --dir=&quot;</span> + <span class="string">&quot;&#123;&#125;&quot;</span>.format(dir) + <span class="string">&quot; --projecttype=&quot;</span> + <span class="string">&quot;&#123;&#125;&quot;</span>.format(projecttype) + <span class="string">&quot; --filename=&quot;</span> + <span class="string">&quot;&#123;&#125;&quot;</span>.format(filename) + <span class="string">&quot; --indb=true&quot;</span>)</span><br><span class="line">            arg0=<span class="string">&quot;-m&quot;</span></span><br><span class="line">            arg1=<span class="string">&quot;lineage&quot;</span></span><br><span class="line">            arg2=<span class="string">&quot;-f&quot;</span></span><br><span class="line">            arg3=parsepath</span><br><span class="line">            arg4=<span class="string">&quot;-g&quot;</span></span><br><span class="line">            arg5=<span class="string">&quot;-d&quot;</span></span><br><span class="line">            arg6=db[projecttype]</span><br><span class="line">            cmd = [command,arg0,arg1,arg2,arg3,arg4,arg5,arg6]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            print(<span class="string">&quot;dwtools bloodparse --dir=&quot;</span> + <span class="string">&quot;&#123;&#125;&quot;</span>.format(dir) + <span class="string">&quot; --projecttype=&quot;</span> + <span class="string">&quot;&#123;&#125;&quot;</span>.format(projecttype) + <span class="string">&quot; --filename=&quot;</span> + <span class="string">&quot;&#123;&#125;&quot;</span>.format(filename) + <span class="string">&quot; --indb=false&quot;</span>)</span><br><span class="line">            arg0=<span class="string">&quot;-m&quot;</span></span><br><span class="line">            arg1=<span class="string">&quot;lineage&quot;</span></span><br><span class="line">            arg2=<span class="string">&quot;-f&quot;</span></span><br><span class="line">            arg3=parsepath</span><br><span class="line">            arg4=<span class="string">&quot;-d&quot;</span></span><br><span class="line">            arg5=db[projecttype]</span><br><span class="line">            cmd = [command,arg0,arg1,arg2,arg3,arg4,arg5]</span><br><span class="line">    new_cmd = <span class="string">&quot; &quot;</span>.join(cmd)</span><br><span class="line">    f = os.popen(new_cmd)</span><br><span class="line">    d = f.read()</span><br><span class="line">    print(d)</span><br><span class="line">    f.close</span><br><span class="line"></span><br><span class="line">begin.add_command(publish)</span><br><span class="line">begin.add_command(runJob)</span><br><span class="line">begin.add_command(bloodparse)</span><br><span class="line">begin.add_command(metastore)</span><br><span class="line">begin()</span><br></pre></td></tr></table></figure>

<h2 id="7-将python写的命令行打包-并安装到linux上"><a href="#7-将python写的命令行打包-并安装到linux上" class="headerlink" title="7 将python写的命令行打包,并安装到linux上"></a>7 将python写的命令行打包,并安装到linux上</h2><h2 id="1-安装setuptools"><a href="#1-安装setuptools" class="headerlink" title="1 安装setuptools"></a>1 安装setuptools</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install setuptools</span><br></pre></td></tr></table></figure>

<p>更新:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install --upgrade setuptools</span><br></pre></td></tr></table></figure>

<h2 id="2-新建python的项目"><a href="#2-新建python的项目" class="headerlink" title="2 新建python的项目"></a>2 新建python的项目</h2><p>目录结构:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">--python-dev</span><br><span class="line">		--dwtools(文件夹)</span><br><span class="line">				--__init__.py(空)</span><br><span class="line">				--命令.py</span><br><span class="line">		--setup.py</span><br></pre></td></tr></table></figure>

<p>Setup.py:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding:utf-8</span></span><br><span class="line"><span class="keyword">from</span> setuptools <span class="keyword">import</span> setup,find_packages</span><br><span class="line"></span><br><span class="line">setup(</span><br><span class="line">    name = <span class="string">&#x27;dwdevtools&#x27;</span>,</span><br><span class="line">    version =<span class="string">&#x27;1.0&#x27;</span>,</span><br><span class="line">    author = <span class="string">&#x27;hongfei.yang&#x27;</span>,</span><br><span class="line">    packages=find_packages(),</span><br><span class="line">    include_package_data=<span class="literal">True</span>,</span><br><span class="line">    description = <span class="string">&#x27;数据仓库开发系统&#x27;</span>,</span><br><span class="line">    install_requires=[</span><br><span class="line">        <span class="string">&#x27;Click&#x27;</span>,</span><br><span class="line">    ],</span><br><span class="line">    entry_points=<span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        [console_scripts]</span></span><br><span class="line"><span class="string">        dwtools=dwdevtools.dwtools:begin</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span>,</span><br><span class="line"></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h2 id="3-打包"><a href="#3-打包" class="headerlink" title="3 打包"></a>3 打包</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python setup.py bdist_egg</span><br></pre></td></tr></table></figure>

<h2 id="4-Linux安装egg包"><a href="#4-Linux安装egg包" class="headerlink" title="4 Linux安装egg包"></a>4 Linux安装egg包</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">easy_install *.egg </span><br></pre></td></tr></table></figure>






    </div>

    
    
    
        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>HF
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="http://example.com/2020/05/02/python%E5%91%BD%E4%BB%A4%E8%A1%8CClick/" title="python命令行Click">http://example.com/2020/05/02/python命令行Click/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/zh-CN" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Python/" rel="tag"># Python</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2020/05/02/python/" rel="prev" title="python">
      <i class="fa fa-chevron-left"></i> python
    </a></div>
      <div class="post-nav-item">
    <a href="/2020/05/17/SparkSql%E8%B0%83%E4%BC%98/" rel="next" title="SparkSql调优">
      SparkSql调优 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%B8%80-click"><span class="nav-number">1.</span> <span class="nav-text">一 click</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1%E4%BB%8B%E7%BB%8D"><span class="nav-number">1.1.</span> <span class="nav-text">1介绍</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-%E5%BF%AB%E9%80%9F%E5%BC%80%E5%A7%8B"><span class="nav-number">1.2.</span> <span class="nav-text">2 快速开始</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-%E4%B8%9A%E5%8A%A1%E9%80%BB%E8%BE%91"><span class="nav-number">1.2.1.</span> <span class="nav-text">2.1 业务逻辑</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-%E5%AE%9A%E4%B9%89%E5%8F%82%E6%95%B0"><span class="nav-number">1.2.2.</span> <span class="nav-text">2.2 定义参数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-3-%E4%BB%A3%E7%A0%81%E6%A2%B3%E7%90%86"><span class="nav-number">1.2.3.</span> <span class="nav-text">2.3 代码梳理</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-%E6%B7%B1%E5%85%A5click"><span class="nav-number">1.3.</span> <span class="nav-text">3 深入click</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1-%E5%8F%82%E6%95%B0"><span class="nav-number">1.3.1.</span> <span class="nav-text">3.1 参数</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-1-1-%E5%9F%BA%E6%9C%AC%E5%8F%82%E6%95%B0"><span class="nav-number">1.3.1.1.</span> <span class="nav-text">3.1.1 基本参数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-1-2-%E5%8F%82%E6%95%B0%E7%B1%BB%E5%9E%8B"><span class="nav-number">1.3.1.2.</span> <span class="nav-text">3.1.2 参数类型</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-1-3-%E6%96%87%E4%BB%B6%E5%8F%82%E6%95%B0"><span class="nav-number">1.3.1.3.</span> <span class="nav-text">3.1.3 文件参数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-1-4%E6%96%87%E4%BB%B6%E8%B7%AF%E5%BE%84%E5%8F%82%E6%95%B0"><span class="nav-number">1.3.1.4.</span> <span class="nav-text">3.1.4文件路径参数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-1-5%E9%80%89%E6%8B%A9%E9%A1%B9%E5%8F%82%E6%95%B0"><span class="nav-number">1.3.1.5.</span> <span class="nav-text">3.1.5选择项参数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-1-6%E5%8F%AF%E5%8F%98%E5%8F%82%E6%95%B0"><span class="nav-number">1.3.1.6.</span> <span class="nav-text">3.1.6可变参数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-1-7%E4%BB%8E%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E8%AF%BB%E5%8F%96%E5%8F%82%E6%95%B0"><span class="nav-number">1.3.1.7.</span> <span class="nav-text">3.1.7从环境变量读取参数</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-%E9%80%89%E9%A1%B9"><span class="nav-number">1.3.2.</span> <span class="nav-text">3.2 选项</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-1-%E7%BB%99%E9%80%89%E9%A1%B9%E5%91%BD%E5%90%8D"><span class="nav-number">1.3.2.1.</span> <span class="nav-text">3.2.1 给选项命名</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-2-%E5%9F%BA%E6%9C%AC%E5%80%BC%E9%80%89%E9%A1%B9"><span class="nav-number">1.3.2.2.</span> <span class="nav-text">3.2.2 基本值选项</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-3%E5%A4%9A%E5%80%BC%E9%80%89%E9%A1%B9"><span class="nav-number">1.3.2.3.</span> <span class="nav-text">3.2.3多值选项</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-4%E5%A4%9A%E9%80%89%E9%A1%B9"><span class="nav-number">1.3.2.4.</span> <span class="nav-text">3.2.4多选项</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-5-%E8%AE%A1%E5%80%BC%E9%80%89%E9%A1%B9"><span class="nav-number">1.3.2.5.</span> <span class="nav-text">3.2.5 计值选项</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-6-%E5%B8%83%E5%B0%94%E9%80%89%E9%A1%B9"><span class="nav-number">1.3.3.</span> <span class="nav-text">2.6 布尔选项</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-7-%E7%89%B9%E6%80%A7%E5%88%87%E6%8D%A2%E9%80%89%E9%A1%B9"><span class="nav-number">1.3.3.1.</span> <span class="nav-text">3.2.7 特性切换选项</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-8-%E9%80%89%E6%8B%A9%E9%A1%B9%E9%80%89%E9%A1%B9"><span class="nav-number">1.3.3.2.</span> <span class="nav-text">3.2.8 选择项选项</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-9-%E6%8F%90%E7%A4%BA%E9%80%89%E9%A1%B9"><span class="nav-number">1.3.3.3.</span> <span class="nav-text">3.2.9 提示选项</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-10-%E8%8C%83%E5%9B%B4%E9%80%89%E9%A1%B9"><span class="nav-number">1.3.3.4.</span> <span class="nav-text">3.2.10 范围选项</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-11-%E5%9B%9E%E8%B0%83%E5%92%8C%E4%BC%98%E5%85%88"><span class="nav-number">1.3.3.5.</span> <span class="nav-text">3.2.11 回调和优先</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-12-Yes-%E9%80%89%E9%A1%B9"><span class="nav-number">1.3.3.6.</span> <span class="nav-text">3.2.12 Yes 选项</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-13-%E5%85%B6%E4%BB%96%E5%A2%9E%E5%BC%BA%E5%8A%9F%E8%83%BD"><span class="nav-number">1.3.3.7.</span> <span class="nav-text">3.2.13 其他增强功能</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3-%E5%91%BD%E4%BB%A4%E5%92%8C%E7%BB%84"><span class="nav-number">1.3.4.</span> <span class="nav-text">3.3 命令和组</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-3-1%E5%9B%9E%E8%B0%83%E8%B0%83%E7%94%A8"><span class="nav-number">1.3.4.1.</span> <span class="nav-text">3.3.1回调调用</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-3-2%E5%B5%8C%E5%A5%97%E5%A4%84%E7%90%86%E5%92%8C%E4%B8%8A%E4%B8%8B%E6%96%87"><span class="nav-number">1.3.4.2.</span> <span class="nav-text">3.3.2嵌套处理和上下文</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-3-3-%E4%B8%8D%E4%BD%BF%E7%94%A8%E5%91%BD%E4%BB%A4%E6%9D%A5%E8%B0%83%E7%94%A8%E5%91%BD%E4%BB%A4%E7%BB%84"><span class="nav-number">1.3.4.3.</span> <span class="nav-text">3.3.3 不使用命令来调用命令组</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-3-4-%E8%87%AA%E5%AE%9A%E4%B9%89%E5%91%BD%E4%BB%A4%E7%BB%84-%E5%A4%9A%E5%91%BD%E4%BB%A4"><span class="nav-number">1.3.4.4.</span> <span class="nav-text">3.3.4 自定义命令组&#x2F;多命令</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-3-5-%E5%90%88%E5%B9%B6%E5%91%BD%E4%BB%A4%E7%BB%84-%E5%A4%9A%E5%91%BD%E4%BB%A4"><span class="nav-number">1.3.4.5.</span> <span class="nav-text">3.3.5 合并命令组&#x2F;多命令</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-3-6-%E9%93%BE%E5%BC%8F%E5%91%BD%E4%BB%A4%E7%BB%84-%E5%A4%9A%E5%91%BD%E4%BB%A4"><span class="nav-number">1.3.4.6.</span> <span class="nav-text">3.3.6 链式命令组&#x2F;多命令</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-3-7-%E5%91%BD%E4%BB%A4%E7%BB%84-%E5%A4%9A%E5%91%BD%E4%BB%A4%E7%AE%A1%E9%81%93"><span class="nav-number">1.3.4.7.</span> <span class="nav-text">3.3.7 命令组&#x2F;多命令管道</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-3-8-%E8%A6%86%E7%9B%96%E9%BB%98%E8%AE%A4%E5%80%BC"><span class="nav-number">1.3.4.8.</span> <span class="nav-text">3.3.8 覆盖默认值</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-click%E5%A2%9E%E5%BC%BA"><span class="nav-number">1.4.</span> <span class="nav-text">4 click增强</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1-Bash-%E8%A1%A5%E5%85%A8"><span class="nav-number">1.4.1.</span> <span class="nav-text">4.1 Bash 补全</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#4-1-1-%E8%A1%A5%E5%85%A8%E8%83%BD%E5%8A%9B"><span class="nav-number">1.4.1.1.</span> <span class="nav-text">4.1.1 补全能力</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-1-2-%E6%BF%80%E6%B4%BB%E8%A1%A5%E5%85%A8"><span class="nav-number">1.4.1.2.</span> <span class="nav-text">4.1.2 激活补全</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E5%AE%9E%E7%94%A8%E5%B7%A5%E5%85%B7"><span class="nav-number">1.4.2.</span> <span class="nav-text">.2 实用工具</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#4-2-1-%E6%89%93%E5%8D%B0%E5%88%B0%E6%A0%87%E5%87%86%E8%BE%93%E5%87%BA"><span class="nav-number">1.4.2.1.</span> <span class="nav-text">4.2.1 打印到标准输出</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-2-2-ANSI-%E9%A2%9C%E8%89%B2"><span class="nav-number">1.4.2.2.</span> <span class="nav-text">4.2.2 ANSI 颜色</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-3-%E5%88%86%E9%A1%B5%E6%94%AF%E6%8C%81"><span class="nav-number">1.4.2.3.</span> <span class="nav-text">.2.3 分页支持</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-2-4-%E6%B8%85%E9%99%A4%E5%B1%8F%E5%B9%95"><span class="nav-number">1.4.2.4.</span> <span class="nav-text">4.2.4 清除屏幕</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-5-%E4%BB%8E%E7%BB%88%E7%AB%AF%E8%8E%B7%E5%8F%96%E5%AD%97%E7%AC%A6"><span class="nav-number">1.4.2.5.</span> <span class="nav-text">.2.5 从终端获取字符</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-2-6-%E7%AD%89%E5%BE%85%E6%8C%89%E9%94%AE"><span class="nav-number">1.4.2.6.</span> <span class="nav-text">4.2.6 等待按键</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-2-7-%E5%90%AF%E5%8A%A8%E7%BC%96%E8%BE%91%E5%99%A8"><span class="nav-number">1.4.2.7.</span> <span class="nav-text">4.2.7 启动编辑器</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-8-%E5%90%AF%E5%8A%A8%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F"><span class="nav-number">1.4.2.8.</span> <span class="nav-text">.2.8 启动应用程序</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-2-9-%E6%98%BE%E7%A4%BA%E8%BF%9B%E5%BA%A6%E6%9D%A1"><span class="nav-number">1.4.2.9.</span> <span class="nav-text">4.2.9 显示进度条</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-2-10-%E6%9B%B4%E5%A4%9A%E5%AE%9E%E7%94%A8%E5%B7%A5%E5%85%B7"><span class="nav-number">1.4.2.10.</span> <span class="nav-text">4.2.10 更多实用工具</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-%E6%80%BB%E7%BB%93"><span class="nav-number">1.5.</span> <span class="nav-text">5 总结</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-%E5%AE%9E%E6%88%98"><span class="nav-number">1.6.</span> <span class="nav-text">6 实战</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-1-%E4%BD%BF%E7%94%A8click%E5%AE%9E%E7%8E%B0%E8%B0%83%E7%94%A8Java%E7%9A%84jar%E5%8C%85"><span class="nav-number">1.7.</span> <span class="nav-text">6.1 使用click实现调用Java的jar包</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-%E5%B0%86python%E5%86%99%E7%9A%84%E5%91%BD%E4%BB%A4%E8%A1%8C%E6%89%93%E5%8C%85-%E5%B9%B6%E5%AE%89%E8%A3%85%E5%88%B0linux%E4%B8%8A"><span class="nav-number">1.8.</span> <span class="nav-text">7 将python写的命令行打包,并安装到linux上</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-%E5%AE%89%E8%A3%85setuptools"><span class="nav-number">1.9.</span> <span class="nav-text">1 安装setuptools</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-%E6%96%B0%E5%BB%BApython%E7%9A%84%E9%A1%B9%E7%9B%AE"><span class="nav-number">1.10.</span> <span class="nav-text">2 新建python的项目</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-%E6%89%93%E5%8C%85"><span class="nav-number">1.11.</span> <span class="nav-text">3 打包</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-Linux%E5%AE%89%E8%A3%85egg%E5%8C%85"><span class="nav-number">1.12.</span> <span class="nav-text">4 Linux安装egg包</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="HF"
      src="/images/hexo.jpg">
  <p class="site-author-name" itemprop="name">HF</p>
  <div class="site-description" itemprop="description">第二名就是头号输家</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">98</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">30</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">30</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="cc-license motion-element" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/zh-CN" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
  </div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title"><i class="fa fa-link fa-fw"></i>
      推荐阅读
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="http://www.54tianzhisheng.cn/tags/Flink/" title="http:&#x2F;&#x2F;www.54tianzhisheng.cn&#x2F;tags&#x2F;Flink&#x2F;" rel="noopener" target="_blank">Flink</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://nginxconfig.io/" title="https:&#x2F;&#x2F;nginxconfig.io&#x2F;" rel="noopener" target="_blank">Nginxconfig</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="http://linux.51yip.com/" title="http:&#x2F;&#x2F;linux.51yip.com&#x2F;" rel="noopener" target="_blank">Linux命令手册</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://echarts.baidu.com/index.html" title="https:&#x2F;&#x2F;echarts.baidu.com&#x2F;index.html" rel="noopener" target="_blank">echarts可视化库</a>
        </li>
    </ul>
  </div>
<div style="">
  <canvas id="canvas" style="width:60%;">当前浏览器不支持canvas，请更换浏览器后再试</canvas>
</div>
<script>
(function(){

   var digit=
    [
        [
            [0,0,1,1,1,0,0],
            [0,1,1,0,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,0,1,1,0],
            [0,0,1,1,1,0,0]
        ],//0
        [
            [0,0,0,1,1,0,0],
            [0,1,1,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [1,1,1,1,1,1,1]
        ],//1
        [
            [0,1,1,1,1,1,0],
            [1,1,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,0,0],
            [0,0,1,1,0,0,0],
            [0,1,1,0,0,0,0],
            [1,1,0,0,0,0,0],
            [1,1,0,0,0,1,1],
            [1,1,1,1,1,1,1]
        ],//2
        [
            [1,1,1,1,1,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,0,0],
            [0,0,1,1,1,0,0],
            [0,0,0,0,1,1,0],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0]
        ],//3
        [
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,1,0],
            [0,0,1,1,1,1,0],
            [0,1,1,0,1,1,0],
            [1,1,0,0,1,1,0],
            [1,1,1,1,1,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,0,1,1,0],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,1,1]
        ],//4
        [
            [1,1,1,1,1,1,1],
            [1,1,0,0,0,0,0],
            [1,1,0,0,0,0,0],
            [1,1,1,1,1,1,0],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0]
        ],//5
        [
            [0,0,0,0,1,1,0],
            [0,0,1,1,0,0,0],
            [0,1,1,0,0,0,0],
            [1,1,0,0,0,0,0],
            [1,1,0,1,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0]
        ],//6
        [
            [1,1,1,1,1,1,1],
            [1,1,0,0,0,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,1,1,0,0,0],
            [0,0,1,1,0,0,0],
            [0,0,1,1,0,0,0],
            [0,0,1,1,0,0,0]
        ],//7
        [
            [0,1,1,1,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0]
        ],//8
        [
            [0,1,1,1,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,0,0],
            [0,1,1,0,0,0,0]
        ],//9
        [
            [0,0,0,0,0,0,0],
            [0,0,1,1,1,0,0],
            [0,0,1,1,1,0,0],
            [0,0,1,1,1,0,0],
            [0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0],
            [0,0,1,1,1,0,0],
            [0,0,1,1,1,0,0],
            [0,0,1,1,1,0,0],
            [0,0,0,0,0,0,0]
        ]//:
    ];

var canvas = document.getElementById('canvas');

if(canvas.getContext){
    var cxt = canvas.getContext('2d');
    //声明canvas的宽高
    var H = 100,W = 700;
    canvas.height = H;
    canvas.width = W;
    cxt.fillStyle = '#f00';
    cxt.fillRect(10,10,50,50);

    //存储时间数据
    var data = [];
    //存储运动的小球
    var balls = [];
    //设置粒子半径
    var R = canvas.height/20-1;
    (function(){
        var temp = /(\d)(\d):(\d)(\d):(\d)(\d)/.exec(new Date());
        //存储时间数字，由十位小时、个位小时、冒号、十位分钟、个位分钟、冒号、十位秒钟、个位秒钟这7个数字组成
        data.push(temp[1],temp[2],10,temp[3],temp[4],10,temp[5],temp[6]);
    })();

    /*生成点阵数字*/
    function renderDigit(index,num){
        for(var i = 0; i < digit[num].length; i++){
            for(var j = 0; j < digit[num][i].length; j++){
                if(digit[num][i][j] == 1){
                    cxt.beginPath();
                    cxt.arc(14*(R+2)*index + j*2*(R+1)+(R+1),i*2*(R+1)+(R+1),R,0,2*Math.PI);
                    cxt.closePath();
                    cxt.fill();
                }
            }
        }
    }

    /*更新时钟*/
    function updateDigitTime(){
        var changeNumArray = [];
        var temp = /(\d)(\d):(\d)(\d):(\d)(\d)/.exec(new Date());
        var NewData = [];
        NewData.push(temp[1],temp[2],10,temp[3],temp[4],10,temp[5],temp[6]);
        for(var i = data.length-1; i >=0 ; i--){
            //时间发生变化
            if(NewData[i] !== data[i]){
                //将变化的数字值和在data数组中的索引存储在changeNumArray数组中
                changeNumArray.push(i+'_'+(Number(data[i])+1)%10);
            }
        }
        //增加小球
        for(var i = 0; i< changeNumArray.length; i++){
            addBalls.apply(this,changeNumArray[i].split('_'));
        }
        data = NewData.concat();
    }

    /*更新小球状态*/
    function updateBalls(){
        for(var i = 0; i < balls.length; i++){
            balls[i].stepY += balls[i].disY;
            balls[i].x += balls[i].stepX;
            balls[i].y += balls[i].stepY;
            if(balls[i].x > W + R || balls[i].y > H + R){
                balls.splice(i,1);
                i--;
            }
        }
    }

    /*增加要运动的小球*/
    function addBalls(index,num){
        var numArray = [1,2,3];
        var colorArray =  ["#3BE","#09C","#A6C","#93C","#9C0","#690","#FB3","#F80","#F44","#C00"];
        for(var i = 0; i < digit[num].length; i++){
            for(var j = 0; j < digit[num][i].length; j++){
                if(digit[num][i][j] == 1){
                    var ball = {
                        x:14*(R+2)*index + j*2*(R+1)+(R+1),
                        y:i*2*(R+1)+(R+1),
                        stepX:Math.floor(Math.random() * 4 -2),
                        stepY:-2*numArray[Math.floor(Math.random()*numArray.length)],
                        color:colorArray[Math.floor(Math.random()*colorArray.length)],
                        disY:1
                    };
                    balls.push(ball);
                }
            }
        }
    }

    /*渲染*/
    function render(){
        //重置画布宽度，达到清空画布的效果
        canvas.height = 100;
        //渲染时钟
        for(var i = 0; i < data.length; i++){
            renderDigit(i,data[i]);
        }
        //渲染小球
        for(var i = 0; i < balls.length; i++){
            cxt.beginPath();
            cxt.arc(balls[i].x,balls[i].y,R,0,2*Math.PI);
            cxt.fillStyle = balls[i].color;
            cxt.closePath();
            cxt.fill();
        }
    }

    clearInterval(oTimer);
    var oTimer = setInterval(function(){
        //更新时钟
        updateDigitTime();
        //更新小球状态
        updateBalls();
        //渲染
        render();
    },50);
}

})();
</script>
      </div>

    
          <script type="text/javascript" charset="utf-8" src="/js/tagcloud.js"></script>
         <script type="text/javascript" charset="utf-8" src="/js/tagcanvas.js"></script>
           <div class="widget-wrap">
        <h3 class="widget-title">Tag Cloud</h3>
        <div id="myCanvasContainer" class="widget tagcloud">
            <canvas width="250" height="250" id="resCanvas" style="width=100%">
                <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/ClickHouse/" rel="tag">ClickHouse</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ElSearch/" rel="tag">ElSearch</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Flink/" rel="tag">Flink</a><span class="tag-list-count">17</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Flume/" rel="tag">Flume</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Git/" rel="tag">Git</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Hadoop/" rel="tag">Hadoop</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Hbase/" rel="tag">Hbase</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Hive/" rel="tag">Hive</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Impala/" rel="tag">Impala</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Kafka/" rel="tag">Kafka</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux/" rel="tag">Linux</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Livy/" rel="tag">Livy</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Mysql/" rel="tag">Mysql</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Oozie/" rel="tag">Oozie</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Python/" rel="tag">Python</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Redis/" rel="tag">Redis</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Scala/" rel="tag">Scala</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Shell/" rel="tag">Shell</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Spark/" rel="tag">Spark</a><span class="tag-list-count">14</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Sqoop/" rel="tag">Sqoop</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ZK/" rel="tag">ZK</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%8E%86%E5%8F%B2/" rel="tag">历史</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%95%B0%E4%BB%93/" rel="tag">数仓</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90/" rel="tag">数据分析</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96/" rel="tag">数据可视化</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/" rel="tag">数据结构与算法</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%97%A5%E8%AE%B0/" rel="tag">日记</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/" rel="tag">机器学习</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BB%8F%E6%B5%8E%E4%B8%8E%E6%8A%95%E8%B5%84/" rel="tag">经济与投资</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BB%9F%E8%AE%A1/" rel="tag">统计</a><span class="tag-list-count">1</span></li></ul>
            </canvas>
        </div>
    </div>
    

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright" style=" text-align:center;">
  
  &copy; 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">HF</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
      <span class="post-meta-item-text">站点总字数：</span>
    <span title="站点总字数">1.5m</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span class="post-meta-item-text">站点阅读时长 &asymp;</span>
    <span title="站点阅读时长">23:18</span>
</div>

  <!-- 网站运行时间的设置 -->
<div class="run_time" style=" text-align:center;">
  <span id="timeDate">载入天数...</span><span id="times">载入时分秒...</span>
  <script>
    var now = new Date(); 
    function createtime() { 
        var grt= new Date("07/23/2017 10:00:00");//此处修改你的建站时间或者网站上线时间 
        now.setTime(now.getTime()+250); 
        days = (now - grt ) / 1000 / 60 / 60 / 24; dnum = Math.floor(days); 
        hours = (now - grt ) / 1000 / 60 / 60 - (24 * dnum); hnum = Math.floor(hours); 
        if(String(hnum).length ==1 ){hnum = "0" + hnum;} minutes = (now - grt ) / 1000 /60 - (24 * 60 * dnum) - (60 * hnum); 
        mnum = Math.floor(minutes); if(String(mnum).length ==1 ){mnum = "0" + mnum;} 
        seconds = (now - grt ) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum); 
        snum = Math.round(seconds); if(String(snum).length ==1 ){snum = "0" + snum;} 
        document.getElementById("timeDate").innerHTML = "本站已安全运行 "+dnum+" 天 "; 
        document.getElementById("times").innerHTML = hnum + " 小时 " + mnum + " 分 " + snum + " 秒"; 
    } 
    setInterval("createtime()",250);
  </script>
</div>
        
<div class="busuanzi-count" style=" text-align:center;">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
      我的第 <span class="busuanzi-value" id="busuanzi_value_site_uv"></span> 位朋友，
    </span>
  



  
    <span class="site-pv">
      历经 <span class="busuanzi-value" id="busuanzi_value_site_pv"></span> 次回眸才与你相遇
    </span>
  
</div>










      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>

<script src="/js/bookmark.js"></script>


  <script defer src="/lib/three/three.min.js"></script>
    <script defer src="/lib/three/canvas_lines.min.js"></script>


  




  
<script src="/js/local-search.js"></script>













  

  
<div class="moon-menu">
  <div class="moon-menu-items">
    
    <div class="moon-menu-item" onclick="back2bottom()">
      <i class='fas fa-chevron-down'></i>    </div>
    
    <div class="moon-menu-item" onclick="back2top()">
      <i class='fas fa-chevron-up'></i>    </div>
    
  </div>
  <div class="moon-menu-button">
    <svg class="moon-menu-bg">
      <circle class="moon-menu-cricle" cx="50%" cy="50%" r="44%"></circle>
      <circle class="moon-menu-border" cx="50%" cy="50%" r="48%"></circle>
    </svg>
    <div class="moon-menu-content">
      <div class="moon-menu-icon"><i class='fas fa-ellipsis-v'></i></div>
      <div class="moon-menu-text"></div>
    </div>
  </div>
</div><script src="/js/injector.js"></script>
</body>
</html>
<!-- 页面点击小红心 -->
<script type="text/javascript" src="/js/clicklove.js"></script>
<!-- 雪花特效 -->
<script type="text/javascript" src="/js/jquery.js"></script>
<script type="text/javascript" src="/js/jquery.min.js"></script>
<script type="text/javascript" src="/js/snow.js"></script>