<!DOCTYPE html>












  


<html class="theme-next mist use-motion" lang="zh-CN">

<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">




  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link rel="stylesheet" href="/lib/pace/pace-theme-bounce.min.css?v=1.0.2">













  <meta name="baidu-site-verification" content="true">



  
  
  <link rel="stylesheet" href="/lib/fancybox/source/jquery.fancybox.css">







<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2">

<link rel="stylesheet" href="/css/main.css?v=7.1.1">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.1.1">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.1.1">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.1.1">


  <link rel="mask-icon" href="/images/logo.svg?v=7.1.1" color="#222">







<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '7.1.1',
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":true,"dimmer":false},
    back2top: true,
    back2top_sidebar: true,
    fancybox: true,
    fastclick: true,
    lazyload: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"shrinkIn","post_header":"slideLeftIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideDownIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="Hbase一概述hbase是bigtable的开源java版本。是建立在hdfs之上，提供高可靠性、高性能、列存储、可伸缩、实时读写nosql的数据库系统。 它介于nosql和RDBMS之间，仅能通过主键(row key)和主键的range来检索数据，仅支持单行事务(可通过hive支持来实现多表join等复杂操作)。 主要用来存储结构化和半结构化的松散数据。 Hbase查询数据功能很简单，不支持j">
<meta name="keywords" content="BigData">
<meta property="og:type" content="article">
<meta property="og:title" content="Hbase">
<meta property="og:url" content="https://manzhong.github.io/2017/07/17/Hbase.html">
<meta property="og:site_name" content="春雨里洗过的太阳">
<meta property="og:description" content="Hbase一概述hbase是bigtable的开源java版本。是建立在hdfs之上，提供高可靠性、高性能、列存储、可伸缩、实时读写nosql的数据库系统。 它介于nosql和RDBMS之间，仅能通过主键(row key)和主键的range来检索数据，仅支持单行事务(可通过hive支持来实现多表join等复杂操作)。 主要用来存储结构化和半结构化的松散数据。 Hbase查询数据功能很简单，不支持j">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="https://manzhong.github.io/images/Hbase/hbase架构.png">
<meta property="og:image" content="https://manzhong.github.io/images/Hbase/hbase2.png">
<meta property="og:image" content="https://manzhong.github.io/images/Hbase/hbase架构.png">
<meta property="og:updated_time" content="2020-03-15T14:37:12.554Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Hbase">
<meta name="twitter:description" content="Hbase一概述hbase是bigtable的开源java版本。是建立在hdfs之上，提供高可靠性、高性能、列存储、可伸缩、实时读写nosql的数据库系统。 它介于nosql和RDBMS之间，仅能通过主键(row key)和主键的range来检索数据，仅支持单行事务(可通过hive支持来实现多表join等复杂操作)。 主要用来存储结构化和半结构化的松散数据。 Hbase查询数据功能很简单，不支持j">
<meta name="twitter:image" content="https://manzhong.github.io/images/Hbase/hbase架构.png">



  <link rel="alternate" href="/atom.xml" title="春雨里洗过的太阳" type="application/atom+xml">



  
  
  <link rel="canonical" href="https://manzhong.github.io/2017/07/17/Hbase">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>Hbase | 春雨里洗过的太阳</title>
  












  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>
 
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">春雨里洗过的太阳</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">

    
    
    
      
    

    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>标签</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">

    
    
    
      
    

    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-bookmark"></i> <br>分类</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-about">

    
    
    
      
    

    

    <a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i> <br>关于</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-互动">

    
    
    
      
    

    

    <a href="/guestbook/" rel="section"><i class="menu-item-icon fa fa-fw fa-comments"></i> <br>互动</a>

  </li>

      
      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>搜索</a>
        </li>
      
    </ul>
  

  
    

  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://manzhong.github.io/2017/07/17/Hbase.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="丨HF丨">
      <meta itemprop="description" content="第二名就是头号输家!!!">
      <meta itemprop="image" content="/images/hexo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="春雨里洗过的太阳">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Hbase

              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2017-07-17 10:02:01" itemprop="dateCreated datePublished" datetime="2017-07-17T10:02:01+08:00">2017-07-17</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2020-03-15 22:37:12" itemprop="dateModified" datetime="2020-03-15T22:37:12+08:00">2020-03-15</time>
              
            
          </span>

          

          
            
            
          

          
          

          

          
            <div class="post-symbolscount">
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">本文字数：</span>
                
                <span title="本文字数">42k</span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">38 分钟</span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="Hbase"><a href="#Hbase" class="headerlink" title="Hbase"></a>Hbase</h1><h2 id="一概述"><a href="#一概述" class="headerlink" title="一概述"></a>一概述</h2><p>hbase是bigtable的开源java版本。是建立在hdfs之上，提供高可靠性、高性能、列存储、可伸缩、实时读写nosql的数据库系统。</p>
<p>它介于nosql和RDBMS之间，仅能通过主键(row key)和主键的range来检索数据，仅支持单行事务(可通过hive支持来实现多表join等复杂操作)。</p>
<p>主要用来存储结构化和半结构化的松散数据。</p>
<p>Hbase查询数据功能很简单，不支持join等复杂操作，不支持复杂的事务（行级的事务）</p>
<p>Hbase中只支持的数据类型为：byte[]</p>
<p>与hadoop一样，Hbase目标主要依靠横向扩展，通过不断增加廉价的商用服务器，来增加计算和存储能力。</p>
<p>HBase中的表一般有这样的特点：</p>
<p>²  大：一个表可以有上十亿行，上百万列</p>
<p>²  面向列:面向列(族)的存储和权限控制，列(族)独立检索。</p>
<p>²  稀疏:对于为空(null)的列，并不占用存储空间，因此，表可以设计的非常稀疏。</p>
<p>HBase的发展历程</p>
<p>HBase的原型是Google的BigTable论文，受到了该论文思想的启发，目前作为Hadoop的子项目来开发维护，用于支持结构化的数据存储。</p>
<p>官方网站：<a href="http://hbase.apache.org" target="_blank" rel="noopener">http://hbase.apache.org</a></p>
<p>* 2006年Google发表BigTable白皮书</p>
<p>* 2006年开始开发HBase</p>
<p>* 2008  HBase成为了 Hadoop的子项目</p>
<p>* 2010年HBase成为Apache顶级项目</p>
<h2 id="二HBASE与Hadoop的关系"><a href="#二HBASE与Hadoop的关系" class="headerlink" title="二HBASE与Hadoop的关系"></a>二HBASE与Hadoop的关系</h2><h2 id="1、HDFS"><a href="#1、HDFS" class="headerlink" title="1、HDFS"></a>1、HDFS</h2><p>* 为分布式存储提供文件系统</p>
<p>* 针对存储大尺寸的文件进行优化，不需要对HDFS上的文件进行随机读写</p>
<p>* 直接使用文件</p>
<p>* 数据模型不灵活</p>
<p>* 使用文件系统和处理框架</p>
<p>* 优化一次写入，多次读取的方式</p>
<h2 id="2、HBase"><a href="#2、HBase" class="headerlink" title="2、HBase"></a>2、HBase</h2><p>* 提供表状的面向列的数据存储</p>
<p>* 针对表状数据的随机读写进行优化</p>
<p>* 使用key-value操作数据</p>
<p>* 提供灵活的数据模型</p>
<p>* 使用表状存储，支持MapReduce，依赖HDFS</p>
<p>* 优化了多次读，以及多次写</p>
<p>hbase是基于hdfs的，hbase的数据都是存储在hdfs上面的。hbase支持随机读写，hbase的数据存储在hdfs上面的，hbase是如何基于hdfs的数据做到随机读写的？？</p>
<h2 id="三rdbms与HBASE的关系"><a href="#三rdbms与HBASE的关系" class="headerlink" title="三rdbms与HBASE的关系"></a>三rdbms与HBASE的关系</h2><h2 id="1、关系型数据库"><a href="#1、关系型数据库" class="headerlink" title="1、关系型数据库"></a>1、关系型数据库</h2><p><strong>结构：</strong></p>
<p>* 数据库以表的形式存在</p>
<p>* 支持FAT、NTFS、EXT、文件系统</p>
<p>* 使用Commit log存储日志</p>
<p>* 参考系统是坐标系统</p>
<p>* 使用主键（PK）</p>
<p>* 支持分区</p>
<p>* 使用行、列、单元格</p>
<p><strong>功能：</strong></p>
<p>* 支持向上扩展</p>
<p>* 使用SQL查询</p>
<p>* 面向行，即每一行都是一个连续单元</p>
<p>* 数据总量依赖于服务器配置</p>
<p>* 具有ACID支持</p>
<p>* 适合结构化数据</p>
<p>* 传统关系型数据库一般都是中心化的</p>
<p>* 支持事务</p>
<p>* 支持Join</p>
<h2 id="2、HBase-1"><a href="#2、HBase-1" class="headerlink" title="2、HBase"></a>2、HBase</h2><p><strong>结构：</strong></p>
<p>* 数据库以region的形式存在</p>
<p>* 支持HDFS文件系统</p>
<p>* 使用WAL（Write-Ahead Logs）存储日志</p>
<p>* 参考系统是Zookeeper</p>
<p>* 使用行键（row key）</p>
<p>* 支持分片</p>
<p>* 使用行、列、列族和单元格</p>
<p><strong>功能：</strong></p>
<p>* 支持向外扩展</p>
<p>* 使用API和MapReduce来访问HBase表数据</p>
<p>* 面向列，即每一列都是一个连续的单元</p>
<p>* 数据总量不依赖具体某台机器，而取决于机器数量</p>
<p>* HBase不支持ACID（Atomicity、Consistency、Isolation、Durability）</p>
<p>* 适合结构化数据和非结构化数据</p>
<p>* 一般都是分布式的</p>
<p>* HBase不支持事务，支持的是单行数据的事务操作</p>
<p>* 不支持Join</p>
<h2 id="四-hbase-特点"><a href="#四-hbase-特点" class="headerlink" title="四 hbase 特点"></a>四 hbase 特点</h2><p><strong>1**</strong>）海量存储**</p>
<p>Hbase适合存储PB级别的海量数据，在PB级别的数据以及采用廉价PC存储的情况下，能在几十到百毫秒内返回数据。这与Hbase的极易扩展性息息相关。正式因为Hbase良好的扩展性，才为海量数据的存储提供了便利。</p>
<p><strong>2**</strong>）列式存储**</p>
<p>这里的列式存储其实说的是列族存储，Hbase是根据列族来存储数据的。列族下面可以有非常多的列，列族在创建表的时候就必须指定。</p>
<p><strong>3**</strong>）极易扩展**</p>
<p>Hbase的扩展性主要体现在两个方面，一个是基于上层处理能力（RegionServer）的扩展，一个是基于存储的扩展（HDFS）。<br> 通过横向添加RegionSever的机器，进行水平扩展，提升Hbase上层的处理能力，提升Hbsae服务更多Region的能力。</p>
<p>备注：RegionServer的作用是管理region、承接业务的访问，这个后面会详细的介绍通过横向添加Datanode的机器，进行存储层扩容，提升Hbase的数据存储能力和提升后端存储的读写能力。</p>
<p><strong>4**</strong>）高并发**</p>
<p>由于目前大部分使用Hbase的架构，都是采用的廉价PC，因此单个IO的延迟其实并不小，一般在几十到上百ms之间。这里说的高并发，主要是在并发的情况下，Hbase的单个IO延迟下降并不多。能获得高并发、低延迟的服务。</p>
<p><strong>5**</strong>）稀疏**</p>
<p>稀疏主要是针对Hbase列的灵活性，在列族中，你可以指定任意多的列，在列数据为空的情况下，是不会占用存储空间的。</p>
<h2 id="五架构"><a href="#五架构" class="headerlink" title="五架构"></a>五架构</h2><p><img src="/images/Hbase/hbase架构.png" alt="img"></p>
<p><img src="/images/Hbase/hbase2.png" alt="img"></p>
<h2 id="1、HMaster"><a href="#1、HMaster" class="headerlink" title="1、HMaster"></a>1、HMaster</h2><p><strong>功能：</strong></p>
<p>1) 监控RegionServer</p>
<p>2) 处理RegionServer故障转移</p>
<p>3) 处理元数据的变更</p>
<p>4) 处理region的分配或移除</p>
<p>5) 在空闲时间进行数据的负载均衡</p>
<p>6) 通过Zookeeper发布自己的位置给客户端</p>
<h2 id="2、RegionServer"><a href="#2、RegionServer" class="headerlink" title="2、RegionServer"></a>2、RegionServer</h2><p><strong>功能：</strong></p>
<p>1) 负责存储HBase的实际数据</p>
<p>2) 处理分配给它的Region</p>
<p>3) 刷新缓存到HDFS</p>
<p>4) 维护HLog</p>
<p>5) 执行压缩</p>
<p>6) 负责处理Region分片</p>
<p><strong>组件：</strong></p>
<p><strong>1) Write-Ahead logs</strong></p>
<p>HBase的修改记录，当对HBase读写数据的时候，数据不是直接写进磁盘，它会在内存中保留一段时间（时间以及数据量阈值可以设定）。但把数据保存在内存中可能有更高的概率引起数据丢失，为了解决这个问题，数据会先写在一个叫做Write-Ahead logfile的文件中，然后再写入内存中。所以在系统出现故障的时候，数据可以通过这个日志文件重建。</p>
<p><strong>2) HFile</strong></p>
<p>这是在磁盘上保存原始数据的实际的物理文件，是实际的存储文件。</p>
<p><strong>3) Store</strong></p>
<p>HFile存储在Store中，一个Store对应HBase表中的一个列族。</p>
<p><strong>4) MemStore</strong></p>
<p>顾名思义，就是内存存储，位于内存中，用来保存当前的数据操作，所以当数据保存在WAL中之后，RegsionServer会在内存中存储键值对。</p>
<p><strong>5) Region</strong></p>
<p>Hbase表的分片，HBase表会根据RowKey值被切分成不同的region存储在RegionServer中，在一个RegionServer中可以有多个不同的region。</p>
<p><strong>存储架构:</strong></p>
<p>主节点：HMaster</p>
<p>​    监控regionServer的健康状态</p>
<p>​    处理regionServer的故障转移</p>
<p>​    处理元数据变更</p>
<p>​    处理region的分配或者移除</p>
<p>​    空闲时间做数据的负载均衡</p>
<p>从节点：HRegionServer</p>
<p>​    负责存储HBase的实际数据</p>
<p>​    处理分配给他的region</p>
<p>​    刷新缓存的数据到HDFS上面去  </p>
<p>​    维护HLog</p>
<p>​    执行数据的压缩</p>
<p>​    负责处理region的分片</p>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">一个HRegionServer = <span class="number">1</span>个HLog  +  很多个region</span><br><span class="line"><span class="number">1</span>个region  = 很多个store模块</span><br><span class="line"><span class="number">1</span>个store模块 =  <span class="number">1</span>个memoryStore + 很多个storeFile    当memoryStore达到<span class="number">128</span>m或者一个小时 会落地到storeFile中</span><br><span class="line">HLog：hbase当中预写日志模块，write ahead  log</span><br></pre></td></tr></table></figure>
<figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">将storeFile 文件合并压缩存到hdfs上格式Hfile</span><br><span class="line">当memoryStore达到128m或者一个小时 会落地到storeFile中</span><br><span class="line">当hdfs的数据达到阀值,会分<span class="built_in">region</span>,创建另一个<span class="built_in">region</span>存储这个数据  用其他的HregionServer 管理  对比MySQL的分库分表</span><br></pre></td></tr></table></figure>
<h2 id="六集群搭建"><a href="#六集群搭建" class="headerlink" title="六集群搭建"></a>六集群搭建</h2><p>注意事项：Hbase强依赖于HDFS以及zookeeper，所以安装Hbase之前一定要保证Hadoop和zookeeper正常启动</p>
<p>上传压缩包并解压:</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -zxf hbase-<span class="number">2.0</span>.<span class="number">0</span>-bin<span class="selector-class">.tar</span><span class="selector-class">.gz</span> -C /export/servers/</span><br></pre></td></tr></table></figure>
<p>修改配置文件</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd <span class="regexp">/export/</span>servers<span class="regexp">/hbase-2.0.0/</span>conf</span><br></pre></td></tr></table></figure>
<p>1 修改hbase-env.sh</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vim hbase-env.sh</span><br><span class="line"></span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">JAVA_HOME</span>=/export/servers/jdk1.8.0_141</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">HBASE_MANAGES_ZK</span>=<span class="literal">false</span></span><br></pre></td></tr></table></figure>
<p>2 修改hbase-site.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">cd /export/servers/hbase-2.0.0/conf</span><br><span class="line">vim hbase-site.xml</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"> <span class="comment">&lt;!-- hbase根路径 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">name</span>&gt;</span>hbase.rootdir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>hdfs://node01:8020/hbase<span class="tag">&lt;/<span class="name">value</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 指定hbase为分布式 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">name</span>&gt;</span>hbase.cluster.distributed<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="comment">&lt;!-- 0.98后的新变动，之前版本没有.port,默认端口为60000 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">name</span>&gt;</span>hbase.master.port<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>16000<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">name</span>&gt;</span>hbase.zookeeper.quorum<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>node01:2181,node02:2181,node03:2181<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 指顶存在哪里 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">name</span>&gt;</span>hbase.zookeeper.property.dataDir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">value</span>&gt;</span>/export/servers/zookeeper-3.4.9/zkdatas<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>3 修改regionservers</p>
<figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">node01</span></span><br><span class="line"><span class="symbol">node02</span></span><br><span class="line"><span class="symbol">node03</span></span><br></pre></td></tr></table></figure>
<p>4 创建back-masters文件</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cd</span> /export/servers/hbase-<span class="number">2.0</span>.<span class="number">0</span>/<span class="keyword">conf</span></span><br><span class="line"><span class="keyword">vim</span> backup-masters</span><br><span class="line">node02</span><br></pre></td></tr></table></figure>
<p>向其他节点发送安装包:</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">scp</span> -r hbase-<span class="number">2</span>.<span class="number">0</span>.<span class="number">0</span>/ node02:<span class="variable">$PWD</span></span><br></pre></td></tr></table></figure>
<p>三台节点都要创建软连接</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ln -s <span class="regexp">/export/</span>servers<span class="regexp">/hadoop-2.7.5/</span>etc<span class="regexp">/hadoop/</span>core-site.xml <span class="regexp">/export/</span>servers<span class="regexp">/hbase-2.0.0/</span>conf/core-site.xml</span><br><span class="line">ln -s <span class="regexp">/export/</span>servers<span class="regexp">/hadoop-2.7.5/</span>etc<span class="regexp">/hadoop/</span>hdfs-site.xml <span class="regexp">/export/</span>servers<span class="regexp">/hbase-2.0.0/</span>conf/hdfs-site.xml</span><br></pre></td></tr></table></figure>
<p>三台节点都要配值环境变量;</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/profile</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">HBASE_HOME</span>=/export/servers/hbase-2.0.0</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">PATH</span>=:$HBASE_HOME/bin:$PATH</span><br></pre></td></tr></table></figure>
<p>集群启动:</p>
<p>1在第一台机器上:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /<span class="built_in">export</span>/servers/hbase-2.0.0</span><br><span class="line">bin/start-hbase.sh</span><br></pre></td></tr></table></figure>
<p>警告提示：HBase启动的时候会产生一个警告，这是因为jdk7与jdk8的问题导致的，如果linux服务器安装jdk8就会产生这样的一个警告</p>
<p>我们可以只是掉所有机器的hbase-env.sh当中的</p>
<p>“HBASE_MASTER_OPTS”和“HBASE_REGIONSERVER_OPTS”配置 来解决这个问题。不过警告不影响我们正常运行，可以不用解决</p>
<p>2另外一种启动方式：</p>
<p>我们也可以执行以下命令单节点进行启动</p>
<p>启动HMaster命令</p>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/hbase-daemon.sh <span class="literal">start</span> <span class="literal">master</span></span><br></pre></td></tr></table></figure>
<p>启动HRegionServer命令</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/hbase-daemon<span class="selector-class">.sh</span> start regionserver</span><br></pre></td></tr></table></figure>
<p>页面访问:</p>
<figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span><span class="comment">//node02:16010/master-status</span></span><br><span class="line"><span class="symbol">http:</span><span class="comment">//node01:16010/master-status</span></span><br></pre></td></tr></table></figure>
<h2 id="HBase的表模型"><a href="#HBase的表模型" class="headerlink" title="HBase的表模型"></a>HBase的表模型</h2><p>rowKey：行键，每一条数据都是使用行键来进行唯一标识的</p>
<p>columnFamily：列族。列族下面可以有很多列</p>
<p>column：列的概念。每一个列都必须归属于某一个列族</p>
<p>timestamp：时间戳，每条数据都会有时间戳的概念</p>
<p>versionNum：版本号，每条数据都会有版本号，每次数据变化，版本号都会进行更新</p>
<h2 id="七-HBASE常用shell操作"><a href="#七-HBASE常用shell操作" class="headerlink" title="七 HBASE常用shell操作"></a>七 HBASE常用shell操作</h2><h2 id="1、进入HBase客户端命令操作界面"><a href="#1、进入HBase客户端命令操作界面" class="headerlink" title="1、进入HBase客户端命令操作界面"></a>1、进入HBase客户端命令操作界面</h2><p>node01服务器执行以下命令进入hbase的shell客户端</p>
<figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">cd</span> /<span class="meta">export</span>/servers/hbase-<span class="number">2</span>.<span class="number">0</span>.<span class="number">0</span></span><br><span class="line"><span class="keyword">bin/hbase </span>shell</span><br></pre></td></tr></table></figure>
<h2 id="2、查看帮助命令"><a href="#2、查看帮助命令" class="headerlink" title="2、查看帮助命令"></a>2、查看帮助命令</h2><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">hbase</span>(main)<span class="selector-pseudo">:001</span><span class="selector-pseudo">:0</span>&gt; <span class="selector-tag">help</span></span><br></pre></td></tr></table></figure>
<h2 id="3、查看当前数据库中有哪些表"><a href="#3、查看当前数据库中有哪些表" class="headerlink" title="3、查看当前数据库中有哪些表"></a>3、查看当前数据库中有哪些表</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hbase(main):002:0&gt; list</span><br></pre></td></tr></table></figure>
<h2 id="4、创建一张表"><a href="#4、创建一张表" class="headerlink" title="4、创建一张表"></a>4、创建一张表</h2><p>创建user表，包含info、data两个列族</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hbase(main):010:0&gt; create 'user', 'info', 'data'</span><br><span class="line">或者</span><br><span class="line">hbase(main):010:0&gt; create 'user', &#123;NAME =&gt; 'info', VERSIONS =&gt; '3'&#125;，&#123;NAME =&gt; 'data'&#125;</span><br></pre></td></tr></table></figure>
<p>若建表时指定了多个版本,则在更新操作时,会保存多个版本 ,会把以前的也会保存,但查询时,查到的是最新的,若想获取以前的可以指定版本去查询.</p>
<h2 id="5、添加数据操作"><a href="#5、添加数据操作" class="headerlink" title="5、添加数据操作"></a>5、添加数据操作</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">向user表中插入信息，row key为rk0001，列族info中添加name列标示符，值为zhangsan</span><br><span class="line">hbase(main):011:0&gt; put 'user', 'rk0001', 'info:name', 'zhangsan'</span><br><span class="line">向user表中插入信息，row key为rk0001，列族info中添加gender列标示符，值为female</span><br><span class="line">hbase(main):012:0&gt; put 'user', 'rk0001', 'info:gender', 'female'</span><br><span class="line">向user表中插入信息，row key为rk0001，列族info中添加age列标示符，值为20</span><br><span class="line">hbase(main):013:0&gt; put 'user', 'rk0001', 'info:age', 20</span><br><span class="line">向user表中插入信息，row key为rk0001，列族data中添加pic列标示符，值为picture</span><br><span class="line">hbase(main):014:0&gt; put 'user', 'rk0001', 'data:pic', 'picture'</span><br></pre></td></tr></table></figure>
<h2 id="6、查询数据操作"><a href="#6、查询数据操作" class="headerlink" title="6、查询数据操作"></a>6、查询数据操作</h2><p>第一种查询方式：  get  rowkey   直接获取某一条数据</p>
<p>第二种查询方式  ：  scan  startRow   stopRow   范围值扫描</p>
<p>第三种查询方式：scan   tableName   全表扫描</p>
<h3 id="1、通过rowkey进行查询"><a href="#1、通过rowkey进行查询" class="headerlink" title="1、通过rowkey进行查询"></a>1、通过rowkey进行查询</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">获取user表中row key为rk0001的所有信息</span><br><span class="line"></span><br><span class="line">hbase(main):015:0&gt; get 'user', 'rk0001'</span><br></pre></td></tr></table></figure>
<h3 id="2、查看rowkey下面的某个列族的信息"><a href="#2、查看rowkey下面的某个列族的信息" class="headerlink" title="2、查看rowkey下面的某个列族的信息"></a>2、查看rowkey下面的某个列族的信息</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">获取user表中row key为rk0001，info列族的所有信息</span><br><span class="line"></span><br><span class="line">hbase(main):016:0&gt; get 'user', 'rk0001', 'info'</span><br></pre></td></tr></table></figure>
<h3 id="3、查看rowkey指定列族指定字段的值"><a href="#3、查看rowkey指定列族指定字段的值" class="headerlink" title="3、查看rowkey指定列族指定字段的值"></a>3、查看rowkey指定列族指定字段的值</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">获取user表中row key为rk0001，info列族的name、age列标示符的信息</span><br><span class="line"></span><br><span class="line">hbase(main):017:0&gt; get 'user', 'rk0001', 'info:name', 'info:age'</span><br></pre></td></tr></table></figure>
<h3 id="4、查看rowkey指定多个列族的信息"><a href="#4、查看rowkey指定多个列族的信息" class="headerlink" title="4、查看rowkey指定多个列族的信息"></a>4、查看rowkey指定多个列族的信息</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">获取user表中row key为rk0001，info、data列族的信息</span><br><span class="line">hbase(main):018:0&gt; get 'user', 'rk0001', 'info', 'data'</span><br><span class="line">或者你也可以这样写</span><br><span class="line">hbase(main):019:0&gt; get 'user', 'rk0001', &#123;COLUMN =&gt; ['info', 'data']&#125;</span><br><span class="line">或者你也可以这样写，也行</span><br><span class="line">hbase(main):020:0&gt; get 'user', 'rk0001', &#123;COLUMN =&gt; ['info:name', 'data:pic']&#125;</span><br></pre></td></tr></table></figure>
<h3 id="4、指定rowkey与列值查询"><a href="#4、指定rowkey与列值查询" class="headerlink" title="4、指定rowkey与列值查询"></a>4、指定rowkey与列值查询</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">获取user表中row key为rk0001，cell的值为zhangsan的信息</span><br><span class="line"></span><br><span class="line">hbase(main):030:0&gt; get 'user', 'rk0001', &#123;FILTER =&gt; "ValueFilter(=, 'binary:zhangsan')"&#125;</span><br></pre></td></tr></table></figure>
<h3 id="5、指定rowkey与列值模糊查询"><a href="#5、指定rowkey与列值模糊查询" class="headerlink" title="5、指定rowkey与列值模糊查询"></a>5、指定rowkey与列值模糊查询</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">获取user表中row key为rk0001，列标示符中含有a的信息</span><br><span class="line">hbase(main):031:0&gt; get 'user', 'rk0001', &#123;FILTER =&gt; "(QualifierFilter(=,'substring:a'))"&#125;</span><br><span class="line">继续插入一批数据</span><br><span class="line">hbase(main):032:0&gt; put 'user', 'rk0002', 'info:name', 'fanbingbing'</span><br><span class="line">hbase(main):033:0&gt; put 'user', 'rk0002', 'info:gender', 'female'</span><br><span class="line">hbase(main):034:0&gt; put 'user', 'rk0002', 'info:nationality', '中国'</span><br><span class="line">hbase(main):035:0&gt; get 'user', 'rk0002', &#123;FILTER =&gt; "ValueFilter(=, 'binary:中国')"&#125;</span><br></pre></td></tr></table></figure>
<h3 id="6、查询所有数据"><a href="#6、查询所有数据" class="headerlink" title="6、查询所有数据"></a>6、查询所有数据</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">查询user表中的所有信息</span><br><span class="line">scan 'user'</span><br></pre></td></tr></table></figure>
<h3 id="7、列族查询"><a href="#7、列族查询" class="headerlink" title="7、列族查询"></a>7、列族查询</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">查询user表中列族为info的信息</span><br><span class="line"></span><br><span class="line">scan <span class="string">'user'</span>, &#123;<span class="function"><span class="params">COLUMNS</span> =&gt;</span> <span class="string">'info'</span>&#125;</span><br><span class="line">scan <span class="string">'user'</span>, &#123;<span class="function"><span class="params">COLUMNS</span> =&gt;</span> <span class="string">'info'</span>, <span class="function"><span class="params">RAW</span> =&gt;</span> <span class="literal">true</span>, <span class="function"><span class="params">VERSIONS</span> =&gt;</span> <span class="number">5</span>&#125;</span><br><span class="line">scan <span class="string">'user'</span>, &#123;<span class="function"><span class="params">COLUMNS</span> =&gt;</span> <span class="string">'info'</span>, <span class="function"><span class="params">RAW</span> =&gt;</span> <span class="literal">true</span>, <span class="function"><span class="params">VERSIONS</span> =&gt;</span> <span class="number">3</span>&#125;</span><br></pre></td></tr></table></figure>
<h3 id="8、多列族查询"><a href="#8、多列族查询" class="headerlink" title="8、多列族查询"></a>8、多列族查询</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">查询user表中列族为info和data的信息</span><br><span class="line"></span><br><span class="line">scan 'user', &#123;COLUMNS =&gt; ['info', 'data']&#125;</span><br><span class="line">scan 'user', &#123;COLUMNS =&gt; ['info:name', 'data:pic']&#125;</span><br></pre></td></tr></table></figure>
<h3 id="9、指定列族与某个列名查询"><a href="#9、指定列族与某个列名查询" class="headerlink" title="9、指定列族与某个列名查询"></a>9、指定列族与某个列名查询</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">查询user表中列族为info、列标示符为name的信息</span><br><span class="line"></span><br><span class="line">scan 'user', &#123;COLUMNS =&gt; 'info:name'&#125;</span><br></pre></td></tr></table></figure>
<h3 id="10、指定列族与列名以及限定版本查询"><a href="#10、指定列族与列名以及限定版本查询" class="headerlink" title="10、指定列族与列名以及限定版本查询"></a>10、指定列族与列名以及限定版本查询</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">查询user表中列族为info、列标示符为name的信息,并且版本最新的5个</span><br><span class="line"></span><br><span class="line">scan 'user', &#123;COLUMNS =&gt; 'info:name', VERSIONS =&gt; 5&#125;</span><br></pre></td></tr></table></figure>
<h3 id="11、指定多个列族与按照数据值模糊查询"><a href="#11、指定多个列族与按照数据值模糊查询" class="headerlink" title="11、指定多个列族与按照数据值模糊查询"></a>11、指定多个列族与按照数据值模糊查询</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">查询user表中列族为info和data且列标示符中含有a字符的信息</span><br><span class="line"></span><br><span class="line">scan 'user', &#123;COLUMNS =&gt; ['info', 'data'], FILTER =&gt; "(QualifierFilter(=,'substring:a'))"&#125;</span><br></pre></td></tr></table></figure>
<h3 id="12、rowkey的范围值查询"><a href="#12、rowkey的范围值查询" class="headerlink" title="12、rowkey的范围值查询"></a>12、rowkey的范围值查询</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">查询user表中列族为info，rk范围是[rk0001, rk0003)的数据</span><br><span class="line"></span><br><span class="line">scan 'user', &#123;COLUMNS =&gt; 'info', STARTROW =&gt; 'rk0001', ENDROW =&gt; 'rk0003'&#125;</span><br></pre></td></tr></table></figure>
<h3 id="13、指定rowkey模糊查询"><a href="#13、指定rowkey模糊查询" class="headerlink" title="13、指定rowkey模糊查询"></a>13、指定rowkey模糊查询</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">查询user表中row key以rk字符开头的</span><br><span class="line"></span><br><span class="line">scan 'user',&#123;FILTER=&gt;"PrefixFilter('rk')"&#125;</span><br></pre></td></tr></table></figure>
<h3 id="14、指定数据范围值查询"><a href="#14、指定数据范围值查询" class="headerlink" title="14、指定数据范围值查询"></a>14、指定数据范围值查询</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">查询user表中指定范围的数据</span><br><span class="line"></span><br><span class="line">scan 'user', &#123;TIMERANGE =&gt; [1392368783980, 1392380169184]&#125;</span><br></pre></td></tr></table></figure>
<h2 id="7、更新数据操作"><a href="#7、更新数据操作" class="headerlink" title="7、更新数据操作"></a>7、更新数据操作</h2><h3 id="1、更新数据值"><a href="#1、更新数据值" class="headerlink" title="1、更新数据值"></a>1、更新数据值</h3><p>更新操作同插入操作一模一样，只不过有数据就更新，没数据就添加</p>
<h3 id="2、更新版本号"><a href="#2、更新版本号" class="headerlink" title="2、更新版本号"></a>2、更新版本号</h3><p>将user表的f1列族版本号改为5</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter <span class="string">'user'</span>,<span class="function"><span class="params">NAME</span> =&gt;</span><span class="string">'info'</span>,<span class="function"><span class="params">VERSIONS</span> =&gt;</span><span class="number">5</span></span><br></pre></td></tr></table></figure>
<h2 id="8、删除数据以及删除表操作"><a href="#8、删除数据以及删除表操作" class="headerlink" title="8、删除数据以及删除表操作"></a>8、删除数据以及删除表操作</h2><h3 id="1、指定rowkey以及列名进行删除"><a href="#1、指定rowkey以及列名进行删除" class="headerlink" title="1、指定rowkey以及列名进行删除"></a>1、指定rowkey以及列名进行删除</h3><figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">删除user表row<span class="built_in"> key</span>为rk0001，列标示符为info:name的数据</span><br><span class="line"><span class="keyword">delete</span> <span class="string">'user'</span>,<span class="string">'rk001'</span>,<span class="string">'info;name'</span></span><br></pre></td></tr></table></figure>
<h3 id="2、指定rowkey，列名以及字段值进行删除"><a href="#2、指定rowkey，列名以及字段值进行删除" class="headerlink" title="2、指定rowkey，列名以及字段值进行删除"></a>2、指定rowkey，列名以及字段值进行删除</h3><figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">删除user表row<span class="built_in"> key</span>为rk0001，列标示符为info:name，timestamp为<span class="number">1392383705316</span>的数据</span><br><span class="line"><span class="keyword">delete</span> <span class="string">'user'</span>,<span class="string">'rk001'</span>,<span class="string">'info:name'</span>,<span class="number">1392383705316</span></span><br></pre></td></tr></table></figure>
<h3 id="3、删除一个列族"><a href="#3、删除一个列族" class="headerlink" title="3、删除一个列族"></a>3、删除一个列族</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">alter <span class="string">'user'</span>,<span class="function"><span class="params">NAME</span> =&gt;</span> <span class="string">'info'</span>,<span class="function"><span class="params">METHOD</span> =&gt;</span><span class="string">'delete'</span></span><br><span class="line">或者</span><br><span class="line">alter <span class="string">'user'</span>,<span class="string">'delete'</span> =&gt;<span class="string">'info'</span></span><br></pre></td></tr></table></figure>
<h3 id="4、清空表数据"><a href="#4、清空表数据" class="headerlink" title="4、清空表数据"></a>4、清空表数据</h3><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">truncate</span> <span class="string">'user'</span></span><br></pre></td></tr></table></figure>
<h3 id="5、删除表"><a href="#5、删除表" class="headerlink" title="5、删除表"></a>5、删除表</h3><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">该表处于disable状态:</span><br><span class="line">disable <span class="string">'user'</span></span><br><span class="line">然后删除表:</span><br><span class="line">drop <span class="string">'user'</span></span><br><span class="line">如直接drop表 会报错 Drop the named <span class="keyword">table</span>. <span class="keyword">Table</span> <span class="comment">must first be disabled</span></span><br></pre></td></tr></table></figure>
<h2 id="9、统计一张表有多少行数据"><a href="#9、统计一张表有多少行数据" class="headerlink" title="9、统计一张表有多少行数据"></a>9、统计一张表有多少行数据</h2><figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">count</span> <span class="string">'user'</span></span><br></pre></td></tr></table></figure>
<h2 id="八-HBASE的高级shell管理命令"><a href="#八-HBASE的高级shell管理命令" class="headerlink" title="八   HBASE的高级shell管理命令"></a>八   HBASE的高级shell管理命令</h2><h2 id="1、status"><a href="#1、status" class="headerlink" title="1、status"></a>1、status</h2><p>例如：显示服务器状态</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">status</span> <span class="string">'node01'</span></span><br></pre></td></tr></table></figure>
<h2 id="2、whoami"><a href="#2、whoami" class="headerlink" title="2、whoami"></a>2、whoami</h2><p>显示HBase当前用户，例如：</p>
<figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">whoami</span></span><br></pre></td></tr></table></figure>
<h2 id="3、list"><a href="#3、list" class="headerlink" title="3、list"></a>3、list</h2><p>显示当前所有的表</p>
<h2 id="4、count"><a href="#4、count" class="headerlink" title="4、count"></a>4、count</h2><p>统计指定表的记录数，例如：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">hbase&gt;</span><span class="bash"> count <span class="string">'user'</span></span></span><br></pre></td></tr></table></figure>
<h2 id="5、describe"><a href="#5、describe" class="headerlink" title="5、describe"></a>5、describe</h2><p>展示表结构信息</p>
<h2 id="6、exists"><a href="#6、exists" class="headerlink" title="6、exists"></a>6、exists</h2><p>检查表是否存在，适用于表量特别多的情况</p>
<h2 id="7、is-enabled、is-disabled"><a href="#7、is-enabled、is-disabled" class="headerlink" title="7、is_enabled、is_disabled"></a>7、is_enabled、is_disabled</h2><p>检查表是否启用或禁用</p>
<h2 id="8、alter"><a href="#8、alter" class="headerlink" title="8、alter"></a>8、alter</h2><p>该命令可以改变表和列族的模式，例如：</p>
<p><strong>为当前表增加列族：</strong></p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter <span class="string">'user'</span>,<span class="function"><span class="params">NAME</span>=&gt;</span> <span class="string">'CF2'</span>,<span class="function"><span class="params">versions</span> =&gt;</span><span class="number">2</span></span><br></pre></td></tr></table></figure>
<p><strong>为当前表删除列族：</strong></p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter <span class="string">'user'</span>.<span class="string">'delete'</span>=&gt;<span class="string">'cf2'</span></span><br></pre></td></tr></table></figure>
<h2 id="9、disable-enable"><a href="#9、disable-enable" class="headerlink" title="9、disable/enable"></a>9、disable/enable</h2><p>禁用一张表/启用一张表</p>
<h2 id="10、drop"><a href="#10、drop" class="headerlink" title="10、drop"></a>10、drop</h2><p>删除一张表，记得在删除表之前必须先禁用</p>
<h2 id="11、truncate"><a href="#11、truncate" class="headerlink" title="11、truncate"></a>11、truncate</h2><p>禁用表-删除表-创建表</p>
<h2 id="九-HBASE的java代码开发"><a href="#九-HBASE的java代码开发" class="headerlink" title="九 HBASE的java代码开发"></a>九 HBASE的java代码开发</h2><p>依赖:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"> <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.apache.hbase/hbase-client --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.hbase<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hbase-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.apache.hbase/hbase-server --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.hbase<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hbase-server<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    			<span class="tag">&lt;<span class="name">version</span>&gt;</span>2.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.testng<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>testng<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>6.14.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">source</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">source</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">target</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">target</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">encoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">encoding</span>&gt;</span></span><br><span class="line">                    <span class="comment">&lt;!--    &lt;verbal&gt;true&lt;/verbal&gt;--&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>步骤</p>
<figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">一 配置类  设置zookeeper的连接地址</span><br><span class="line"><span class="bullet">* </span>二根据 配置传参  得到连接对象</span><br><span class="line"><span class="bullet">* </span>三 根据连接对象 得到管理员对象</span><br><span class="line"><span class="bullet">* </span>四创建表的对象  创建列簇的对象  将列簇的对象添加到 表对象</span><br><span class="line"><span class="bullet">* </span>五 管理员对象创建表  并将表对象传入</span><br></pre></td></tr></table></figure>
<p><strong>1创建表</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 创建hbase表 myuser，带有两个列族 f1  f2</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">createTable</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">      <span class="comment">//连接hbase集群</span></span><br><span class="line">      Configuration configuration = HBaseConfiguration.create();</span><br><span class="line">      <span class="comment">//指定hbase的zk连接地址</span></span><br><span class="line">      configuration.set(<span class="string">"hbase.zookeeper.quorum"</span>,<span class="string">"node01:2181,node02:2181,node03:2181"</span>);</span><br><span class="line">      Connection connection = ConnectionFactory.createConnection(configuration);</span><br><span class="line">      <span class="comment">//获取管理员对象</span></span><br><span class="line">      Admin admin = connection.getAdmin();</span><br><span class="line">      <span class="comment">//通过管理员对象创建表</span></span><br><span class="line">      HTableDescriptor hTableDescriptor = <span class="keyword">new</span> HTableDescriptor(TableName.valueOf(<span class="string">"myuser"</span>));</span><br><span class="line">      <span class="comment">//给我们的表添加列族，指定两个列族  f1   f2</span></span><br><span class="line">      HColumnDescriptor f1 = <span class="keyword">new</span> HColumnDescriptor(<span class="string">"f1"</span>);</span><br><span class="line">      HColumnDescriptor f2 = <span class="keyword">new</span> HColumnDescriptor(<span class="string">"f2"</span>);</span><br><span class="line">      <span class="comment">//将两个列族设置到  hTableDescriptor里面去</span></span><br><span class="line">      hTableDescriptor.addFamily(f1);</span><br><span class="line">      hTableDescriptor.addFamily(f2);</span><br><span class="line">      <span class="comment">//创建表</span></span><br><span class="line">      admin.createTable(hTableDescriptor);</span><br><span class="line">      <span class="comment">//关闭资源</span></span><br><span class="line">      admin.close();</span><br><span class="line">      connection.close();</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p><strong>2插入数据</strong></p>
<p>步骤</p>
<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">一 配置类 设置zookeeper连接地址</span><br><span class="line">二  根据配置类 获取连接对象</span><br><span class="line">三  根据连接对象 获得表对象 传参为表名 </span><br><span class="line">四  <span class="keyword">new</span>一个<span class="built_in">put</span>对象 传参为 rowkey的值得字节数组</span><br><span class="line">五  根据<span class="built_in">put</span>对象 添加例</span><br><span class="line">六 表对象 调<span class="built_in">put</span>方法 传参为<span class="built_in">put</span>对象  </span><br><span class="line">七  关闭表</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/***</span></span><br><span class="line"><span class="comment">    * 向表当中添加数据</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@Test</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span>  <span class="keyword">void</span>  <span class="title">addData</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">       <span class="comment">//获取连接</span></span><br><span class="line">       Configuration configuration = HBaseConfiguration.create();</span><br><span class="line">       configuration.set(<span class="string">"hbase.zookeeper.quorum"</span>,<span class="string">"node01:2181,node02:2181,node03:2181"</span>);</span><br><span class="line">       Connection connection = ConnectionFactory.createConnection(configuration);</span><br><span class="line">       <span class="comment">//获取表对象</span></span><br><span class="line">       Table myuser = connection.getTable(TableName.valueOf(<span class="string">"myuser"</span>));</span><br><span class="line">       Put put = <span class="keyword">new</span> Put(<span class="string">"0001"</span>.getBytes());</span><br><span class="line">       put.addColumn(<span class="string">"f1"</span>.getBytes(),<span class="string">"id"</span>.getBytes(), Bytes.toBytes(<span class="number">1</span>));</span><br><span class="line">       put.addColumn(<span class="string">"f1"</span>.getBytes(),<span class="string">"name"</span>.getBytes(),Bytes.toBytes(<span class="string">"张三"</span>));</span><br><span class="line">       put.addColumn(<span class="string">"f1"</span>.getBytes(),<span class="string">"age"</span>.getBytes(),Bytes.toBytes(<span class="number">18</span>));</span><br><span class="line">       put.addColumn(<span class="string">"f2"</span>.getBytes(),<span class="string">"address"</span>.getBytes(),Bytes.toBytes(<span class="string">"地球人"</span>));</span><br><span class="line">       put.addColumn(<span class="string">"f2"</span>.getBytes(),<span class="string">"phone"</span>.getBytes(),Bytes.toBytes(<span class="string">"15845678952"</span>));</span><br><span class="line">       myuser.put(put);</span><br><span class="line">       <span class="comment">//关闭表</span></span><br><span class="line">       myuser.close();</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p><strong>查询数据</strong></p>
<p>初始化数据用于查询:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insertBatchData</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//获取连接</span></span><br><span class="line">        Configuration configuration = HBaseConfiguration.create();</span><br><span class="line">        configuration.set(<span class="string">"hbase.zookeeper.quorum"</span>, <span class="string">"node01:2181,node02:2181"</span>);</span><br><span class="line">        Connection connection = ConnectionFactory.createConnection(configuration);</span><br><span class="line">        <span class="comment">//获取表</span></span><br><span class="line">        Table myuser = connection.getTable(TableName.valueOf(<span class="string">"myuser"</span>));</span><br><span class="line">        <span class="comment">//创建put对象，并指定rowkey</span></span><br><span class="line">        Put put = <span class="keyword">new</span> Put(<span class="string">"0002"</span>.getBytes());</span><br><span class="line">        put.addColumn(<span class="string">"f1"</span>.getBytes(),<span class="string">"id"</span>.getBytes(),Bytes.toBytes(<span class="number">1</span>));</span><br><span class="line">        put.addColumn(<span class="string">"f1"</span>.getBytes(),<span class="string">"name"</span>.getBytes(),Bytes.toBytes(<span class="string">"曹操"</span>));</span><br><span class="line">        put.addColumn(<span class="string">"f1"</span>.getBytes(),<span class="string">"age"</span>.getBytes(),Bytes.toBytes(<span class="number">30</span>));</span><br><span class="line">        put.addColumn(<span class="string">"f2"</span>.getBytes(),<span class="string">"sex"</span>.getBytes(),Bytes.toBytes(<span class="string">"1"</span>));</span><br><span class="line">        put.addColumn(<span class="string">"f2"</span>.getBytes(),<span class="string">"address"</span>.getBytes(),Bytes.toBytes(<span class="string">"沛国谯县"</span>));</span><br><span class="line">        put.addColumn(<span class="string">"f2"</span>.getBytes(),<span class="string">"phone"</span>.getBytes(),Bytes.toBytes(<span class="string">"16888888888"</span>));</span><br><span class="line">        put.addColumn(<span class="string">"f2"</span>.getBytes(),<span class="string">"say"</span>.getBytes(),Bytes.toBytes(<span class="string">"helloworld"</span>));</span><br><span class="line"></span><br><span class="line">        Put put2 = <span class="keyword">new</span> Put(<span class="string">"0003"</span>.getBytes());</span><br><span class="line">        put2.addColumn(<span class="string">"f1"</span>.getBytes(),<span class="string">"id"</span>.getBytes(),Bytes.toBytes(<span class="number">2</span>));</span><br><span class="line">        put2.addColumn(<span class="string">"f1"</span>.getBytes(),<span class="string">"name"</span>.getBytes(),Bytes.toBytes(<span class="string">"刘备"</span>));</span><br><span class="line">        put2.addColumn(<span class="string">"f1"</span>.getBytes(),<span class="string">"age"</span>.getBytes(),Bytes.toBytes(<span class="number">32</span>));</span><br><span class="line">        put2.addColumn(<span class="string">"f2"</span>.getBytes(),<span class="string">"sex"</span>.getBytes(),Bytes.toBytes(<span class="string">"1"</span>));</span><br><span class="line">        put2.addColumn(<span class="string">"f2"</span>.getBytes(),<span class="string">"address"</span>.getBytes(),Bytes.toBytes(<span class="string">"幽州涿郡涿县"</span>));</span><br><span class="line">        put2.addColumn(<span class="string">"f2"</span>.getBytes(),<span class="string">"phone"</span>.getBytes(),Bytes.toBytes(<span class="string">"17888888888"</span>));</span><br><span class="line">        put2.addColumn(<span class="string">"f2"</span>.getBytes(),<span class="string">"say"</span>.getBytes(),Bytes.toBytes(<span class="string">"talk is cheap , show me the code"</span>));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        Put put3 = <span class="keyword">new</span> Put(<span class="string">"0004"</span>.getBytes());</span><br><span class="line">        put3.addColumn(<span class="string">"f1"</span>.getBytes(),<span class="string">"id"</span>.getBytes(),Bytes.toBytes(<span class="number">3</span>));</span><br><span class="line">        put3.addColumn(<span class="string">"f1"</span>.getBytes(),<span class="string">"name"</span>.getBytes(),Bytes.toBytes(<span class="string">"孙权"</span>));</span><br><span class="line">        put3.addColumn(<span class="string">"f1"</span>.getBytes(),<span class="string">"age"</span>.getBytes(),Bytes.toBytes(<span class="number">35</span>));</span><br><span class="line">        put3.addColumn(<span class="string">"f2"</span>.getBytes(),<span class="string">"sex"</span>.getBytes(),Bytes.toBytes(<span class="string">"1"</span>));</span><br><span class="line">        put3.addColumn(<span class="string">"f2"</span>.getBytes(),<span class="string">"address"</span>.getBytes(),Bytes.toBytes(<span class="string">"下邳"</span>));</span><br><span class="line">        put3.addColumn(<span class="string">"f2"</span>.getBytes(),<span class="string">"phone"</span>.getBytes(),Bytes.toBytes(<span class="string">"12888888888"</span>));</span><br><span class="line">        put3.addColumn(<span class="string">"f2"</span>.getBytes(),<span class="string">"say"</span>.getBytes(),Bytes.toBytes(<span class="string">"what are you 弄啥嘞！"</span>));</span><br><span class="line"></span><br><span class="line">        Put put4 = <span class="keyword">new</span> Put(<span class="string">"0005"</span>.getBytes());</span><br><span class="line">        put4.addColumn(<span class="string">"f1"</span>.getBytes(),<span class="string">"id"</span>.getBytes(),Bytes.toBytes(<span class="number">4</span>));</span><br><span class="line">        put4.addColumn(<span class="string">"f1"</span>.getBytes(),<span class="string">"name"</span>.getBytes(),Bytes.toBytes(<span class="string">"诸葛亮"</span>));</span><br><span class="line">        put4.addColumn(<span class="string">"f1"</span>.getBytes(),<span class="string">"age"</span>.getBytes(),Bytes.toBytes(<span class="number">28</span>));</span><br><span class="line">        put4.addColumn(<span class="string">"f2"</span>.getBytes(),<span class="string">"sex"</span>.getBytes(),Bytes.toBytes(<span class="string">"1"</span>));</span><br><span class="line">        put4.addColumn(<span class="string">"f2"</span>.getBytes(),<span class="string">"address"</span>.getBytes(),Bytes.toBytes(<span class="string">"四川隆中"</span>));</span><br><span class="line">        put4.addColumn(<span class="string">"f2"</span>.getBytes(),<span class="string">"phone"</span>.getBytes(),Bytes.toBytes(<span class="string">"14888888888"</span>));</span><br><span class="line">        put4.addColumn(<span class="string">"f2"</span>.getBytes(),<span class="string">"say"</span>.getBytes(),Bytes.toBytes(<span class="string">"出师表你背了嘛"</span>));</span><br><span class="line"></span><br><span class="line">        Put put5 = <span class="keyword">new</span> Put(<span class="string">"0005"</span>.getBytes());</span><br><span class="line">        put5.addColumn(<span class="string">"f1"</span>.getBytes(),<span class="string">"id"</span>.getBytes(),Bytes.toBytes(<span class="number">5</span>));</span><br><span class="line">        put5.addColumn(<span class="string">"f1"</span>.getBytes(),<span class="string">"name"</span>.getBytes(),Bytes.toBytes(<span class="string">"司马懿"</span>));</span><br><span class="line">        put5.addColumn(<span class="string">"f1"</span>.getBytes(),<span class="string">"age"</span>.getBytes(),Bytes.toBytes(<span class="number">27</span>));</span><br><span class="line">        put5.addColumn(<span class="string">"f2"</span>.getBytes(),<span class="string">"sex"</span>.getBytes(),Bytes.toBytes(<span class="string">"1"</span>));</span><br><span class="line">        put5.addColumn(<span class="string">"f2"</span>.getBytes(),<span class="string">"address"</span>.getBytes(),Bytes.toBytes(<span class="string">"哪里人有待考究"</span>));</span><br><span class="line">        put5.addColumn(<span class="string">"f2"</span>.getBytes(),<span class="string">"phone"</span>.getBytes(),Bytes.toBytes(<span class="string">"15888888888"</span>));</span><br><span class="line">        put5.addColumn(<span class="string">"f2"</span>.getBytes(),<span class="string">"say"</span>.getBytes(),Bytes.toBytes(<span class="string">"跟诸葛亮死掐"</span>));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        Put put6 = <span class="keyword">new</span> Put(<span class="string">"0006"</span>.getBytes());</span><br><span class="line">        put6.addColumn(<span class="string">"f1"</span>.getBytes(),<span class="string">"id"</span>.getBytes(),Bytes.toBytes(<span class="number">5</span>));</span><br><span class="line">        put6.addColumn(<span class="string">"f1"</span>.getBytes(),<span class="string">"name"</span>.getBytes(),Bytes.toBytes(<span class="string">"xiaobubu—吕布"</span>));</span><br><span class="line">        put6.addColumn(<span class="string">"f1"</span>.getBytes(),<span class="string">"age"</span>.getBytes(),Bytes.toBytes(<span class="number">28</span>));</span><br><span class="line">        put6.addColumn(<span class="string">"f2"</span>.getBytes(),<span class="string">"sex"</span>.getBytes(),Bytes.toBytes(<span class="string">"1"</span>));</span><br><span class="line">        put6.addColumn(<span class="string">"f2"</span>.getBytes(),<span class="string">"address"</span>.getBytes(),Bytes.toBytes(<span class="string">"内蒙人"</span>));</span><br><span class="line">        put6.addColumn(<span class="string">"f2"</span>.getBytes(),<span class="string">"phone"</span>.getBytes(),Bytes.toBytes(<span class="string">"15788888888"</span>));</span><br><span class="line">        put6.addColumn(<span class="string">"f2"</span>.getBytes(),<span class="string">"say"</span>.getBytes(),Bytes.toBytes(<span class="string">"貂蝉去哪了"</span>));</span><br><span class="line"></span><br><span class="line">        List&lt;Put&gt; listPut = <span class="keyword">new</span> ArrayList&lt;Put&gt;();</span><br><span class="line">        listPut.add(put);</span><br><span class="line">        listPut.add(put2);</span><br><span class="line">        listPut.add(put3);</span><br><span class="line">        listPut.add(put4);</span><br><span class="line">        listPut.add(put5);</span><br><span class="line">        listPut.add(put6);</span><br><span class="line"></span><br><span class="line">        myuser.put(listPut);</span><br><span class="line">        myuser.close();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p><strong>查询</strong></p>
<p>初始化操作:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">以下所有共用这个:</span><br><span class="line"> <span class="keyword">private</span>  Connection connection;</span><br><span class="line"> <span class="keyword">private</span> Configuration configuration;</span><br><span class="line"> <span class="keyword">private</span> Table table;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 初始化的操作</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@BeforeTest</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">initTable</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="comment">//获取连接</span></span><br><span class="line">        configuration = HBaseConfiguration.create();</span><br><span class="line">        configuration.set(<span class="string">"hbase.zookeeper.quorum"</span>,<span class="string">"node01:2181,node02:2181,node03:2181"</span>);</span><br><span class="line"></span><br><span class="line">        connection = ConnectionFactory.createConnection(configuration);</span><br><span class="line">        table= connection.getTable(TableName.valueOf(<span class="string">"myuser"</span>));</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">释放资源:</span><br><span class="line"></span><br><span class="line"> <span class="meta">@AfterTest</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">closeTable</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        connection.close();</span><br><span class="line">        table.close();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p><strong>按照rowkey进行查询获取所有列的所有值</strong></p>
<p>步骤 </p>
<figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">前三同 与插入同</span><br><span class="line">四 <span class="keyword">new</span> <span class="type"></span>一个Get 对象  <span class="keyword">get</span>设置查询参数</span><br><span class="line">六 表对象 调<span class="keyword">get</span>方法 得到结果对象</span><br><span class="line">七 根据结果对象调方法  得到集合 元素为Cell cell包含列簇 列名 列值等</span><br><span class="line">八  遍历 集合  根据需要得到数据</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 查询rowkey为0003的人，所有的列</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span>  <span class="keyword">void</span>  <span class="title">getData</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">      Get get = <span class="keyword">new</span> Get(<span class="string">"0003"</span>.getBytes());</span><br><span class="line">     <span class="comment">// get.addFamily("f1".getBytes());</span></span><br><span class="line">      <span class="comment">//get.addColumn("f1".getBytes(),"id".getBytes());//查询指定列簇下,的指定列的值就加这一条******</span></span><br><span class="line">      <span class="comment">//Result是一个对象，封装了我们所有的结果数据</span></span><br><span class="line">      Result result = table.get(get);</span><br><span class="line">      <span class="comment">//获取0003这条数据所有的cell值</span></span><br><span class="line">      List&lt;Cell&gt; cells = result.listCells();</span><br><span class="line">      <span class="keyword">for</span> (Cell cell : cells) &#123;</span><br><span class="line">          <span class="comment">//获取列族的名称</span></span><br><span class="line">          String familyName = Bytes.toString(cell.getFamilyArray(), cell.getFamilyOffset(), cell.getFamilyLength());</span><br><span class="line">          <span class="comment">//获取列的名称</span></span><br><span class="line">          String columnName = Bytes.toString(cell.getQualifierArray(),cell.getQualifierOffset(),cell.getQualifierLength());</span><br><span class="line">          <span class="keyword">if</span>(familyName.equals(<span class="string">"f1"</span>) &amp;&amp; columnName.equals(<span class="string">"id"</span>) || columnName.equals(<span class="string">"age"</span>))&#123;</span><br><span class="line">              <span class="comment">//获取int类型列值</span></span><br><span class="line">              <span class="keyword">int</span> value = Bytes.toInt(cell.getValueArray(),cell.getValueOffset(),cell.getValueLength());</span><br><span class="line">              System.out.println(<span class="string">"列族名为"</span>+familyName+<span class="string">"列名为"</span> +  columnName + <span class="string">"列的值为"</span> +  value);</span><br><span class="line">          &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">              String value = Bytes.toString(cell.getValueArray(),cell.getValueOffset(),cell.getValueLength());</span><br><span class="line">              System.out.println(<span class="string">"列族名为"</span>+familyName+<span class="string">"列名为"</span> +  columnName + <span class="string">"列的值为"</span> +  value);</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<h4 id="通过startRowKey和endRowKey进行范围扫描"><a href="#通过startRowKey和endRowKey进行范围扫描" class="headerlink" title="通过startRowKey和endRowKey进行范围扫描"></a>通过startRowKey和endRowKey进行范围扫描</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * 按照rowkey进行范围值的扫描</span></span><br><span class="line"><span class="comment">  * 扫描rowkey范围是0004到0006的所有的值</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"> <span class="meta">@Test</span></span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">scanRange</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">     Scan scan = <span class="keyword">new</span> Scan();</span><br><span class="line">     <span class="comment">//设置我们起始和结束rowkey,范围值扫描是包括前面的，不包括后面的</span></span><br><span class="line">     scan.setStartRow(<span class="string">"0004"</span>.getBytes());</span><br><span class="line">     scan.setStopRow(<span class="string">"0006"</span>.getBytes());</span><br><span class="line">     <span class="comment">//返回多条数据结果值都封装在resultScanner里面了</span></span><br><span class="line">     ResultScanner scanner = table.getScanner(scan);</span><br><span class="line">     <span class="keyword">for</span> (Result result : scanner) &#123;</span><br><span class="line">         List&lt;Cell&gt; cells = result.listCells();</span><br><span class="line">         <span class="keyword">for</span> (Cell cell : cells) &#123;</span><br><span class="line">             String rowkey = Bytes.toString(cell.getRowArray(), cell.getRowOffset(), cell.getRowLength());</span><br><span class="line">             <span class="comment">//获取列族名</span></span><br><span class="line">             String familyName  = Bytes.toString(cell.getFamilyArray(), cell.getFamilyOffset(), cell.getFamilyLength());</span><br><span class="line">             <span class="comment">//获取列名</span></span><br><span class="line">             String columnName = Bytes.toString(cell.getQualifierArray(), cell.getQualifierOffset(), cell.getQualifierLength());</span><br><span class="line">             <span class="keyword">if</span>(familyName.equals(<span class="string">"f1"</span>) &amp;&amp; columnName.equals(<span class="string">"id"</span>) || columnName.equals(<span class="string">"age"</span>))&#123;</span><br><span class="line">                 <span class="keyword">int</span> value = Bytes.toInt(cell.getValueArray(), cell.getValueOffset(), cell.getValueLength());</span><br><span class="line">                 System.out.println(<span class="string">"数据的rowkey为"</span> +  rowkey + <span class="string">"    数据的列族名为"</span> +  familyName + <span class="string">"    列名为"</span> + columnName + <span class="string">"   列值为"</span> +  value);</span><br><span class="line">             &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                 String value = Bytes.toString(cell.getValueArray(), cell.getValueOffset(), cell.getValueLength());</span><br><span class="line">                 System.out.println(<span class="string">"数据的rowkey为"</span> +  rowkey + <span class="string">"    数据的列族名为"</span> +  familyName + <span class="string">"    列名为"</span> + columnName + <span class="string">"   列值为"</span> +  value);</span><br><span class="line">             &#125;</span><br><span class="line">         &#125;</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<p><strong>全表扫描</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//全表扫描</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">scanAll</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">	Scan scan=<span class="keyword">new</span> Scan();</span><br><span class="line">    ResultScanner scanner=table.getScanner(scan);</span><br><span class="line">    <span class="keyword">for</span> (Result result: scanner)&#123;</span><br><span class="line">        List&lt;Cell&gt; cells=result.listCells();</span><br><span class="line">        <span class="keyword">for</span>(Cell cell:cells)&#123;</span><br><span class="line">              String rowkey = Bytes.toString(cell.getRowArray(), cell.getRowOffset(), cell.getRowLength());</span><br><span class="line">                <span class="comment">//获取列族名</span></span><br><span class="line">                String familyName  = Bytes.toString(cell.getFamilyArray(), cell.getFamilyOffset(), cell.getFamilyLength());</span><br><span class="line">                <span class="comment">//获取列名</span></span><br><span class="line">                String columnName = Bytes.toString(cell.getQualifierArray(), cell.getQualifierOffset(), cell.getQualifierLength());</span><br><span class="line">                <span class="keyword">if</span>(familyName.equals(<span class="string">"f1"</span>) &amp;&amp; columnName.equals(<span class="string">"id"</span>) || columnName.equals(<span class="string">"age"</span>))&#123;</span><br><span class="line">                    <span class="keyword">int</span> value = Bytes.toInt(cell.getValueArray(), cell.getValueOffset(), cell.getValueLength());</span><br><span class="line">                    System.out.println(<span class="string">"数据的rowkey为"</span> +  rowkey + <span class="string">"    数据的列族名为"</span> +  familyName + <span class="string">"    列名为"</span> + columnName + <span class="string">"   列值为"</span> +  value);</span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    String value = Bytes.toString(cell.getValueArray(), cell.getValueOffset(), cell.getValueLength());</span><br><span class="line">                    System.out.println(<span class="string">"数据的rowkey为"</span> +  rowkey + <span class="string">"    数据的列族名为"</span> +  familyName + <span class="string">"    列名为"</span> + columnName + <span class="string">"   列值为"</span> +  value);</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="十-过滤查询"><a href="#十-过滤查询" class="headerlink" title="十 过滤查询"></a>十 过滤查询</h2><p>过滤器的类型很多，但是可以分为两大类——比较过滤器，专用过滤器</p>
<p>过滤器的作用是在服务端判断数据是否满足条件，然后只将满足条件的数据返回给客户端；</p>
<p>hbase过滤器的比较运算符：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">LESS  &lt;</span><br><span class="line">LESS_OR_EQUAL &lt;=</span><br><span class="line">EQUAL =</span><br><span class="line">NOT_EQUAL &lt;&gt;</span><br><span class="line">GREATER_OR_EQUAL &gt;=</span><br><span class="line">GREATER &gt;</span><br><span class="line">NO_OP 排除所有</span><br></pre></td></tr></table></figure>
<p>Hbase过滤器的比较器（指定比较机制）：</p>
<figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">BinaryComparator </span> 按字节索引顺序比较指定字节数组，采用<span class="keyword">Bytes.compareTo(byte[])</span></span><br><span class="line"><span class="keyword">BinaryPrefixComparator </span>跟前面相同，只是比较左端的数据是否相同</span><br><span class="line"><span class="symbol">NullComparator</span> 判断给定的是否为空</span><br><span class="line"><span class="keyword">BitComparator </span>按位比较</span><br><span class="line"><span class="symbol">RegexStringComparator</span> 提供一个正则的比较器，仅支持 EQUAL 和非EQUAL</span><br><span class="line"><span class="keyword">SubstringComparator </span>判断提供的子串是否出现在value中。</span><br></pre></td></tr></table></figure>
<h3 id="1-比较过滤器"><a href="#1-比较过滤器" class="headerlink" title="1 比较过滤器"></a>1 比较过滤器</h3><p>四种:</p>
<p>rowkey过滤器: RowFilter</p>
<p>列簇过滤器:     FamilyFilter</p>
<p>列过滤器:     QualifierFilter</p>
<p>列值过滤器: ValueFilter</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">filterStudy</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line"></span><br><span class="line">    Scan scan = <span class="keyword">new</span> Scan();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//查询rowkey比0003小的所有的数据       rowkey过滤器: </span></span><br><span class="line">  <span class="comment">//  RowFilter rowFilter = new RowFilter(CompareOperator.LESS, new BinaryComparator(Bytes.toBytes("0003")));</span></span><br><span class="line">  <span class="comment">//  scan.setFilter(rowFilter);</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//查询比f2列族小的所有的列族里面的数据    FamilyFilter</span></span><br><span class="line"></span><br><span class="line">   <span class="comment">// FamilyFilter f2 = new FamilyFilter(CompareOperator.LESS, new SubstringComparator("f2"));</span></span><br><span class="line">   <span class="comment">// scan.setFilter(f2);</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//只查询name列的值                           列过滤器:</span></span><br><span class="line">  <span class="comment">//  QualifierFilter name = new QualifierFilter(CompareOperator.EQUAL, new SubstringComparator("name"));</span></span><br><span class="line">  <span class="comment">//  scan.setFilter(name);</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//查询value值当中包含8的所有的数据                 列值过滤器:</span></span><br><span class="line">    <span class="comment">// ValueFilter valueFilter = new ValueFilter(CompareOperator.EQUAL, new SubstringComparator("8"));</span></span><br><span class="line">  <span class="comment">//  scan.setFilter(valueFilter);</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//查询name值为刘备的数据</span></span><br><span class="line">    <span class="comment">//SingleColumnValueFilter singleColumnValueFilter = new SingleColumnValueFilter("f1".getBytes(), "name".getBytes(), CompareOperator.EQUAL, "刘备".getBytes());</span></span><br><span class="line">    <span class="comment">//scan.setFilter(singleColumnValueFilter);</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//查询rowkey以00开头所有的数据</span></span><br><span class="line">    PrefixFilter prefixFilter = <span class="keyword">new</span> PrefixFilter(<span class="string">"00"</span>.getBytes());</span><br><span class="line">    scan.setFilter(prefixFilter);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//返回多条数据结果值都封装在resultScanner里面了</span></span><br><span class="line">    ResultScanner scanner = table.getScanner(scan);</span><br><span class="line">    <span class="keyword">for</span> (Result result : scanner) &#123;</span><br><span class="line">        List&lt;Cell&gt; cells = result.listCells();</span><br><span class="line">        <span class="keyword">for</span> (Cell cell : cells) &#123;</span><br><span class="line">            String rowkey = Bytes.toString(cell.getRowArray(), cell.getRowOffset(), cell.getRowLength());</span><br><span class="line">            <span class="comment">//获取列族名</span></span><br><span class="line">            String familyName  = Bytes.toString(cell.getFamilyArray(), cell.getFamilyOffset(), cell.getFamilyLength());</span><br><span class="line">            String columnName = Bytes.toString(cell.getQualifierArray(), cell.getQualifierOffset(), cell.getQualifierLength());</span><br><span class="line">            <span class="keyword">if</span>(familyName.equals(<span class="string">"f1"</span>) &amp;&amp; columnName.equals(<span class="string">"id"</span>) || columnName.equals(<span class="string">"age"</span>))&#123;</span><br><span class="line">                <span class="keyword">int</span> value = Bytes.toInt(cell.getValueArray(), cell.getValueOffset(), cell.getValueLength());</span><br><span class="line">                System.out.println(<span class="string">"数据的rowkey为"</span> +  rowkey + <span class="string">"    数据的列族名为"</span> +  familyName + <span class="string">"    列名为"</span> + columnName + <span class="string">"   列值为"</span> +  value);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                String value = Bytes.toString(cell.getValueArray(), cell.getValueOffset(), cell.getValueLength());</span><br><span class="line">                System.out.println(<span class="string">"数据的rowkey为"</span> +  rowkey + <span class="string">"    数据的列族名为"</span> +  familyName + <span class="string">"    列名为"</span> + columnName + <span class="string">"   列值为"</span> +  value);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-专用过滤器"><a href="#2-专用过滤器" class="headerlink" title="2 专用过滤器"></a>2 专用过滤器</h3><h5 id="1、单列值过滤器-SingleColumnValueFilter"><a href="#1、单列值过滤器-SingleColumnValueFilter" class="headerlink" title="1、单列值过滤器 SingleColumnValueFilter"></a>1、单列值过滤器 SingleColumnValueFilter</h5><h5 id="2、列值排除过滤器SingleColumnValueExcludeFilter"><a href="#2、列值排除过滤器SingleColumnValueExcludeFilter" class="headerlink" title="2、列值排除过滤器SingleColumnValueExcludeFilter"></a>2、列值排除过滤器SingleColumnValueExcludeFilter</h5><p>与SingleColumnValueFilter相反，会排除掉指定的列，其他的列全部返回</p>
<h5 id="3、rowkey前缀过滤器PrefixFilter"><a href="#3、rowkey前缀过滤器PrefixFilter" class="headerlink" title="3、rowkey前缀过滤器PrefixFilter"></a>3、rowkey前缀过滤器PrefixFilter</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">filterStudy</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line"></span><br><span class="line">       Scan scan = <span class="keyword">new</span> Scan();</span><br><span class="line"></span><br><span class="line">       <span class="comment">//查询name值为刘备的数据        单列值过滤器 </span></span><br><span class="line">       <span class="comment">//SingleColumnValueFilter singleColumnValueFilter = new SingleColumnValueFilter("f1".getBytes(), "name".getBytes(), CompareOperator.EQUAL, "刘备".getBytes());</span></span><br><span class="line">       <span class="comment">//scan.setFilter(singleColumnValueFilter);</span></span><br><span class="line">	</span><br><span class="line">       <span class="comment">//查询name值不为刘备的数据   列值排除过滤器</span></span><br><span class="line">   <span class="comment">//SingleColumnValueExcludeFilter singleColumnValueExcludeFilter   = new SingleColumnValueExcludeFilter("f1".getBytes(), "name".getBytes(), CompareOperator.EQUAL, "刘备".getBytes());</span></span><br><span class="line">       </span><br><span class="line">       </span><br><span class="line">       <span class="comment">//查询rowkey以00开头所有的数据</span></span><br><span class="line">       PrefixFilter prefixFilter = <span class="keyword">new</span> PrefixFilter(<span class="string">"00"</span>.getBytes());</span><br><span class="line">       scan.setFilter(prefixFilter);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">       <span class="comment">//返回多条数据结果值都封装在resultScanner里面了</span></span><br><span class="line">       ResultScanner scanner = table.getScanner(scan);</span><br><span class="line">       <span class="keyword">for</span> (Result result : scanner) &#123;</span><br><span class="line">           List&lt;Cell&gt; cells = result.listCells();</span><br><span class="line">           <span class="keyword">for</span> (Cell cell : cells) &#123;</span><br><span class="line">               String rowkey = Bytes.toString(cell.getRowArray(), cell.getRowOffset(), cell.getRowLength());</span><br><span class="line">               <span class="comment">//获取列族名</span></span><br><span class="line">               String familyName  = Bytes.toString(cell.getFamilyArray(), cell.getFamilyOffset(), cell.getFamilyLength());</span><br><span class="line">               String columnName = Bytes.toString(cell.getQualifierArray(), cell.getQualifierOffset(), cell.getQualifierLength());</span><br><span class="line">               <span class="keyword">if</span>(familyName.equals(<span class="string">"f1"</span>) &amp;&amp; columnName.equals(<span class="string">"id"</span>) || columnName.equals(<span class="string">"age"</span>))&#123;</span><br><span class="line">                   <span class="keyword">int</span> value = Bytes.toInt(cell.getValueArray(), cell.getValueOffset(), cell.getValueLength());</span><br><span class="line">                   System.out.println(<span class="string">"数据的rowkey为"</span> +  rowkey + <span class="string">"    数据的列族名为"</span> +  familyName + <span class="string">"    列名为"</span> + columnName + <span class="string">"   列值为"</span> +  value);</span><br><span class="line">               &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                   String value = Bytes.toString(cell.getValueArray(), cell.getValueOffset(), cell.getValueLength());</span><br><span class="line">                   System.out.println(<span class="string">"数据的rowkey为"</span> +  rowkey + <span class="string">"    数据的列族名为"</span> +  familyName + <span class="string">"    列名为"</span> + columnName + <span class="string">"   列值为"</span> +  value);</span><br><span class="line">               &#125;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<h5 id="4、分页过滤器PageFilter"><a href="#4、分页过滤器PageFilter" class="headerlink" title="4、分页过滤器PageFilter"></a>4、分页过滤器PageFilter</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 实现hbase的分页的功能</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">hbasePage</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">int</span> pageNum= <span class="number">3</span>;</span><br><span class="line">      <span class="keyword">int</span> pageSize = <span class="number">2</span> ;</span><br><span class="line">      <span class="keyword">if</span>(pageNum == <span class="number">1</span>)&#123;</span><br><span class="line">          Scan scan = <span class="keyword">new</span> Scan();</span><br><span class="line">          <span class="comment">//如果是查询第一页数据，就按照空来进行扫描</span></span><br><span class="line">          scan.withStartRow(<span class="string">""</span>.getBytes());</span><br><span class="line">          PageFilter pageFilter = <span class="keyword">new</span> PageFilter(pageSize);</span><br><span class="line">          scan.setFilter(pageFilter);</span><br><span class="line"></span><br><span class="line">          ResultScanner scanner = table.getScanner(scan);</span><br><span class="line">          <span class="keyword">for</span> (Result result : scanner) &#123;</span><br><span class="line">              <span class="keyword">byte</span>[] row = result.getRow();</span><br><span class="line">              System.out.println(Bytes.toString(row));</span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">      &#125;<span class="keyword">else</span>&#123;</span><br><span class="line"></span><br><span class="line">          String  startRow = <span class="string">""</span>;</span><br><span class="line">          <span class="comment">//计算我们前两页的数据的最后一条，再加上一条，就是第三页的起始rowkey</span></span><br><span class="line">          Scan scan = <span class="keyword">new</span> Scan();</span><br><span class="line">          scan.withStartRow(<span class="string">""</span>.getBytes());</span><br><span class="line">          PageFilter pageFilter = <span class="keyword">new</span> PageFilter((pageNum - <span class="number">1</span>) * pageSize + <span class="number">1</span>);</span><br><span class="line">          scan.setFilter(pageFilter);</span><br><span class="line">          ResultScanner scanner = table.getScanner(scan);</span><br><span class="line">          <span class="keyword">for</span> (Result result : scanner) &#123;</span><br><span class="line">              <span class="keyword">byte</span>[] row = result.getRow();</span><br><span class="line">              startRow = Bytes.toString(row);</span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">          <span class="comment">//获取第三页的数据</span></span><br><span class="line">          scan.withStartRow(startRow.getBytes());</span><br><span class="line">          PageFilter pageFilter1 = <span class="keyword">new</span> PageFilter(pageSize);</span><br><span class="line">          scan.setFilter(pageFilter1);</span><br><span class="line">          ResultScanner scanner1 = table.getScanner(scan);</span><br><span class="line">          <span class="keyword">for</span> (Result result : scanner1) &#123;</span><br><span class="line">              <span class="keyword">byte</span>[] row = result.getRow();</span><br><span class="line">              System.out.println(Bytes.toString(row));</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-多过滤器综合查询FilterList"><a href="#3-多过滤器综合查询FilterList" class="headerlink" title="3 多过滤器综合查询FilterList"></a>3 多过滤器综合查询FilterList</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 多过滤器综合查询</span></span><br><span class="line"><span class="comment">   * 需求：使用SingleColumnValueFilter查询f1列族，name为刘备的数据，并且同时满足rowkey的前缀以00开头的数据（PrefixFilter）</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">filterList</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line"></span><br><span class="line">      SingleColumnValueFilter singleColumnValueFilter = <span class="keyword">new</span> SingleColumnValueFilter(<span class="string">"f1"</span>.getBytes(), <span class="string">"name"</span>.getBytes(), CompareOperator.EQUAL, <span class="string">"刘备"</span>.getBytes());</span><br><span class="line"></span><br><span class="line">      PrefixFilter prefixFilter = <span class="keyword">new</span> PrefixFilter(<span class="string">"00"</span>.getBytes());</span><br><span class="line">      <span class="comment">//使用filterList来实现多过滤器综合查询</span></span><br><span class="line">      FilterList filterList = <span class="keyword">new</span> FilterList(singleColumnValueFilter, prefixFilter);</span><br><span class="line"></span><br><span class="line">      Scan scan = <span class="keyword">new</span> Scan();</span><br><span class="line">      scan.setFilter(filterList);<span class="comment">//设定为FilterList</span></span><br><span class="line">      </span><br><span class="line">      ResultScanner scanner = table.getScanner(scan);</span><br><span class="line">      <span class="keyword">for</span> (Result result : scanner) &#123;</span><br><span class="line">          List&lt;Cell&gt; cells = result.listCells();</span><br><span class="line">          <span class="keyword">for</span> (Cell cell : cells) &#123;</span><br><span class="line">              String rowkey = Bytes.toString(cell.getRowArray(), cell.getRowOffset(), cell.getRowLength());</span><br><span class="line">              <span class="comment">//获取列族名</span></span><br><span class="line">              String familyName  = Bytes.toString(cell.getFamilyArray(), cell.getFamilyOffset(), cell.getFamilyLength());</span><br><span class="line">              String columnName = Bytes.toString(cell.getQualifierArray(), cell.getQualifierOffset(), cell.getQualifierLength());</span><br><span class="line">              <span class="keyword">if</span>(familyName.equals(<span class="string">"f1"</span>) &amp;&amp; columnName.equals(<span class="string">"id"</span>) || columnName.equals(<span class="string">"age"</span>))&#123;</span><br><span class="line">                  <span class="keyword">int</span> value = Bytes.toInt(cell.getValueArray(), cell.getValueOffset(), cell.getValueLength());</span><br><span class="line">                  System.out.println(<span class="string">"数据的rowkey为"</span> +  rowkey + <span class="string">"    数据的列族名为"</span> +  familyName + <span class="string">"    列名为"</span> + columnName + <span class="string">"   列值为"</span> +  value);</span><br><span class="line">              &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                  String value = Bytes.toString(cell.getValueArray(), cell.getValueOffset(), cell.getValueLength());</span><br><span class="line">                  System.out.println(<span class="string">"数据的rowkey为"</span> +  rowkey + <span class="string">"    数据的列族名为"</span> +  familyName + <span class="string">"    列名为"</span> + columnName + <span class="string">"   列值为"</span> +  value);</span><br><span class="line">              &#125;</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p><strong>根据rowkey删除数据</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 根据rowkey删除某一条数据</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span>   <span class="keyword">void</span> <span class="title">deleteData</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">      Delete delete = <span class="keyword">new</span> Delete(<span class="string">"0007"</span>.getBytes());</span><br><span class="line">      table.delete(delete);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p><strong>删除表操作</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 删除表操作</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteTable</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">      <span class="comment">//获取管理员对象</span></span><br><span class="line">      Admin admin = connection.getAdmin();</span><br><span class="line">      <span class="comment">//禁用表</span></span><br><span class="line">      admin.disableTable(TableName.valueOf(<span class="string">"myuser"</span>));</span><br><span class="line">      <span class="comment">//删除表</span></span><br><span class="line">      admin.deleteTable(TableName.valueOf(<span class="string">"myuser"</span>));</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p><strong>更新表操作</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 更新操作与插入操作是一模一样的，如果rowkey已经存在那么就更新</span></span><br><span class="line"><span class="comment">    * 如果rowkey不存在，那么就添加</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@Test</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateOperate</span><span class="params">()</span></span>&#123;&#125;</span><br></pre></td></tr></table></figure>
<p><strong>表的创建与预分区</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 通过javaAPI进行HBase的表的创建以及预分区操作</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">hbaseSplit</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">      <span class="comment">//获取连接</span></span><br><span class="line">      Configuration configuration = HBaseConfiguration.create();</span><br><span class="line">      configuration.set(<span class="string">"hbase.zookeeper.quorum"</span>, <span class="string">"node01:2181,node02:2181,node03:2181"</span>);</span><br><span class="line">      Connection connection = ConnectionFactory.createConnection(configuration);</span><br><span class="line">      Admin admin = connection.getAdmin();</span><br><span class="line">      <span class="comment">//自定义算法，产生一系列Hash散列值存储在二维数组中</span></span><br><span class="line">      <span class="keyword">byte</span>[][] splitKeys = &#123;&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>&#125;,&#123;<span class="string">'a'</span>,<span class="string">'b'</span>,<span class="string">'c'</span>,<span class="string">'d'</span>,<span class="string">'e'</span>&#125;&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">      <span class="comment">//通过HTableDescriptor来实现我们表的参数设置，包括表名，列族等等</span></span><br><span class="line">      HTableDescriptor hTableDescriptor = <span class="keyword">new</span> HTableDescriptor(TableName.valueOf(<span class="string">"staff3"</span>));</span><br><span class="line">      <span class="comment">//添加列族</span></span><br><span class="line">      hTableDescriptor.addFamily(<span class="keyword">new</span> HColumnDescriptor(<span class="string">"f1"</span>));</span><br><span class="line">      <span class="comment">//添加列族</span></span><br><span class="line">      hTableDescriptor.addFamily(<span class="keyword">new</span> HColumnDescriptor(<span class="string">"f2"</span>));</span><br><span class="line">      </span><br><span class="line">      admin.createTable(hTableDescriptor,splitKeys);</span><br><span class="line">      admin.close();</span><br><span class="line"></span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<h2 id="十一-Hbase的底层原理"><a href="#十一-Hbase的底层原理" class="headerlink" title="十一  Hbase的底层原理"></a>十一  Hbase的底层原理</h2><p>系统架构:</p>
<p><img src="/images/Hbase/hbase架构.png" alt="img"></p>
<p><strong>Client</strong></p>
<p>1 包含访问hbase的接口，client维护着一些cache来加快对hbase的访问，比如regione的位置信息。</p>
<p><strong>Zookeeper</strong></p>
<p>1 保证任何时候，集群中只有一个master</p>
<p>2 存贮所有Region的寻址入口</p>
<p>3 实时监控Region Server的状态，将Region server的上线和下线信息实时通知给Master</p>
<p>4 存储Hbase的schema,包括有哪些table，每个table有哪些column family</p>
<p><strong>Master职责</strong></p>
<p>1 为Region server分配region</p>
<p>2 负责region server的负载均衡</p>
<p>3 发现失效的region server并重新分配其上的region</p>
<p>4 HDFS上的垃圾文件回收</p>
<p>5 处理schema更新请求</p>
<p><strong>Region Server职责</strong></p>
<p>1 Region server维护Master分配给它的region，处理对这些region的IO请求</p>
<p>2 Region server负责切分在运行过程中变得过大的region</p>
<p>可以看到，client访问hbase上数据的过程并不需要master参与（寻址访问zookeeper和region server，数据读写访问regione server），master仅仅维护者table和region的元数据信息，负载很低。</p>
<h2 id="HBase的表数据模型"><a href="#HBase的表数据模型" class="headerlink" title="HBase的表数据模型"></a>HBase的表数据模型</h2><h3 id="Row-Key"><a href="#Row-Key" class="headerlink" title="Row Key"></a>Row Key</h3><p>与nosql数据库们一样,row key是用来检索记录的主键。访问hbase table中的行，只有三种方式：</p>
<p>1 通过单个row key访问</p>
<p>2 通过row key的range</p>
<p>3 全表扫描</p>
<p>Row key行键 (Row key)可以是任意字符串(最大长度是 64KB，实际应用中长度一般为 10-100bytes)，在hbase内部，row key保存为字节数组。</p>
<p><strong>Hbase</strong>:<strong>会对表中的数据按照rowkey排序(字典顺序)</strong></p>
<p>存储时，数据按照Row key的字典序(byte order)排序存储。设计key时，要充分排序存储这个特性，将经常一起读取的行存储放到一起。(位置相关性)</p>
<p>注意：</p>
<p>字典序对int排序的结果是</p>
<p>1,10,100,11,12,13,14,15,16,17,18,19,2,20,21,…,9,91,92,93,94,95,96,97,98,99。要保持整形的自然序，行键必须用0作左填充。</p>
<p>行的一次读写是原子操作 (不论一次读写多少列)。这个设计决策能够使用户很容易的理解程序在对同一个行进行并发更新操作时的行为。</p>
<h3 id="列族Column-Family"><a href="#列族Column-Family" class="headerlink" title="列族Column Family"></a>列族Column Family</h3><p>hbase表中的每个列，都归属与某个列族。列族是表的schema的一部分(而列不是)，必须在使用表之前定义。</p>
<p>列名都以列族作为前缀。例如courses:history ， courses:math 都属于 courses 这个列族。</p>
<p>访问控制、磁盘和内存的使用统计都是在列族层面进行的。</p>
<p>列族越多，在取一行数据时所要参与IO、搜寻的文件就越多，所以，如果没有必要，不要设置太多的列族</p>
<h3 id="列-Column"><a href="#列-Column" class="headerlink" title="列 Column"></a>列 Column</h3><p>列族下面的具体列，属于某一个ColumnFamily,类似于我们mysql当中创建的具体的列</p>
<p>列是插入数据的时候动态指定的</p>
<h3 id="时间戳"><a href="#时间戳" class="headerlink" title="时间戳"></a>时间戳</h3><p>HBase中通过row和columns确定的为一个存贮单元称为cell。每个 cell都保存着同一份数据的多个版本。版本通过时间戳来索引。时间戳的类型是 64位整型。时间戳可以由hbase(在数据写入时自动 )赋值，此时时间戳是精确到毫秒的当前系统时间。时间戳也可以由客户显式赋值。如果应用程序要避免数据版本冲突，就必须自己生成具有唯一性的时间戳。每个 cell中，不同版本的数据按照时间倒序排序，即最新的数据排在最前面。</p>
<p>为了避免数据存在过多版本造成的的管理 (包括存贮和索引)负担，hbase提供了两种数据版本回收方式：</p>
<p>²  保存数据的最后n个版本</p>
<p>²  保存最近一段时间内的版本（设置数据的生命周期TTL）。</p>
<p>用户可以针对每个列族进行设置。</p>
<h3 id="Cell"><a href="#Cell" class="headerlink" title="Cell"></a>Cell</h3><p>由{row key, column( =<family> + <label>), version} 唯一确定的单元。</label></family></p>
<p>cell中的数据是没有类型的，全部是字节码形式存贮。</p>
<h3 id="VersionNum"><a href="#VersionNum" class="headerlink" title="VersionNum"></a>VersionNum</h3><p>数据的版本号，每条数据可以有多个版本号，默认值为系统时间戳，类型为Long</p>
<h2 id="物理存储"><a href="#物理存储" class="headerlink" title="物理存储"></a>物理存储</h2><h3 id="1、整体结构"><a href="#1、整体结构" class="headerlink" title="1、整体结构"></a>1、整体结构</h3><p>1 Table中的所有行都按照row key的字典序排列。</p>
<p>2 Table 在行的方向上分割为多个Hregion</p>
<p><strong>3 region按大小分割的(默认10G)，每个表一开始只有一个region，随着数据不断插入表，region不断增大，当增大到一个阀值的时候，Hregion就会等分会两个新的Hregion。分出新的 会分一个新的 HRegionServer去管理.   当table中的行不断增多，就会有越来越多的Hregion。</strong></p>
<p>4 Hregion是Hbase中分布式存储和负载均衡的最小单元。最小单元就表示不同的Hregion可以分布在不同的HRegion server上。但一个Hregion是不会拆分到多个server上的。</p>
<p>5 HRegion虽然是负载均衡的最小单元，但并不是物理存储的最小单元。</p>
<p>事实上，HRegion由一个或者多个Store组成，每个store保存一个column family。</p>
<p>每个Strore又由一个memStore和0至多个StoreFile组成。</p>
<h3 id="STORE-FILE-amp-HFILE结构"><a href="#STORE-FILE-amp-HFILE结构" class="headerlink" title="STORE FILE &amp; HFILE结构"></a>STORE FILE &amp; HFILE结构</h3><p>StoreFile以HFile格式保存在HDFS上。</p>
<p>首先HFile文件是不定长的，长度固定的只有其中的两块：Trailer和FileInfo。正如图中所示的，Trailer中有指针指向其他数 据块的起始点。</p>
<p>File Info中记录了文件的一些Meta信息，例如：AVG_KEY_LEN, AVG_VALUE_LEN, LAST_KEY, COMPARATOR, MAX_SEQ_ID_KEY等。</p>
<p>Data Index和Meta Index块记录了每个Data块和Meta块的起始点。</p>
<p>Data Block是HBase I/O的基本单元，为了提高效率，HRegionServer中有基于LRU的Block Cache机制。每个Data块的大小可以在创建一个Table的时候通过参数指定，大号的Block有利于顺序Scan，小号Block利于随机查询。 每个Data块除了开头的Magic以外就是一个个KeyValue对拼接而成, Magic内容就是一些随机数字，目的是防止数据损坏。</p>
<p>HFile里面的每个对就是一个简单的数组。但是这个数组里面包含了很多项，并且有固定的结构。</p>
<p> 开始是两个固定长度的数值，分别表示Key的长度和Value的长度。紧接着是Key，开始是固定长度的数值，表示RowKey的长度，紧接着是 RowKey，然后是固定长度的数值，表示Family的长度，然后是Family，接着是Qualifier，然后是两个固定长度的数值，表示Time Stamp和Key Type（Put/Delete）。Value部分没有这么复杂的结构，就是纯粹的二进制数据了。</p>
<p>HFile分为六个部分：</p>
<p>Data Block 段–保存表中的数据，这部分可以被压缩</p>
<p>Meta Block 段 (可选的)–保存用户自定义的kv对，可以被压缩。</p>
<p>File Info 段–Hfile的元信息，不被压缩，用户也可以在这一部分添加自己的元信息。</p>
<p>Data Block Index 段–Data Block的索引。每条索引的key是被索引的block的第一条记录的key。</p>
<p>Meta Block Index段 (可选的)–Meta Block的索引。</p>
<p>Trailer–这一段是定长的。保存了每一段的偏移量，读取一个HFile时，会首先 读取Trailer，Trailer保存了每个段的起始位置(段的Magic Number用来做安全check)，然后，DataBlock Index会被读取到内存中，这样，当检索某个key时，不需要扫描整个HFile，而只需从内存中找到key所在的block，通过一次磁盘io将整个 block读取到内存中，再找到需要的key。DataBlock Index采用LRU机制淘汰。</p>
<p>HFile的Data Block，Meta Block通常采用压缩方式存储，压缩之后可以大大减少网络IO和磁盘IO，随之而来的开销当然是需要花费cpu进行压缩和解压缩。</p>
<p>目标Hfile的压缩支持两种方式：Gzip，Lzo。</p>
<h3 id="Memstore与storefile"><a href="#Memstore与storefile" class="headerlink" title="Memstore与storefile"></a>Memstore与storefile</h3><p><strong>一个region由多个store组成，每个store包含一个列族的所有数据</strong></p>
<p>Store包括位于内存的memstore和位于硬盘的storefile</p>
<p>写操作先写入memstore,当memstore中的数据量达到某个阈值，Hregionserver启动flashcache进程写入storefile,每次写入形成单独一个storefile</p>
<p>当storefile大小超过一定阈值后，会把当前的region分割成两个，并由Hmaster分配给相应的HregionServer服务器，实现负载均衡</p>
<p>客户端检索数据时，先在memstore找，找不到再找storefile</p>
<h3 id="HLog-WAL-log"><a href="#HLog-WAL-log" class="headerlink" title="HLog(WAL log)"></a>HLog(WAL log)</h3><p>WAL 意为Write ahead log(<a href="http://en.wikipedia.org/wiki/Write-ahead_logging)，类似mysql中的binlog,用来" target="_blank" rel="noopener">http://en.wikipedia.org/wiki/Write-ahead_logging)，类似mysql中的binlog,用来</a> 做灾难恢复时用，<strong>Hlog记录数据的所有变更,一旦数据修改，就可以从log中进行恢复.</strong></p>
<p>每个Region Server维护一个Hlog,而不是每个Region一个。这样不同region(来自不同table)的日志会混在一起，这样做的目的是不断追加单个文件相对于同时写多个文件而言，可以减少磁盘寻址次数，因此可以提高对table的写性能。带来的麻烦是，如果一台region server下线，为了恢复其上的region，需要将region server上的log进行拆分，然后分发到其它region server上进行恢复。</p>
<p>HLog文件就是一个普通的Hadoop Sequence File：</p>
<p>²  HLog Sequence File 的Key是HLogKey对象，HLogKey中记录了写入数据的归属信息，除了table和region名字外，同时还包括 sequence number和timestamp，timestamp是”写入时间”，sequence number的起始值为0，或者是最近一次存入文件系统中sequence number。</p>
<p>²  HLog Sequece File的Value是HBase的KeyValue对象，即对应HFile中的KeyValue，可参见上文描述。</p>
<h3 id="读写过程"><a href="#读写过程" class="headerlink" title="读写过程"></a>读写过程</h3><h3 id="读请求过程："><a href="#读请求过程：" class="headerlink" title="读请求过程："></a>读请求过程：</h3><p>HRegionServer保存着meta表以及表数据，要访问表数据，首先Client先去访问zookeeper，从zookeeper里面获取meta表所在的位置信息，即找到这个meta表在哪个HRegionServer上保存着。</p>
<p>接着Client通过刚才获取到的HRegionServer的IP来访问Meta表所在的HRegionServer，从而读取到Meta，进而获取到Meta表中存放的元数据。</p>
<p>Client通过元数据中存储的信息，访问对应的HRegionServer，然后扫描所在HRegionServer的Memstore和Storefile来查询数据</p>
<p>最后HRegionServer把查询到的数据响应给Client。</p>
<p>查看meta表信息</p>
<p>hbase(main):011:0&gt; scan ‘hbase:meta’</p>
<h3 id="2、写请求过程："><a href="#2、写请求过程：" class="headerlink" title="2、写请求过程："></a>2、写请求过程：</h3><p>Client也是先访问zookeeper，找到Meta表，并获取Meta表元数据。</p>
<p>确定当前将要写入的数据所对应的HRegion和HRegionServer服务器。</p>
<p>Client向该HRegionServer服务器发起写入数据请求，然后HRegionServer收到请求并响应。 </p>
<p>Client先把数据写入到HLog，以防止数据丢失。</p>
<p>然后将数据写入到Memstore。 </p>
<p>如果HLog和Memstore均写入成功，则这条数据写入成功</p>
<p>如果Memstore达到阈值，会把Memstore中的数据flush到Storefile中。</p>
<p>当Storefile越来越多，会触发Compact合并操作，把过多的Storefile合并成一个大的HFile。</p>
<p>当HFile越来越大，Region也会越来越大，达到阈值后，会触发Split操作，将Region一分为二。</p>
<p>细节描述：</p>
<p>hbase使用MemStore和StoreFile存储对表的更新。</p>
<p>数据在更新时首先写入Log(WAL log)和内存(MemStore)中，MemStore中的数据是排序的，当MemStore累计到一定阈值时，就会创建一个新的MemStore，并 且将老的MemStore添加到flush队列，由单独的线程flush到磁盘上，成为一个StoreFile。于此同时，系统会在zookeeper中记录一个redo point，表示这个时刻之前的变更已经持久化了。</p>
<p>当系统出现意外时，可能导致内存(MemStore)中的数据丢失，此时使用Log(WAL log)来恢复checkpoint之后的数据。</p>
<p>StoreFile是只读的，一旦创建后就不可以再修改。因此Hbase的更新其实是不断追加的操作。当一个Store中的StoreFile达到一定的阈值后，就会进行一次合并(minor_compact, major_compact),将对同一个key的修改合并到一起，形成一个大的StoreFile，当StoreFile的大小达到一定阈值后，又会对 StoreFile进行split，等分为两个StoreFile。</p>
<p>由于对表的更新是不断追加的，compact时，需要访问Store中全部的 StoreFile和MemStore，将他们按row key进行合并，由于StoreFile和MemStore都是经过排序的，并且StoreFile带有内存中索引，合并的过程还是比较快。</p>
<p> <strong>Region管理</strong></p>
<p>(1) region分配</p>
<p>任何时刻，一个region只能分配给一个region server。master记录了当前有哪些可用的region server。以及当前哪些region分配给了哪些region server，哪些region还没有分配。当需要分配的新的region，并且有一个region server上有可用空间时，master就给这个region server发送一个装载请求，把region分配给这个region server。region server得到请求后，就开始对此region提供服务。</p>
<p>(2) region server上线</p>
<p>master使用zookeeper来跟踪region server状态。当某个region server启动时，会首先在zookeeper上的server目录下建立代表自己的znode。由于master订阅了server目录上的变更消息，当server目录下的文件出现新增或删除操作时，master可以得到来自zookeeper的实时通知。因此一旦region server上线，master能马上得到消息。</p>
<p>(3) region server下线</p>
<p>当region server下线时，它和zookeeper的会话断开，zookeeper而自动释放代表这台server的文件上的独占锁。master就可以确定：</p>
<p>1 region server和zookeeper之间的网络断开了。</p>
<p>2 region server挂了。</p>
<p>无论哪种情况，region server都无法继续为它的region提供服务了，此时master会删除server目录下代表这台region server的znode数据，并将这台region server的region分配给其它还活着的同志。</p>
<h2 id="Master工作机制"><a href="#Master工作机制" class="headerlink" title="Master工作机制"></a>Master工作机制</h2><p>Ø  master上线</p>
<p>master启动进行以下步骤:</p>
<p>1 从zookeeper上获取唯一一个代表active master的锁，用来阻止其它master成为master。</p>
<p>2 扫描zookeeper上的server父节点，获得当前可用的region server列表。</p>
<p>3 和每个region server通信，获得当前已分配的region和region server的对应关系。</p>
<p>4 扫描.META.region的集合，计算得到当前还未分配的region，将他们放入待分配region列表。</p>
<p>Ø  master下线</p>
<p>由于master只维护表和region的元数据，而不参与表数据IO的过程，master下线仅导致所有元数据的修改被冻结(无法创建删除表，无法修改表的schema，无法进行region的负载均衡，无法处理region 上下线，无法进行region的合并，唯一例外的是region的split可以正常进行，因为只有region server参与)，表的数据读写还可以正常进行。因此master下线短时间内对整个hbase集群没有影响。</p>
<p>从上线过程可以看到，master保存的信息全是可以冗余信息（都可以从系统其它地方收集到或者计算出来）</p>
<p>因此，一般hbase集群中总是有一个master在提供服务，还有一个以上的‘master’在等待时机抢占它的位置。</p>
<h2 id="十二-hbase三个重要机制"><a href="#十二-hbase三个重要机制" class="headerlink" title="十二 hbase三个重要机制"></a>十二 hbase三个重要机制</h2><h2 id="1、flush机制"><a href="#1、flush机制" class="headerlink" title="1、flush机制"></a>1、flush机制</h2><p>1.（hbase.regionserver.global.memstore.size）默认;堆大小的40%</p>
<p>regionServer的全局memstore的大小，超过该大小会触发flush到磁盘的操作,默认是堆大小的40%,而且regionserver级别的flush会阻塞客户端读写</p>
<p>2.（hbase.hregion.memstore.flush.size）默认：128M</p>
<p>单个region里memstore的缓存大小，超过那么整个HRegion就会flush, </p>
<p>3.（hbase.regionserver.optionalcacheflushinterval）默认：1h</p>
<p>内存中的文件在自动刷新之前能够存活的最长时间</p>
<p>4.（hbase.regionserver.global.memstore.size.lower.limit）默认：堆大小 <em> 0.4 </em> 0.95</p>
<p>有时候集群的“写负载”非常高，写入量一直超过flush的量，这时，我们就希望memstore不要超过一定的安全设置。在这种情况下，写操作就要被阻塞一直到memstore恢复到一个“可管理”的大小, 这个大小就是默认值是堆大小 <em> 0.4 </em> 0.95，也就是当regionserver级别的flush操作发送后,会阻塞客户端写,一直阻塞到整个regionserver级别的memstore的大小为堆得大小乘0.4乘0.95为止</p>
<p>5.（hbase.hregion.preclose.flush.size）默认为：5M</p>
<p>当一个 region 中的 memstore 的大小大于这个值的时候，我们又触发 了 close.会先运行“pre-flush”操作，清理这个需要关闭的memstore，然后 将这个 region 下线。当一个 region 下线了，我们无法再进行任何写操作。 如果一个 memstore 很大的时候，flush  操作会消耗很多时间。”pre-flush” 操作意味着在 region 下线之前，会先把 memstore 清空。这样在最终执行 close 操作的时候，flush 操作会很快。</p>
<p>6.（hbase.hstore.compactionThreshold）默认：超过3个</p>
<p>一个store里面允许存的hfile的个数，超过这个个数会被写到新的一个hfile里面 也即是每个region的每个列族对应的memstore在fulsh为hfile的时候，默认情况下当超过3个hfile的时候就会 对这些文件进行合并重写为一个新文件，设置个数越大可以减少触发合并的时间，但是每次合并的时间就会越长</p>
<h2 id="2-compact机制"><a href="#2-compact机制" class="headerlink" title="2     compact机制"></a>2     compact机制</h2><p>把小的storeFile文件合并成大的Storefile文件。</p>
<p>清理过期的数据，包括删除的数据</p>
<p>将数据的版本号保存为3个</p>
<h2 id="3、split机制"><a href="#3、split机制" class="headerlink" title="3、split机制"></a>3、split机制</h2><p>当Region达到阈值，会把过大的Region一分为二。</p>
<p>默认一个HFile达到10Gb的时候就会进行切分</p>

      
    </div>

    

    
    
    

    

    
      
    
    
      <div>
        <div id="reward-container">
  <div>Thank you for your accept. mua！</div>
  <button id="reward-button" disable="enable" onclick="var qr = document.getElementById(&quot;qr&quot;); qr.style.display = (qr.style.display === 'none') ? 'block' : 'none';">
    打赏
  </button>
  <div id="qr" style="display: none;">

    
      
      
        
      
      <div style="display: inline-block">
        <img src="/images/reward/wechatpay.jpg" alt="丨HF丨 微信支付">
        <p>微信支付</p>
      </div>
    
      
      
        
      
      <div style="display: inline-block">
        <img src="/images/reward/alipay.jpg" alt="丨HF丨 支付宝">
        <p>支付宝</p>
      </div>
    

  </div>
</div>

      </div>
    

    
      <div>
        




  



<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>丨HF丨</li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    
    <a href="https://manzhong.github.io/2017/07/17/Hbase.html" title="Hbase">https://manzhong.github.io/2017/07/17/Hbase.html</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fa fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！</li>
</ul>

      </div>
    
    <div>
      
        <div>
    
        <div style="text-align:center;color: #ccc;font-size:16px;">-------------本文结束<i class="fa fa-heart"></i>感谢您的阅读-------------</div>
    
</div>
      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/BigData/" rel="tag"><i class="fa fa-tag"></i> BigData</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2017/07/16/Kafka.html" rel="next" title="Kafka">
                <i class="fa fa-chevron-left"></i> Kafka
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2017/07/18/Hbase增强.html" rel="prev" title="Hbase增强">
                Hbase增强 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


  </div>


          </div>
          

  
    <div class="comments" id="comments">
      <div id="lv-container" data-id="city" data-uid="MTAyMC81MDA2Mi8yNjU1Mw=="></div>
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <div class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/hexo.jpg" alt="丨HF丨">
            
              <p class="site-author-name" itemprop="name">丨HF丨</p>
              <div class="site-description motion-element" itemprop="description">第二名就是头号输家!!!</div>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">54</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  
                    
                      <a href="/categories/">
                    
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">6</span>
                    <span class="site-state-item-name">分类</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  
                    
                      <a href="/tags/">
                    
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">13</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://github.com/ipyker" title="GitHub &rarr; https://github.com/ipyker" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="mailto:pyker@qq.com" title="E-Mail &rarr; mailto:pyker@qq.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://weibo.com/viszhang" title="Weibo &rarr; https://weibo.com/viszhang" rel="noopener" target="_blank"><i class="fa fa-fw fa-weibo"></i>Weibo</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="tencent://message/?uin=123435796&Site=&menu=yes" title="QQ &rarr; tencent://message/?uin=123435796&Site=&menu=yes" rel="noopener" target="_blank"><i class="fa fa-fw fa-qq"></i>QQ</a>
                </span>
              
            </div>
          

          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-inline">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-book"></i>
                推荐阅读
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="http://www.54tianzhisheng.cn/tags/Flink/" title="http://www.54tianzhisheng.cn/tags/Flink/" rel="noopener" target="_blank">Flink</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://nginxconfig.io/" title="https://nginxconfig.io/" rel="noopener" target="_blank">Nginxconfig</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://linux.51yip.com/" title="http://linux.51yip.com/" rel="noopener" target="_blank">Linux命令手册</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://echarts.baidu.com/index.html" title="https://echarts.baidu.com/index.html" rel="noopener" target="_blank">echarts可视化库</a>
                  </li>
                
              </ul>
            </div>
          

          
            
          
          
        </div>
      </div>

      

      
        <div class="back-to-top">
          <i class="fa fa-arrow-up"></i>
          
            <span id="scrollpercent"><span>0</span>%</span>
          
        </div>
      

    </div>
  </aside>
  


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" style=" text-align:center;">&copy; 2017 – <span itemprop="copyrightYear">2020</span>
  <span class="with-love" id="animate">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">HF</span>

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"> 站点字数合计:</i>
    </span>
    
    <span title="站点总字数">961k</span>
  
  
  <span class="post-meta-divider">|</span>
  <a href="http://www.beian.miit.gov.cn" rel="noopener" target="_blank">粤ICP备19028706号 </a>

</div>
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>







<div class="run_time" style=" text-align:center;">
  <span id="timeDate">载入天数...</span><span id="times">载入时分秒...</span>
  <script>
    var now = new Date(); 
    function createtime() { 
        var grt= new Date("07/23/2017 10:00:00");//此处修改你的建站时间或者网站上线时间 
        now.setTime(now.getTime()+250); 
        days = (now - grt ) / 1000 / 60 / 60 / 24; dnum = Math.floor(days); 
        hours = (now - grt ) / 1000 / 60 / 60 - (24 * dnum); hnum = Math.floor(hours); 
        if(String(hnum).length ==1 ){hnum = "0" + hnum;} minutes = (now - grt ) / 1000 /60 - (24 * 60 * dnum) - (60 * hnum); 
        mnum = Math.floor(minutes); if(String(mnum).length ==1 ){mnum = "0" + mnum;} 
        seconds = (now - grt ) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum); 
        snum = Math.round(seconds); if(String(snum).length ==1 ){snum = "0" + snum;} 
        document.getElementById("timeDate").innerHTML = "本站已安全运行 "+dnum+" 天 "; 
        document.getElementById("times").innerHTML = hnum + " 小时 " + mnum + " 分 " + snum + " 秒"; 
    } 
    setInterval("createtime()",250);
  </script>
</div>
        
<div class="busuanzi-count" style=" text-align:center;">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
      我的第 <span class="busuanzi-value" id="busuanzi_value_site_uv"></span> 位朋友，
    </span>
  



  
    <span class="site-pv">
      历经 <span class="busuanzi-value" id="busuanzi_value_site_pv"></span> 次回眸才与你相遇
    </span>
  
</div>










        
      </div>
    </footer>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>





  



  






  



  
    
    
      
    
  
  <script color="255,0,255" opacity="0.7" zindex="-1" count="140" src="//cdn.jsdelivr.net/gh/theme-next/theme-next-canvas-nest@1.0.0/canvas-nest.min.js"></script>













  
  <script src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script src="/lib/fancybox/source/jquery.fancybox.pack.js"></script>


  


  <script src="/js/utils.js?v=7.1.1"></script>

  <script src="/js/motion.js?v=7.1.1"></script>



  
  


  <script src="/js/schemes/muse.js?v=7.1.1"></script>




  
  <script src="/js/scrollspy.js?v=7.1.1"></script>
<script src="/js/post-details.js?v=7.1.1"></script>



  


  <script src="/js/next-boot.js?v=7.1.1"></script>


  

  

  
  
  

  

  
  
  


  


  
    <script>
  window.livereOptions = {
    refer: '2017/07/17/Hbase.html'
  };
  (function(d, s) {
    var j, e = d.getElementsByTagName(s)[0];
    if (typeof LivereTower === 'function') { return; }
    j = d.createElement(s);
    j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
    j.async = true;
    e.parentNode.insertBefore(j, e);
  })(document, 'script');
</script>

  


  
  <script>
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url).replace(/\/{2,}/g, '/');
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x"></i></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x"></i></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  

  

  
  <script>
    (function(){
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      bp.src = (curProtocol === 'https') ? 'https://zz.bdstatic.com/linksubmit/push.js' : 'http://push.zhanzhang.baidu.com/push.js';
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
    })();
  </script>


  

  

  

  

  
  
  
  <script src="/lib/bookmark/bookmark.min.js?v=1.0"></script>
  <script>
  
    bookmark.scrollToMark('auto', "#更多");
  
  </script>


  

  

  

</body>
</html>
<!-- 页面点击小红心 -->
<script type="text/javascript" src="/js/src/clicklove.js"></script>
