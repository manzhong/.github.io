---
title: 数仓
abbrlink: 29006
date: 2019-03-20 21:32:51
tags:
categories:
summary_img:
encrypt:
enc_pwd:
---

杨红飞: dw层为核心
ods --源数据层
dw  --数据仓库层
	dw --明细层 DWD 层要做的就是将数据清理、整合、规范化、脏数据、垃圾数据、规范不一致的、状态定义不一致的、命名不规范的数据都会被处理。在该层也会做一部分的数据聚合，将相同主题的数据汇集到一张表中，提高数据的可用性 。
	mid --中间层 轻度汇总层  (会对明细层的数据做轻度聚合) 和dm层 根据业务集市的复杂度等进行dm和mid的合并 直接产生dm无mid
	dm --集市层 或大宽表,(可以跨业务,表不多,或按业务形成主题域)
	(dim) --维度表
rpt --数据应用层
	app  --线上使用
	rpt  --报表

数仓建模方法
	范式建模法、维度建模法、实体建模法

	常用维度建模:维度建模是紧贴业务的，所以必须以业务为根基进行建模

退化维度
	退化维度就是将维度退回到事实表中。因为有时维度除了主键没有其他内容，虽然也是合法维度键，但是一般都会退回到事实表中，减少关联次数，提高查询性能


维度建模
	四步走
		1:选择业务过程 维度建模是紧贴业务的，所以必须以业务为根基进行建模
		2:声明粒度 维度建模中要求我们，在同一事实表中，必须具有相同的粒度，同一事实表中不要混用多种不同的粒度，不同的粒度数据建立不同的事实表,并且从给定的业务过程获取数据时，强烈建议从关注原子粒度开始设计，也就是从最细粒度开始，因为原子粒度能够承受无法预期的用户查询。但是上卷汇总粒度对查询性能的提升很重要的，所以对于有明确需求的数据，我们建立针对需求的上卷汇总粒度，对需求不明朗的数据我们建立原子粒度。
		3:确认维度 维度表是作为业务分析的入口和描述性标识，所以也被称为数据仓库的“灵魂”。在一堆的数据中怎么确认哪些是维度属性呢，如果该列是对具体值的描述，是一个文本或常量，某一约束和行标识的参与者，此时该属性往往是维度属性，数仓工具箱中告诉我们牢牢掌握事实表的粒度，就能将所有可能存在的维度区分开，并且要确保维度表中不能出现重复数据，应使维度主键唯一
		4:确认事实 事实表是用来度量的，基本上都以数量值表示，事实表中的每行对应一个度量，每行中的数据是一个特定级别的细节数据，称为粒度。
			**维度建模的核心原则之一是同一事实表中的所有度量必须具有相同的粒度。**这样能确保不会出现重复计算度量的问题。
			有时候往往不能确定该列数据是事实属性还是维度属性。记住最实用的事实就是数值类型和可加类事实。所以可以通过分析该列是否是一种包含多个值并作为计算的参与者的度量，这种情况下该列往往是事实。



数据中台出现的原因:
	之前开发是不同业务线对应不同的数据团队，每个数据团队互不干扰，这种模式比较简单，只针对自己的业务线进行数仓建设及报表开发即可。
	但是随着业务的发展，频繁迭代及跨部门的垂直业务单元越来越多，业务之间的出现耦合情况，这时再采用这种烟囱式开发就出现了问题：
	例如权限问题，公司对数据管理比较严格，不同的数据开发组没有权限共享数据，需要其他业务线的数据权限需要上报审批，比较耽误时间；
	还有重复开发问题，不同业务线会出现相同的报表需求，如果每个业务方都开发各自的报表，太浪费资源。
	所以对于数据开发而言，需要对各个业务线的数据进行统一管理，所以就有了数据中台的出现。

数据中台:
	我认为数据中台是根据每个公司具体的业务需求而搭建的，不同的业务，对中台的理解有所不同。
	公司内部开发的敏捷数据中台，主要从数据技术和计算能力的复用，到数据资产和数据服务的复用，数据中台以更大价值带宽，快准精让数据直接赋能业务。提供一个统一化的管理，打破数据孤岛，追溯数据血缘，实现自助化及高复用度



数仓建设核心思想：

	**从设计、开发、部署和使用层面，避免重复建设和指标冗余建设，从而保障数据口径的规范和统一，最终实现数据资产全链路关联、提供标准数据输出以及建立统一的数据公共层。**

	有了核心思想，那怎么开始数仓建设，有句话说数仓建设者即是技术专家，也是大半个业务专家，所以采用的方式就是需求推动数据建设，并且因为数据中台，所以各业务知识体系比较集中，各业务数据不再分散，加快了数仓建设速度。
	数仓建设主要从两个方面进行，模型和规范，所有业务进行统一化


模型:
	所有业务采用统一的模型体系，从而降低研发成本，增强指标复用，并且能保证数据口径的统一

模型分层:
		结合公司业务，后期新增需求较多，所以分层不宜过多，并且需要清晰明确各层职责，要保证数据层的稳定又要屏蔽对下游影响，所以采用如下分层结构：
	数据分层架构
		数据流向
		遵循模型开发时分层结构，数据从 ods -> dw -> mid -> dm ->app 这样正向流动，可以防止因数据引用不规范而造成数据链路混乱及SLA时效难保障等问题，同时保证血缘关系简洁化，能够轻易追踪数据流向。在开发时应避免以下情况出现：
		数据引用链路不正确，如 ods -> dm ->app ，出现这种情况说明明细层没有完全覆盖数据；如 ods -> dw -> app ，说明轻度汇总层主题划分未覆盖全 。减少跨层引用，才能提高中间表的复用度。理想的数仓模型设计应当具备：数据模型可复⽤，完善且规范。
		尽量避免一层的表生成当前层的表，如dw层表生成dw层表，这样会影响ETL效率。
		禁止出现反向依赖，如dw表依赖于dm表

表命名:
	对于ods、dm、app层表名：类型_主题_表含义，如：dm_xxsh_user
	对于dw层表名：类型_主题_维度_表含义，如：dw_xxsh_fact_users（事实表）、dw_xxsh_dim_city（维度表）


字段命名规范:
	构建词根,词根是维度和指标管理的基础，划分为普通词根与专有词根
	普通词根：描述事物的最小单元体，如：sex-性别。
	专有词根：具备行业专属或公司内部规定的描述体，如：xxsh-公司内部对某个产品的称呼。

